<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4361EE">
<title>CryptoxCore ‚Äî Trade Cryptocurrency with Confidence</title>
<meta name="description" content="Secure cryptocurrency exchange platform. Deposit with MTN MoMo & Orange Money, trade Bitcoin, Ethereum and 14+ cryptocurrencies.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%234361EE'/><text x='50' y='72' text-anchor='middle' font-size='60' font-weight='900' fill='white'>$</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Outfit', sans-serif; }
  #root { min-height: 100vh; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useMemo, useRef } = React;



const XAF_RATE = 530;
const COIN_IDS = "bitcoin,ethereum,binancecoin,solana,ripple,cardano,dogecoin,avalanche-2,polkadot,chainlink,litecoin,tether,uniswap,tron";
const CM = {
  bitcoin:{s:"BTC"},ethereum:{s:"ETH"},binancecoin:{s:"BNB"},solana:{s:"SOL"},ripple:{s:"XRP"},
  cardano:{s:"ADA"},dogecoin:{s:"DOGE"},"avalanche-2":{s:"AVAX"},polkadot:{s:"DOT"},
  chainlink:{s:"LINK"},litecoin:{s:"LTC"},tether:{s:"USDT"},uniswap:{s:"UNI"},tron:{s:"TRX"},
};
const gM=id=>CM[id]||{s:id.slice(0,4).toUpperCase()};
const T={bg:"#F0F2F5",wh:"#FFF",pr:"#4361EE",prL:"#EBF0FF",tx:"#1A1D29",tx2:"#6B7280",tx3:"#9CA3AF",bd:"#E5E7EB",bdL:"#F3F4F6",gn:"#10B981",gnL:"#ECFDF5",rd:"#EF4444",rdL:"#FEF2F2",am:"#F59E0B",amL:"#FFFBEB",mtn:"#FFCB05",mtnB:"#FFF9E0",or:"#FF6600",orB:"#FFF3E8"};
const fmt=(n,d=2)=>n==null||isNaN(n)?"0.00":n.toLocaleString("en-US",{minimumFractionDigits:d,maximumFractionDigits:d});
const fX=n=>Math.round(n).toLocaleString("fr-CM")+" XAF";
const fC=n=>n>=1e12?"$"+(n/1e12).toFixed(1)+"T":n>=1e9?"$"+(n/1e9).toFixed(1)+"B":n>=1e6?"$"+(n/1e6).toFixed(1)+"M":"$"+fmt(n);
const tA=d=>{const x=Date.now()-new Date(d).getTime();return x<6e4?"Just now":x<36e5?Math.floor(x/6e4)+"m ago":x<864e5?Math.floor(x/36e5)+"h ago":new Date(d).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});};
const Spin=({sz=24,c=T.pr})=><div style={{display:"inline-flex"}}><div style={{width:sz,height:sz,border:`3px solid ${T.bd}`,borderTopColor:c,borderRadius:"50%",animation:"spin .7s linear infinite"}}/></div>;
const Spark=({data,color,w=90,h=28})=>{if(!data||data.length<2)return null;const mn=Math.min(...data),mx=Math.max(...data),r=mx-mn||1;return<svg width={w} height={h}><polyline points={data.map((v,i)=>`${(i/(data.length-1))*w},${h-((v-mn)/r)*(h-4)-2}`).join(" ")} fill="none" stroke={color} strokeWidth="1.5" strokeLinecap="round"/></svg>;};

const I={
  dash:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>,
  wall:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M16 12h.01M2 10h20"/></svg>,
  exch:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4l4 4M17 8v12m0 0l4-4m-4 4l-4-4"/></svg>,
  depX:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
  cDep:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 8v8m-3-4h6"/></svg>,
  cWd:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  wdX:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>,
  txn:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 8h10M7 12h10M7 16h6"/></svg>,
  prof:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M5 20c0-3.3 3.1-6 7-6s7 2.7 7 6"/></svg>,
  out:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  search:<svg width="18" height="18" fill="none" stroke="#9CA3AF" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>,
  empty:<svg width="48" height="48" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
  clip:<svg width="48" height="48" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24"><rect x="5" y="3" width="14" height="18" rx="2"/><path d="M9 3V1h6v2M9 11h6M9 15h4"/></svg>,
  hist:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>,
};

const Counter=({end,suffix="",duration=2000})=>{const[count,setCount]=useState(0);const[started,setStarted]=useState(false);const ref=useRef(null);useEffect(()=>{const obs=new IntersectionObserver(([e])=>{if(e.isIntersecting)setStarted(true);},{threshold:.5});if(ref.current)obs.observe(ref.current);return()=>obs.disconnect();},[]);useEffect(()=>{if(!started)return;let s=0;const step=end/(duration/16);const t=setInterval(()=>{s+=step;if(s>=end){setCount(end);clearInterval(t);}else setCount(Math.floor(s*10)/10);},16);return()=>clearInterval(t);},[started,end,duration]);return<span ref={ref}>{count}{suffix}</span>;};


const LS={g:(k,d)=>{try{const v=localStorage.getItem("cxc_"+k);return v?JSON.parse(v):d;}catch{return d;}},s:(k,v)=>{try{localStorage.setItem("cxc_"+k,JSON.stringify(v));}catch{}}};
const API=async(path,opts={})=>{
  const tk=localStorage.getItem("cxc_token");
  const h={"Content-Type":"application/json"};
  if(tk)h["Authorization"]="Bearer "+tk;
  const r=await fetch("/api"+path,{...opts,headers:{...h,...(opts.headers||{})}});
  const d=await r.json();
  if(!r.ok)throw new Error(d.error||"Request failed");
  return d;
};
function App(){
  const[user,setUser]=useState(null);
  const getInitView=()=>{const p=window.location.pathname;if(p==="/login"||p==="/signup")return "auth";return "landing";};const[view,setView]=useState("landing");
  const[authLoading,setAuthLoading]=useState(true);
  const[am,setAm]=useState(()=>window.location.pathname==="/signup"?"signup":"login");
  useEffect(()=>{if(view==="auth")window.history.pushState(null,"","/"+(am==="signup"?"signup":"login"));else if(view==="landing"&&window.location.pathname!=="/")window.history.pushState(null,"","/");},[view,am]);
  const[af,setAf]=useState({fn:"",em:"",ph:"",pw:"",cpw:""});
  const[ae,setAe]=useState("");const[al,setAl]=useState(false);const[otp,setOtp]=useState(false);const[otpV,setOtpV]=useState("");const[pu,setPu]=useState(null);
  const validPages=["dashboard","wallet","exchange","deposit","crypto-deposit","crypto-withdraw","withdraw","transactions","profile","support","settings"];const getPage=()=>{const p=window.location.pathname.replace("/","");const buyMatch=window.location.pathname.match(/\/exchange\/(buy|sell)\/(.+)/);if(buyMatch){setTimeout(()=>{setExDir(buyMatch[1]);setExCoin(buyMatch[2]);setExPg(buyMatch[1]);},100);return"exchange";}return validPages.includes(p)?p:"dashboard";};const[pg,setPg]=useState(getPage);
  // Sync page state with URL
  useEffect(()=>{if(view==="app"&&window.location.pathname!=="/"+pg)window.history.pushState(null,"","/"+pg);},[pg,view]);
  useEffect(()=>{const onPop=()=>{const p=getPage();if(p!==pg)setPg(p);};window.addEventListener("popstate",onPop);return()=>window.removeEventListener("popstate",onPop);},[pg]);
  const[coins,setCoins]=useState([]);const[ld,setLd]=useState(true);
  const[bal,setBal]=useState(0);const[port,setPort]=useState({});const[txH,setTxH]=useState([]);

  // Auto-login from saved token
  useEffect(()=>{const tk=localStorage.getItem("cxc_token");if(!tk){setAuthLoading(false);return;}
    API("/auth/me").then(d=>{setUser(d.user);setPort(d.portfolio||{});setBal(d.user.balance);setView("app");const p=window.location.pathname.replace("/","");if(!validPages.includes(p))window.history.replaceState(null,"","/dashboard");if(window.location.pathname==='/'||window.location.pathname==='')window.history.replaceState(null,'','/dashboard');}).catch(()=>{localStorage.removeItem("cxc_token");const p=window.location.pathname;if(p==="/login"||p==="/signup"){setView("auth");setAm(p==="/signup"?"signup":"login");}}).finally(()=>setAuthLoading(false));
  },[]);
  const[sideOpen,setSideOpen]=useState(false);
  const[isMob,setIsMob]=useState(typeof window!=="undefined"&&window.innerWidth<768);
  useEffect(()=>{const h=()=>setIsMob(window.innerWidth<768);window.addEventListener("resize",h);return()=>window.removeEventListener("resize",h);},[]);
  const[toast,setToast]=useState(null);const[lastUp,setLastUp]=useState(null);const[hero,setHero]=useState(0);const[promo,setPromo]=useState("");
  // deposit
  const[dA,setDA]=useState("");const[dM,setDM]=useState("fapshi");const[dP,setDP]=useState("");const[dS,setDS]=useState("form");const[dTx,setDTx]=useState("");const[dNote,setDNote]=useState("");const[fapTx,setFapTx]=useState(null);
  // withdraw xaf
  const[wA,setWA]=useState("");const[wP,setWP]=useState("");const[wM,setWM]=useState("mtn");const[wS,setWS]=useState("form");
  // exchange modal
  const[exOpen,setExOpen]=useState(false);const[exPg,setExPg]=useState(null);const[txTab,setTxTab]=useState("wallet");const[txFilter,setTxFilter]=useState("7d");const[txExpand,setTxExpand]=useState(null);const[exCoin,setExCoin]=useState(null);const[exDir,setExDir]=useState("buy");const[exAmt,setExAmt]=useState("");const[exProc,setExProc]=useState(false);
  // exchange search
  const[exQ,setExQ]=useState("");

  // Profile state (lifted to App level to avoid hooks-in-inner-component bug)
  const[showPwModal,setShowPwModal]=useState(false);const[show2FA,setShow2FA]=useState(false);const[showSettings,setShowSettings]=useState(false);const[tfa,setTfa]=useState(false);const[pwForm,setPwForm]=useState({cur:"",nw:"",cnf:""});const[pwMsg,setPwMsg]=useState("");const[tgConnected,setTgConnected]=useState(false);const[tgUsername,setTgUsername]=useState("");const[tgLoading,setTgLoading]=useState(false);const[kycStatus,setKycStatus]=useState("pending");
  const[tickets,setTickets]=useState([]);const[tktSubject,setTktSubject]=useState("");const[tktMsg,setTktMsg]=useState("");const[tktCat,setTktCat]=useState("general");const[tktView,setTktView]=useState(null);const[tktReply,setTktReply]=useState("");
  // crypto deposit
  const[cdC,setCdC]=useState("");const[cdQ,setCdQ]=useState("");const[cdShow,setCdShow]=useState(false);const[cdNet,setCdNet]=useState("");const[cdNets,setCdNets]=useState([]);const[cdAmt,setCdAmt]=useState("");const[cdInvoice,setCdInvoice]=useState(null);const[cdAddr,setCdAddr]=useState("");const[cdAddrLoading,setCdAddrLoading]=useState(false);const[cdStatus,setCdStatus]=useState(null);const[cdPolling,setCdPolling]=useState(false);
  // crypto withdraw
  const[cwC,setCwC]=useState("");const[cwQ,setCwQ]=useState("");const[cwShow,setCwShow]=useState(false);const[cwAmt,setCwAmt]=useState("");const[cwAddr,setCwAddr]=useState("");const[cwNet,setCwNet]=useState("ERC20");const[cwStep,setCwStep]=useState("form");const[cwConfirm,setCwConfirm]=useState(false);

  const bU=bal/XAF_RATE;const f="'Outfit',sans-serif";
  const tPV=Object.entries(port).reduce((s,[id,q])=>{const c=coins.find(x=>x.id===id);return s+(c?q*c.current_price:0);},0);

  const fetchP=useCallback(async()=>{try{const d=await API('/coins');setCoins(d.coins||[]);setLastUp(new Date());setLd(false);}catch{if(!coins.length)setLd(false);}},[]);
  useEffect(()=>{if(user){fetchP();const iv=setInterval(fetchP,30000);const loadTx=async()=>{try{const d=await API('/transactions');setTxH(d.transactions||[]);}catch{}};loadTx();
      const loadTk=async()=>{try{const d=await API('/support/tickets');setTickets(d.tickets||[]);}catch{}};loadTk();return()=>clearInterval(iv);}},[user]);
  useEffect(()=>{const iv=setInterval(()=>setHero(p=>(p+1)%3),5000);return()=>clearInterval(iv);},[]);

  // Telegram config (moved from Profile)
  const TG_API="";const TG_BOT_USERNAME="fauscrypto_alert_bot";
  useEffect(()=>{if(!user)return;const checkTg=async()=>{try{const r=await fetch(TG_API+"/api/telegram/status/"+user.email);const d=await r.json();if(d.connected){setTgConnected(true);setTgUsername(d.username||"Connected");}}catch(e){}};checkTg();},[user]);


  const sT=(m,t="ok")=>{setToast({m,t});setTimeout(()=>setToast(null),4000);};
  const gC=id=>coins.find(c=>c.id===id);

  // Auth
  const doAuth=async()=>{setAe("");setAl(true);try{
    if(am==="signup"){
      if(!af.fn.trim()){setAe("Name required");setAl(false);return;}
      if(!af.em.includes("@")){setAe("Valid email required");setAl(false);return;}
      if(!af.ph||af.ph.length<9){setAe("Valid phone required");setAl(false);return;}
      if(af.pw.length<8){setAe("Min 8 characters");setAl(false);return;}
      if(af.pw!==af.cpw){setAe("Passwords don't match");setAl(false);return;}
      const d=await API("/auth/register",{method:"POST",body:JSON.stringify({fullName:af.fn.trim(),email:af.em.trim(),phone:af.ph.trim(),password:af.pw})});
      localStorage.setItem("cxc_token",d.token);setUser(d.user);setBal(d.user.balance||0);setPort({});setTxH([]);setView("app");window.history.pushState(null,'','/dashboard');sT("Account created! Welcome "+d.user.fullName);
    }else{
      if(!af.em.includes("@")){setAe("Valid email required");setAl(false);return;}
      if(af.pw.length<1){setAe("Enter password");setAl(false);return;}
      const d=await API("/auth/login",{method:"POST",body:JSON.stringify({email:af.em.trim(),password:af.pw})});
      localStorage.setItem("cxc_token",d.token);setUser(d.user);setBal(d.user.balance||0);setView("app");window.history.pushState(null,'','/dashboard');sT("Welcome back, "+d.user.fullName+"!");
      // Immediately fetch portfolio and transactions
      try{const me=await API("/auth/me");setPort(me.portfolio||{});setBal(me.user.balance);const tx=await API("/transactions");setTxH(tx.transactions||[]);}catch(e){}
    }
  }catch(e){setAe(e.message||"Authentication failed");}setAl(false);};
  const doOTP=()=>{sT("Account created! You can now login.","ok");setAm("login");setOtp(false);};

  // Deposit
  const startDep=()=>{const a=parseInt(dA);if(!a||a<100)return sT("Min 100 XAF","err");if(!dP||dP.length<9)return sT("Valid phone","err");setDS("confirm");};
  const confDep=async()=>{setDS("proc");setDTx("NXP"+Date.now().toString(36).toUpperCase());try{
    const d=await API("/wallet/deposit",{method:"POST",body:JSON.stringify({amount:parseInt(dA),method:dM,phone:dP})});
    setBal(d.balance);const txR=await API("/transactions");setTxH(txR.transactions||[]);setDS("ok");sT(d.message);
  }catch(e){setDS("form");sT(e.message||"Deposit failed","err");}};

  // Withdraw XAF
  const doWd=async()=>{const a=parseInt(wA);if(!a||a<500)return sT("Min 500 XAF","err");if(a>bal)return sT("Insufficient","err");if(!wP||wP.length<9)return sT("Valid phone","err");setWS("proc");try{
    const d=await API("/wallet/withdraw",{method:"POST",body:JSON.stringify({amount:a,method:wM,phone:wP})});
    setBal(d.balance);const txR=await API("/transactions");setTxH(txR.transactions||[]);setWS("ok");sT(d.message);
  }catch(e){setWS("form");sT(e.message||"Withdrawal failed","err");}};

  // Exchange (buy/sell from modal)
  const doExchange=async()=>{if(!exCoin)return;const c=gC(exCoin);if(!c)return;const a=parseFloat(exAmt);if(!a||a<=0)return sT("Enter amount","err");setExProc(true);try{
    const endpoint=exDir==="buy"?"/exchange/buy":"/exchange/sell";
    const d=await API(endpoint,{method:"POST",body:JSON.stringify({coinId:exCoin,quantity:a})});
    setBal(d.balance);setPort(d.portfolio);sT(d.message);const txR=await API("/transactions");setTxH(txR.transactions||[]);setExAmt("");setExOpen(false);
  }catch(e){sT(e.message||"Trade failed","err");}setExProc(false);};

  // Crypto withdraw
  const doCW=async()=>{if(!cwC)return sT("Select coin","err");const a=parseFloat(cwAmt);const m=gM(cwC);const held=port[cwC]||0;if(!a||a<=0)return sT("Enter amount","err");if(a>held)return sT("Only hold "+held.toFixed(8)+" "+m.s,"err");if(!cwAddr||cwAddr.length<10)return sT("Enter address","err");try{
    const d=await API("/exchange/crypto-withdraw",{method:"POST",body:JSON.stringify({coinId:cwC,quantity:a,address:cwAddr,network:cwNet})});
    setPort(d.portfolio);sT(d.message);const txR=await API("/transactions");setTxH(txR.transactions||[]);setCwAmt("");setCwAddr("");setCwC("");setCwShow(false);
  }catch(e){sT(e.message||"Withdrawal failed","err");}};

  // styles
  const iS={width:"100%",padding:"12px 14px",borderRadius:10,border:`1.5px solid ${T.bd}`,background:T.wh,color:T.tx,fontSize:16,fontFamily:f,outline:"none",boxSizing:"border-box"};
  const bP={border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:10,fontSize:14,padding:"12px 24px",background:T.pr,color:"#fff",transition:"all .15s"};
  const bO={...bP,background:"transparent",color:T.pr,border:`1.5px solid ${T.pr}`};
  const cd={background:T.wh,borderRadius:14,border:`1px solid ${T.bd}`,overflow:"hidden"};
  const lS={fontSize:13,fontWeight:600,color:T.tx2,marginBottom:6,display:"block"};

  // Auth loading screen
  if(authLoading)return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:T.bg}}><div style={{textAlign:"center"}}><Spin sz={40}/><p style={{marginTop:16,color:T.tx2,fontFamily:"'Outfit',sans-serif"}}>Loading CryptoxCore...</p></div></div>);

  // Counter moved outside App

  // ‚ïê‚ïê‚ïê LANDING PAGE ‚ïê‚ïê‚ïê
  if(view==="landing")return(
    <div style={{fontFamily:f,background:"#FAFBFF",color:"#0F1629",overflowX:"hidden"}}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap');*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}button{cursor:pointer;transition:all .2s}button:hover{transform:translateY(-1px)}button:active{transform:scale(.98)}a{text-decoration:none;color:inherit}@keyframes fadeUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}@keyframes pulse2{0%,100%{opacity:.6}50%{opacity:1}}@keyframes gradMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}@keyframes spin{to{transform:rotate(360deg)}}@media(max-width:768px){.lnav-links{display:none!important}.lnav-mob{display:flex!important}.hero-t{font-size:32px!important}.feat-g{grid-template-columns:1fr!important}.step-g{grid-template-columns:1fr!important}.sec-g{grid-template-columns:1fr!important}.stat-g{grid-template-columns:repeat(2,1fr)!important}.foot-g{grid-template-columns:1fr 1fr!important}}`}</style>

      {/* NAV */}
      <nav style={{position:"fixed",top:0,left:0,right:0,zIndex:100,background:"rgba(250,251,255,.92)",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(20px)",borderBottom:"1px solid rgba(67,97,238,.08)",padding:"0 24px",height:68,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div style={{display:"flex",alignItems:"center",gap:10}}><div style={{width:36,height:36,borderRadius:12,background:"linear-gradient(135deg,#4361EE,#6366F1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:900,color:"#fff",boxShadow:"0 4px 16px rgba(67,97,238,.3)"}}>$</div><span style={{fontSize:20,fontWeight:800}}>CryptoxCore</span></div>
        <div className="lnav-links" style={{display:"flex",alignItems:"center",gap:28}}>
          <a href="#features" style={{fontSize:14,fontWeight:500,color:"#6B7280"}}>Features</a>
          <a href="#how-it-works" style={{fontSize:14,fontWeight:500,color:"#6B7280"}}>How It Works</a>
          <a href="#security" style={{fontSize:14,fontWeight:500,color:"#6B7280"}}>Security</a>
          <button onClick={()=>{setAm("login");setView("auth");window.history.pushState(null,"","/login");}} style={{border:"none",fontFamily:f,fontWeight:600,fontSize:14,padding:"8px 18px",borderRadius:8,background:"transparent",color:T.pr}}>Login</button>
          <button onClick={()=>{setAm("signup");setView("auth");window.history.pushState(null,"","/signup");}} style={{border:"none",fontFamily:f,fontWeight:700,fontSize:14,padding:"10px 24px",borderRadius:10,background:"linear-gradient(135deg,#4361EE,#5B6CF0)",color:"#fff",boxShadow:"0 4px 16px rgba(67,97,238,.3)"}}>Get Started</button>
        </div>
        <div className="lnav-mob" style={{display:"none",alignItems:"center",gap:8}}><button onClick={()=>{setAm("login");setView("auth");window.history.pushState(null,"","/login");}} style={{border:"none",fontFamily:f,fontWeight:600,fontSize:13,padding:"7px 14px",borderRadius:8,background:"transparent",color:T.pr}}>Login</button><button onClick={()=>{setAm("signup");setView("auth");window.history.pushState(null,"","/signup");}} style={{border:"none",fontFamily:f,fontWeight:700,fontSize:13,padding:"9px 18px",borderRadius:10,background:"linear-gradient(135deg,#4361EE,#5B6CF0)",color:"#fff"}}>Sign Up</button></div>
      </nav>

      {/* HERO */}
      <section style={{position:"relative",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"120px 24px 80px",overflow:"hidden",background:"linear-gradient(135deg,#EBF0FF 0%,#F0E6FF 25%,#FFF0F5 50%,#E8F4FD 75%,#EBF0FF 100%)",backgroundSize:"300% 300%",animation:"gradMove 12s ease infinite"}}>
        <div style={{position:"absolute",width:500,height:500,borderRadius:"50%",background:"radial-gradient(circle,rgba(67,97,238,.08) 0%,transparent 70%)",top:-100,right:-100,animation:"float 8s ease infinite"}}/>
        <div style={{position:"absolute",width:400,height:400,borderRadius:"50%",background:"radial-gradient(circle,rgba(124,58,237,.06) 0%,transparent 70%)",bottom:-50,left:-100,animation:"float 10s ease infinite 2s"}}/>
        <div style={{position:"absolute",inset:0,backgroundImage:"radial-gradient(circle,rgba(67,97,238,.04) 1px,transparent 1px)",backgroundSize:"32px 32px",opacity:.5}}/>
        <div style={{position:"relative",maxWidth:720,animation:"fadeUp .8s ease"}}>
          <div style={{display:"inline-flex",alignItems:"center",gap:8,padding:"8px 18px",borderRadius:40,background:"rgba(67,97,238,.08)",border:"1px solid rgba(67,97,238,.12)",marginBottom:28,fontSize:13,fontWeight:600,color:T.pr}}><span style={{width:6,height:6,borderRadius:"50%",background:"#10B981",animation:"pulse2 2s infinite"}}/>Trusted by 10,000+ traders worldwide</div>
          <h1 className="hero-t" style={{fontSize:56,fontWeight:900,lineHeight:1.1,marginBottom:20}}>Trade <span style={{background:"linear-gradient(90deg,#4361EE,#7C3AED,#4361EE)",backgroundSize:"200% auto",animation:"shimmer 3s linear infinite",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"}}>Cryptocurrency</span><br/>with Confidence</h1>
          <p style={{fontSize:18,lineHeight:1.7,color:"#6B7280",maxWidth:560,margin:"0 auto 36px"}}>Secure, fast, and reliable cryptocurrency exchange platform. Deposit with MTN MoMo & Orange Money, trade, and withdraw with ease.</p>
          <div style={{display:"flex",gap:14,justifyContent:"center",flexWrap:"wrap"}}>
            <button onClick={()=>{setAm("signup");setView("auth");window.history.pushState(null,"","/signup");}} style={{border:"none",fontFamily:f,fontWeight:700,fontSize:16,padding:"16px 36px",borderRadius:14,background:"linear-gradient(135deg,#4361EE,#5B6CF0)",color:"#fff",boxShadow:"0 8px 32px rgba(67,97,238,.35)",display:"flex",alignItems:"center",gap:8}}>Start Trading Now <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button>
            <button onClick={()=>document.getElementById("features")?.scrollIntoView({behavior:"smooth"})} style={{fontFamily:f,fontWeight:600,fontSize:16,padding:"16px 36px",borderRadius:14,background:"#fff",color:T.pr,border:"2px solid rgba(67,97,238,.2)",boxShadow:"0 4px 16px rgba(0,0,0,.04)"}}>Learn More</button>
          </div>
          <div style={{display:"flex",justifyContent:"center",gap:24,marginTop:48,flexWrap:"wrap"}}>{[{i:"üîí",t:"256-bit SSL Encryption"},{i:"üõ°Ô∏è",t:"2FA Protected"},{i:"‚ö°",t:"Instant Transactions"}].map((b,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:6,fontSize:13,fontWeight:500,color:"#9CA3AF"}}><span>{b.i}</span>{b.t}</div>))}</div>
        </div>
      </section>

      {/* STATS */}
      <section style={{background:"#fff",borderTop:"1px solid #E5E7EB",borderBottom:"1px solid #E5E7EB",padding:"40px 24px"}}><div className="stat-g" style={{maxWidth:1000,margin:"0 auto",display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:20,textAlign:"center"}}>{[{v:10,s:"K+",l:"Active Traders"},{v:14,s:"+",l:"Cryptocurrencies"},{v:99.9,s:"%",l:"Uptime"},{v:530,s:" XAF",l:"Per $1 USD"}].map((s,i)=>(<div key={i}><div style={{fontSize:32,fontWeight:900,color:T.pr}}><Counter end={s.v} suffix={s.s}/></div><div style={{fontSize:13,fontWeight:500,color:"#9CA3AF",marginTop:4}}>{s.l}</div></div>))}</div></section>

      {/* FEATURES */}
      <section id="features" style={{padding:"100px 24px",maxWidth:1100,margin:"0 auto"}}>
        <div style={{textAlign:"center",marginBottom:56}}><h2 style={{fontSize:38,fontWeight:900,marginBottom:12}}>Why Choose Us?</h2><p style={{fontSize:16,color:"#6B7280",maxWidth:480,margin:"0 auto"}}>Experience the best cryptocurrency trading platform built for Cameroon</p></div>
        <div className="feat-g" style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:24}}>{[{i:"üîê",c:"#4361EE",bg:"#EBF0FF",t:"Secure Platform",d:"Bank-level security with AES-256 encryption, multi-factor authentication, and cold storage to keep your assets safe."},{i:"‚ö°",c:"#7C3AED",bg:"#F3EAFF",t:"Lightning Fast",d:"Execute trades in milliseconds with our high-performance matching engine. Minimal latency and maximum speed."},{i:"üõ°Ô∏è",c:"#10B981",bg:"#ECFDF5",t:"24/7 Support",d:"Round-the-clock customer support via Telegram, email, and live chat. We're always here for you."}].map((ft,i)=>(<div key={i} style={{background:"#fff",borderRadius:18,padding:32,border:"1px solid #E5E7EB",transition:"all .3s"}} onMouseEnter={e=>{e.currentTarget.style.transform="translateY(-6px)";e.currentTarget.style.boxShadow="0 20px 60px rgba(67,97,238,.12)";}} onMouseLeave={e=>{e.currentTarget.style.transform="";e.currentTarget.style.boxShadow="";}}><div style={{width:56,height:56,borderRadius:14,background:ft.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,marginBottom:20}}>{ft.i}</div><h3 style={{fontSize:20,fontWeight:800,marginBottom:10}}>{ft.t}</h3><p style={{fontSize:14,lineHeight:1.7,color:"#6B7280"}}>{ft.d}</p></div>))}</div>
      </section>

      {/* HOW IT WORKS */}
      <section id="how-it-works" style={{padding:"100px 24px",background:"linear-gradient(180deg,#EBF0FF 0%,#F5F7FF 50%,#FAFBFF 100%)"}}>
        <div style={{maxWidth:1100,margin:"0 auto"}}>
          <div style={{textAlign:"center",marginBottom:60}}><h2 style={{fontSize:38,fontWeight:900,marginBottom:12}}>How It Works</h2><p style={{fontSize:16,color:"#6B7280"}}>Get started in three simple steps</p></div>
          <div className="step-g" style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:32}}>{[{n:1,c:"#4361EE",t:"Create Account",d:"Sign up in seconds with just your email and password. Phone verification with +237 Cameroon numbers."},{n:2,c:"#7C3AED",t:"Deposit Funds",d:"Add money instantly via MTN Mobile Money or Orange Money. $1 = 530 XAF with zero deposit fees."},{n:3,c:"#EC4899",t:"Start Trading",d:"Buy and sell 14+ cryptocurrencies including Bitcoin, Ethereum, Solana, and more at real-time market prices."}].map((s,i)=>(<div key={i} style={{textAlign:"center"}}><div style={{width:72,height:72,borderRadius:"50%",margin:"0 auto 20px",background:`linear-gradient(135deg,${s.c},${s.c}CC)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,fontWeight:900,color:"#fff",boxShadow:`0 12px 32px ${s.c}40`}}>{s.n}</div><h3 style={{fontSize:20,fontWeight:800,marginBottom:10}}>{s.t}</h3><p style={{fontSize:14,lineHeight:1.7,color:"#6B7280",maxWidth:300,margin:"0 auto"}}>{s.d}</p></div>))}</div>
        </div>
      </section>

      {/* SECURITY */}
      <section id="security" style={{padding:"100px 24px",maxWidth:1100,margin:"0 auto"}}>
        <div className="sec-g" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:48,alignItems:"center"}}>
          <div>
            <h2 style={{fontSize:38,fontWeight:900,marginBottom:16,lineHeight:1.15}}>Your Security is<br/>Our Priority</h2>
            <p style={{fontSize:15,lineHeight:1.7,color:"#6B7280",marginBottom:28}}>We use industry-leading security measures to protect your assets and personal information at every level.</p>
            {["End-to-end AES-256 encryption","Two-factor authentication (2FA)","Cold storage for digital assets","Regular third-party security audits","DDoS protection & rate limiting","Telegram instant alerts on activity"].map((item,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:12,marginBottom:14,fontSize:15,fontWeight:500}}><div style={{width:24,height:24,borderRadius:"50%",background:"#ECFDF5",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}><svg width="14" height="14" fill="none" stroke="#10B981" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>{item}</div>))}
          </div>
          <div style={{borderRadius:22,overflow:"hidden"}}>
            <div style={{background:"linear-gradient(135deg,#4361EE,#5B6CF0,#7C3AED)",padding:"48px 36px",textAlign:"center",color:"#fff",borderRadius:22,boxShadow:"0 20px 60px rgba(67,97,238,.25)"}}>
              <div style={{fontSize:72,fontWeight:900,lineHeight:1}}><Counter end={99.9} suffix="%"/></div>
              <div style={{fontSize:18,fontWeight:600,marginTop:8,opacity:.9}}>Uptime</div>
              <div style={{fontSize:14,marginTop:6,opacity:.7}}>Reliable service you can trust</div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:16,marginTop:32}}>{[{v:"256",l:"Bit Encryption"},{v:"24/7",l:"Monitoring"},{v:"0",l:"Breaches"}].map((s,i)=>(<div key={i} style={{padding:"16px 8px",borderRadius:12,background:"rgba(255,255,255,.12)"}}><div style={{fontSize:22,fontWeight:800}}>{s.v}</div><div style={{fontSize:11,opacity:.7,marginTop:2}}>{s.l}</div></div>))}</div>
            </div>
          </div>
        </div>
      </section>

      {/* PAYMENT METHODS */}
      <section style={{padding:"60px 24px",background:"#fff",borderTop:"1px solid #E5E7EB",borderBottom:"1px solid #E5E7EB"}}><div style={{maxWidth:800,margin:"0 auto",textAlign:"center"}}><p style={{fontSize:13,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:1.5,marginBottom:20}}>Supported Payment Methods</p><div style={{display:"flex",justifyContent:"center",gap:20,flexWrap:"wrap"}}>{[{n:"MTN MoMo",c:"#FFCB05",b:"#FFFBE5"},{n:"Orange Money",c:"#FF6600",b:"#FFF3E8"},{n:"Bitcoin",c:"#F7931A",b:"#FFF8EE"},{n:"Ethereum",c:"#627EEA",b:"#EEF1FF"},{n:"USDT",c:"#26A17B",b:"#EEFBF6"}].map((p,i)=>(<div key={i} style={{padding:"12px 24px",borderRadius:12,background:p.b,border:`1px solid ${p.c}20`,fontSize:14,fontWeight:700,color:p.c}}>{p.n}</div>))}</div></div></section>

      {/* CTA */}
      <section style={{padding:"100px 24px",background:"linear-gradient(135deg,#4361EE,#5B6CF0,#7C3AED)",position:"relative",overflow:"hidden"}}>
        <div style={{position:"absolute",width:400,height:400,borderRadius:"50%",background:"rgba(255,255,255,.05)",top:-100,right:-100,animation:"float 8s ease infinite"}}/>
        <div style={{maxWidth:600,margin:"0 auto",textAlign:"center",position:"relative"}}>
          <h2 style={{fontSize:42,fontWeight:900,color:"#fff",marginBottom:16,lineHeight:1.15}}>Ready to Start Trading?</h2>
          <p style={{fontSize:17,color:"rgba(255,255,255,.8)",marginBottom:36,lineHeight:1.6}}>Join thousands of users trading cryptocurrency securely with Mobile Money</p>
          <button onClick={()=>{setAm("signup");setView("auth");window.history.pushState(null,"","/signup");}} style={{border:"none",fontFamily:f,fontWeight:700,fontSize:16,padding:"18px 44px",borderRadius:14,background:"#fff",color:T.pr,boxShadow:"0 8px 32px rgba(0,0,0,.15)",display:"inline-flex",alignItems:"center",gap:8}}>Create Free Account <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button>
          <p style={{fontSize:13,color:"rgba(255,255,255,.5)",marginTop:16}}>No minimum deposit ¬∑ Free to sign up ¬∑ Instant verification</p>
        </div>
      </section>

      {/* FOOTER */}
      <footer style={{background:"#0F1629",color:"#fff",padding:"64px 24px 32px"}}>
        <div style={{maxWidth:1100,margin:"0 auto"}}>
          <div className="foot-g" style={{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gap:40,marginBottom:48}}>
            <div><div style={{display:"flex",alignItems:"center",gap:10,marginBottom:16}}><div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#4361EE,#6366F1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:900,color:"#fff"}}>$</div><span style={{fontSize:18,fontWeight:800}}>CryptoxCore</span></div><p style={{fontSize:14,lineHeight:1.7,color:"#9CA3AF",maxWidth:280}}>Secure cryptocurrency trading platform built for Africa. Trade with Mobile Money.</p></div>
            <div><h4 style={{fontSize:14,fontWeight:700,marginBottom:16}}>Platform</h4>{["Features","How It Works","Security"].map((l,i)=>(<a key={i} href={`#${l.toLowerCase().replace(/ /g,"-")}`} style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>{l}</a>))}</div>
            <div><h4 style={{fontSize:14,fontWeight:700,marginBottom:16}}>Account</h4><a href="#" onClick={e=>{e.preventDefault();setAm("login");setView("auth");}} style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>Login</a><a href="#" onClick={e=>{e.preventDefault();setAm("signup");setView("auth");}} style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>Sign Up</a></div>
            <div><h4 style={{fontSize:14,fontWeight:700,marginBottom:16}}>Support</h4><a href="#" style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>Help Center</a><a href="#" style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>Contact Us</a><a href="https://t.me/fauscrypto_alert_bot" target="_blank" style={{display:"block",fontSize:14,color:"#9CA3AF",marginBottom:10}}>Telegram Bot</a></div>
          </div>
          <div style={{borderTop:"1px solid #1E293B",paddingTop:24,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12}}><span style={{fontSize:13,color:"#6B7280"}}>¬© 2026 CryptoxCore. All rights reserved.</span><div style={{display:"flex",gap:20}}>{["Privacy Policy","Terms of Service"].map((l,i)=>(<a key={i} href="#" style={{fontSize:13,color:"#6B7280"}}>{l}</a>))}</div></div>
        </div>
      </footer>
    </div>
  );

  // ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê
  if(!user||view==="auth")return(
    <div style={{fontFamily:f,minHeight:"100vh",display:"flex",background:T.bg}}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap');*{margin:0;padding:0;box-sizing:border-box}input:focus{border-color:${T.pr}!important;box-shadow:0 0 0 3px ${T.pr}18!important}button:hover{opacity:.92}button:active{transform:scale(.98)}@keyframes spin{to{transform:rotate(360deg)}}@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}@media(max-width:768px){.auth-left{display:none!important}.auth-mob-logo{display:flex!important}}`}</style>
      <div className="auth-left" style={{width:"48%",background:`linear-gradient(145deg,${T.pr},#6366F1)`,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:60,position:"relative"}}>
        <div onClick={()=>setView("landing")} style={{position:"absolute",top:36,left:36,display:"flex",alignItems:"center",gap:10,cursor:"pointer"}}><div style={{width:36,height:36,borderRadius:10,background:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:900,color:"#fff"}}>$</div><span style={{fontSize:20,fontWeight:800,color:"#fff"}}>CryptoxCore</span></div>
        <div style={{textAlign:"center",color:"#fff",animation:"fadeUp .6s ease"}}><div style={{width:88,height:88,borderRadius:22,margin:"0 auto 28px",background:"rgba(255,255,255,.15)",border:"2px solid rgba(255,255,255,.25)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:38}}>‚Çø</div><h1 style={{fontSize:34,fontWeight:800,marginBottom:14,lineHeight:1.2}}>Buy & Sell Crypto<br/>with Mobile Money</h1><p style={{fontSize:16,opacity:.85,lineHeight:1.7,maxWidth:380,margin:"0 auto 24px"}}>Deposit XAF via MTN MoMo or Orange Money and trade 14+ cryptocurrencies.</p><div style={{display:"flex",gap:14,justifyContent:"center"}}><div style={{padding:"8px 18px",borderRadius:10,background:"rgba(255,203,5,.2)",border:"1px solid rgba(255,203,5,.4)",fontSize:13,fontWeight:600}}>üì± MTN MoMo</div><div style={{padding:"8px 18px",borderRadius:10,background:"rgba(255,102,0,.2)",border:"1px solid rgba(255,102,0,.4)",fontSize:13,fontWeight:600}}>üì≤ Orange Money</div></div><div style={{marginTop:24,fontSize:14,opacity:.7}}>$1 = <strong>530 XAF</strong></div></div>
      </div>
      <div style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"40px 20px"}}>
        <div style={{width:"100%",maxWidth:420,animation:"fadeUp .5s ease"}}>
          <div className="auth-mob-logo" onClick={()=>setView("landing")} style={{display:"none",alignItems:"center",gap:8,marginBottom:24,cursor:"pointer"}}><div style={{width:32,height:32,borderRadius:8,background:T.pr,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:900,color:"#fff"}}>$</div><span style={{fontSize:18,fontWeight:800}}>CryptoxCore</span></div>
          {otp?(<><div style={{textAlign:"center",marginBottom:28}}><h2 style={{fontSize:22,fontWeight:800,marginBottom:6}}>Verify Phone</h2><p style={{color:T.tx2,fontSize:14}}>Code sent to <strong>+237 {pu?.phone}</strong></p></div><input value={otpV} maxLength={6} placeholder="6-digit code" onChange={e=>{setOtpV(e.target.value.replace(/\D/g,""));setAe("");}} style={{...iS,textAlign:"center",fontSize:22,letterSpacing:10,fontWeight:700,marginBottom:8}}/><p style={{fontSize:12,color:T.tx3,textAlign:"center",marginBottom:16}}>Demo: any 6 digits</p>{ae&&<div style={{color:T.rd,fontSize:13,marginBottom:12,textAlign:"center"}}>{ae}</div>}<button onClick={doOTP} style={{...bP,width:"100%"}}>Verify & Create Account</button></>):(<>
            <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>{am==="signup"?"Create Account":"Welcome back"}</h2><p style={{color:T.tx2,fontSize:14,marginBottom:28}}>{am==="signup"?"Start trading with Mobile Money":"Sign in to your account"}</p>
            {am==="signup"&&<><div style={{marginBottom:14}}><label style={lS}>Full Name</label><input style={iS} placeholder="John Doe" value={af.fn} onChange={e=>{setAf(x=>({...x,fn:e.target.value}));setAe("");}}/></div><div style={{marginBottom:14}}><label style={lS}>Phone</label><div style={{display:"flex",gap:8}}><div style={{padding:"12px",borderRadius:10,background:T.bg,border:`1.5px solid ${T.bd}`,fontSize:14,fontWeight:600,color:T.tx2}}>+237</div><input style={iS} placeholder="6XXXXXXXX" maxLength={9} value={af.ph} onChange={e=>{setAf(x=>({...x,ph:e.target.value.replace(/\D/g,"")}));setAe("");}}/></div></div></>}
            <div style={{marginBottom:14}}><label style={lS}>Email</label><input type="email" style={iS} placeholder="you@example.com" value={af.em} onChange={e=>{setAf(x=>({...x,em:e.target.value}));setAe("");}}/></div>
            <div style={{marginBottom:am==="signup"?14:6}}><label style={lS}>Password</label><input type="password" style={iS} placeholder={am==="signup"?"Min. 8 characters":"Password"} value={af.pw} onChange={e=>{setAf(x=>({...x,pw:e.target.value}));setAe("");}}/></div>
            {am==="signup"&&<div style={{marginBottom:14}}><label style={lS}>Confirm Password</label><input type="password" style={iS} placeholder="Repeat" value={af.cpw} onChange={e=>{setAf(x=>({...x,cpw:e.target.value}));setAe("");}}/></div>}
            {am==="login"&&<div style={{textAlign:"right",marginBottom:14}}><span style={{fontSize:13,color:T.pr,cursor:"pointer"}}>Forgot password?</span></div>}
            {am==="signup"&&<div style={{display:"flex",alignItems:"flex-start",gap:8,marginBottom:18,fontSize:12,color:T.tx2}}><input type="checkbox" defaultChecked style={{marginTop:2,accentColor:T.pr}}/><span>I agree to <span style={{color:T.pr}}>Terms</span> & <span style={{color:T.pr}}>Privacy</span></span></div>}
            {ae&&<div style={{color:T.rd,fontSize:13,marginBottom:12,padding:"10px 14px",borderRadius:8,background:T.rdL}}>{ae}</div>}
            <button onClick={doAuth} disabled={al} style={{...bP,width:"100%",opacity:al?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>{al&&<Spin sz={16} c="#fff"/>}{am==="signup"?"Create Account":"Sign In"}</button>
            <p style={{textAlign:"center",marginTop:18,fontSize:14,color:T.tx2}}>{am==="signup"?"Have an account?":"No account?"} <span onClick={()=>{const next=am==="signup"?"login":"signup";setAm(next);setAe("");window.history.pushState(null,"","/"+next);}} style={{color:T.pr,fontWeight:600,cursor:"pointer"}}>{am==="signup"?"Sign In":"Sign Up"}</span></p>
          </>)}
        </div>
      </div>
    </div>
  );

  const NAV=[{id:"dashboard",l:"Dashboard",i:I.dash},{id:"wallet",l:"Wallet",i:I.wall},{id:"exchange",l:"Exchange",i:I.exch},{id:"deposit",l:"Deposit (XAF)",i:I.depX},{id:"crypto-deposit",l:"Crypto Deposit",i:I.cDep},{id:"crypto-withdraw",l:"Crypto Withdraw",i:I.cWd},{id:"withdraw",l:"Withdraw (XAF)",i:I.wdX},{id:"transactions",l:"Transactions",i:I.txn},{id:"profile",l:"Profile",i:I.prof},{id:"support",l:"Support",i:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>},{id:"settings",l:"Settings",i:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>}];

  const allH=coins.map(c=>{const m=gM(c.id);const q=port[c.id]||0;return{...c,sym:m.s,qty:q,valXAF:q*c.current_price*XAF_RATE};});
  const filteredEx=exQ?allH.filter(c=>c.name.toLowerCase().includes(exQ.toLowerCase())||c.sym.toLowerCase().includes(exQ.toLowerCase())):allH;

  // ‚ïê‚ïê‚ïê Sidebar ‚ïê‚ïê‚ïê
  const Sidebar=()=>(<>{isMob&&sideOpen&&<div onClick={()=>setSideOpen(false)} style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",zIndex:49}}/>}<aside style={{width:isMob?260:220,background:T.wh,borderRight:`1px solid ${T.bd}`,display:"flex",flexDirection:"column",position:"fixed",top:0,left:isMob?(sideOpen?0:-270):0,bottom:0,zIndex:50,transition:"left .3s ease"}}>
    <div style={{padding:"20px 20px 24px",display:"flex",alignItems:"center",gap:10,borderBottom:`1px solid ${T.bdL}`}}><div style={{width:34,height:34,borderRadius:10,background:T.pr,display:"flex",alignItems:"center",justifyContent:"center",fontSize:15,fontWeight:900,color:"#fff"}}>$</div><div><div style={{fontSize:16,fontWeight:800}}>CryptoxCore</div><div style={{fontSize:11,color:T.tx3}}>Welcome back</div></div>{isMob&&<div onClick={()=>setSideOpen(false)} style={{marginLeft:"auto",cursor:"pointer",fontSize:20,color:T.tx3}}>‚úï</div>}</div>
    <nav style={{flex:1,padding:"12px 10px",overflowY:"auto",WebkitOverflowScrolling:"touch"}}>{NAV.map(n=>{const a=pg===n.id;return(<div key={n.id} onClick={()=>{setPg(n.id);if(n.id==="deposit")setDS("form");if(n.id==="withdraw")setWS("form");setSideOpen(false);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",borderRadius:10,cursor:"pointer",marginBottom:2,fontSize:13.5,fontWeight:a?600:400,color:a?T.pr:T.tx2,background:a?T.prL:"transparent"}}><span style={{display:"flex",color:a?T.pr:T.tx3}}>{n.i}</span>{n.l}</div>);})}</nav>
    <div style={{padding:"14px 16px",borderTop:`1px solid ${T.bdL}`}}>
      <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}><div style={{width:32,height:32,borderRadius:8,background:T.prL,display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:700,color:T.pr}}>{user.fullName.charAt(0).toUpperCase()}</div><div style={{flex:1,minWidth:0}}><div style={{fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{user.fullName}</div><div style={{fontSize:11,color:T.tx3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{user.email}</div></div></div>
      <div onClick={()=>{setUser(null);setBal(0);setPort({});setTxH([]);setView("landing");localStorage.removeItem("cxc_token");window.history.pushState(null,'','/');setAf({fn:"",em:"",ph:"",pw:"",cpw:""});setOtp(false);}} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 0",cursor:"pointer",fontSize:13,color:T.rd,fontWeight:500}}>{I.out} Logout</div>
    </div>
  </aside></>);

  // ‚ïê‚ïê‚ïê TopBar ‚ïê‚ïê‚ïê
  const TopBar=({title})=>{
    const totalVal=bal+tPV*XAF_RATE;
    return(<header style={{position:"-webkit-sticky",position:"sticky",top:0,zIndex:40,background:"rgba(255,255,255,.95)",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(20px)",borderBottom:"1px solid rgba(0,0,0,.06)",padding:isMob?"0 12px":"0 28px",height:isMob?56:64,display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 1px 3px rgba(0,0,0,.04)"}}>
      <div style={{display:"flex",alignItems:"center",gap:isMob?8:16}}>
        {isMob&&<div onClick={()=>setSideOpen(true)} style={{cursor:"pointer",padding:8,borderRadius:10,background:T.bg,display:"flex",flexDirection:"column",gap:3.5}}>
          <div style={{width:18,height:2,background:T.tx,borderRadius:2}}/>
          <div style={{width:13,height:2,background:T.pr,borderRadius:2}}/>
          <div style={{width:18,height:2,background:T.tx,borderRadius:2}}/>
        </div>}
        <div>
          <h2 style={{fontSize:isMob?15:18,fontWeight:700,lineHeight:1.2}}>{title||"Dashboard"}</h2>
          {!isMob&&<div style={{fontSize:11,color:T.tx3,marginTop:1}}>{new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}</div>}
        </div>
      </div>
      <div style={{display:"flex",alignItems:"center",gap:isMob?6:12}}>
        {/* Balance pill */}
        <div onClick={()=>setPg("wallet")} style={{cursor:"pointer",padding:isMob?"5px 10px":"6px 14px",borderRadius:10,background:"linear-gradient(135deg,#F0FDF4,#ECFDF5)",border:"1px solid #A7F3D0",display:"flex",alignItems:"center",gap:6}}>
          <div style={{width:isMob?6:8,height:isMob?6:8,borderRadius:"50%",background:T.gn,boxShadow:"0 0 6px rgba(16,185,129,.4)"}}/>
          <span style={{fontSize:isMob?11:13,fontWeight:700,color:"#065F46"}}>{fX(totalVal)}</span>
        </div>
        {/* Deposit button */}
        {!isMob&&<div onClick={()=>{setPg("deposit");setDS("form");}} style={{cursor:"pointer",padding:"7px 16px",borderRadius:10,background:"linear-gradient(135deg,#10B981,#059669)",color:"#fff",fontSize:12,fontWeight:700,display:"flex",alignItems:"center",gap:5,boxShadow:"0 2px 8px rgba(16,185,129,.3)"}}>
          <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Deposit
        </div>}
        {/* Notification bell */}
        <div onClick={()=>setPg("transactions")} style={{position:"relative",cursor:"pointer",padding:8,borderRadius:10,background:T.bg,transition:"all .15s"}}>
          <svg width="17" height="17" fill="none" stroke={T.tx2} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
          {txH.length>0&&<div style={{position:"absolute",top:5,right:5,width:8,height:8,borderRadius:4,background:T.rd,border:"2px solid #fff"}}/>}
        </div>
        {/* User avatar */}
        <div onClick={()=>setPg("profile")} style={{display:"flex",alignItems:"center",gap:isMob?0:10,cursor:"pointer",padding:isMob?"0":"4px 10px 4px 4px",borderRadius:12,background:isMob?"transparent":T.bg,transition:"all .15s"}}>
          <div style={{width:isMob?34:36,height:isMob?34:36,borderRadius:isMob?10:10,background:"linear-gradient(135deg,#4361EE,#7C3AED)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:isMob?13:14,fontWeight:800,color:"#fff",boxShadow:"0 2px 8px rgba(67,97,238,.3)",cursor:"pointer"}} data-avatar="1" data-name={user.fullName} data-email={user.email}>{user.fullName.charAt(0).toUpperCase()}</div>
          {!isMob&&<div>
            <div style={{fontSize:13,fontWeight:600,maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{user.fullName}</div>
            <div style={{fontSize:11,color:T.tx3}}>{user.email.length>20?user.email.slice(0,18)+"...":user.email}</div>
          </div>}
        </div>
      </div>
    </header>);
  };

  // ‚ïê‚ïê‚ïê Buy/Sell Modal ‚ïê‚ïê‚ïê
  const ExModal=()=>{if(!exOpen||!exCoin)return null;const c=gC(exCoin);if(!c)return null;const m=gM(exCoin);const p=c.current_price;const a=parseFloat(exAmt)||0;const costXAF=a*p*XAF_RATE;const maxB=p>0?bal/(XAF_RATE*p):0;const maxS=port[exCoin]||0;
    return(<div style={{position:"fixed",inset:0,zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.4)",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(4px)"}} onClick={()=>setExOpen(false)}>
      <div onClick={e=>e.stopPropagation()} style={{background:T.wh,borderRadius:18,width:isMob?"92%":440,maxWidth:440,padding:isMob?20:28,boxShadow:"0 20px 60px rgba(0,0,0,.15)",animation:"fadeUp .25s ease"}}>
        <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:20}}>{c.image&&<img src={c.image} alt="" width={36} height={36} style={{borderRadius:"50%"}}/>}<div><div style={{fontSize:18,fontWeight:800}}>{exDir==="buy"?"Buy":"Sell"} {c.name}</div><div style={{fontSize:13,color:T.tx2}}>{m.s}/USD ¬∑ ${p<1?p.toFixed(4):fmt(p)}</div></div><div style={{marginLeft:"auto",cursor:"pointer",fontSize:20,color:T.tx3}} onClick={()=>setExOpen(false)}>√ó</div></div>
        <div style={{display:"flex",marginBottom:16,borderRadius:10,overflow:"hidden",border:`1px solid ${T.bd}`}}>{["buy","sell"].map(d=>(<button key={d} onClick={()=>{setExDir(d);setExAmt("");}} style={{flex:1,padding:10,border:"none",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:13,textTransform:"capitalize",color:exDir===d?"#fff":T.tx2,background:exDir===d?(d==="buy"?T.gn:T.rd):T.bg}}>{d==="buy"?"+ Buy":"‚Äî Sell"}</button>))}</div>
        <div style={{marginBottom:14}}><label style={lS}>Amount ({m.s})</label><input type="number" value={exAmt} onChange={e=>setExAmt(e.target.value)} placeholder="0.00" style={iS}/><div style={{display:"flex",gap:6,marginTop:6}}>{[25,50,75,100].map(pc=>(<button key={pc} onClick={()=>{const mx=exDir==="buy"?maxB:maxS;setExAmt(mx>0?(mx*pc/100).toFixed(8):"");}} style={{flex:1,border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:6,borderRadius:6,fontSize:11,background:T.bg,color:T.tx2,border:`1px solid ${T.bd}`}}>{pc}%</button>))}</div></div>
        <div style={{padding:14,borderRadius:10,background:T.bg,marginBottom:16}}>{[{l:"Price",v:`$${p<1?p.toFixed(6):fmt(p)} ¬∑ ${fX(p*XAF_RATE)}`},{l:exDir==="buy"?"Total Cost":"You Receive",v:fX(costXAF),b:1,c:exDir==="buy"?T.tx:T.gn},{l:"Available",v:exDir==="buy"?fX(bal):`${maxS.toFixed(8)} ${m.s}`}].map((r,i)=>(<div key={i} style={{display:"flex",justifyContent:"space-between",padding:"5px 0",fontSize:13}}><span style={{color:T.tx2}}>{r.l}</span><span style={{fontWeight:r.b?700:400,color:r.c||T.tx}}>{r.v}</span></div>))}</div>
        <button onClick={doExchange} disabled={exProc} style={{...bP,width:"100%",background:exDir==="buy"?T.gn:T.rd,display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:exProc?.7:1}}>{exProc&&<Spin sz={16} c="#fff"/>}{exDir==="buy"?`Buy ${m.s}`:`Sell ${m.s}`}</button>
      </div>
    </div>);
  };

  // ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê
  const Dashboard=()=>{
    const slides=[{bg:"linear-gradient(135deg,#1a1a2e,#0f3460)",t:"Buy and sell your crypto with fauscrypto",s:"Trade securely with MTN MoMo & Orange Money"},{bg:"linear-gradient(135deg,#0f4c75,#3282b8)",t:"Instant deposits with Mobile Money",s:"$1 = 530 XAF ¬∑ Start trading in seconds"},{bg:"linear-gradient(135deg,#2d3436,#636e72)",t:"14+ Cryptocurrencies Available",s:"Bitcoin, Ethereum, Solana, and more"}];
    return(<div>
      <div style={{background:T.pr,color:"#fff",overflow:"hidden",height:34,display:"flex",alignItems:"center",fontSize:13,fontWeight:600,letterSpacing:".3px",marginBottom:20,borderRadius:8}}><div style={{display:"flex",animation:"ticker 20s linear infinite",whiteSpace:"nowrap"}}>{Array(6).fill(0).map((_,i)=><span key={i} style={{padding:"0 40px"}}>{promo||"Buy and Sell Your Crypto With Fauscrypto.com"}</span>)}</div></div>
      <div style={{position:"relative",height:200,borderRadius:14,overflow:"hidden",marginBottom:28}}>{slides.map((s,i)=>(<div key={i} style={{position:"absolute",inset:0,background:s.bg,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"opacity .6s",opacity:hero===i?1:0}}><h2 style={{fontSize:28,fontWeight:800,color:"#fff",textAlign:"center",marginBottom:8,textShadow:"0 2px 8px rgba(0,0,0,.3)"}}>{s.t}</h2><p style={{fontSize:14,color:"rgba(255,255,255,.8)",marginBottom:16}}>{s.s}</p><button style={{padding:"10px 28px",borderRadius:10,border:"2px solid #fff",background:"rgba(255,255,255,.15)",color:"#fff",fontFamily:f,fontWeight:600,cursor:"pointer"}}>Learn More</button></div>))}<div style={{position:"absolute",bottom:12,left:"50%",transform:"translateX(-50%)",display:"flex",gap:8}}>{slides.map((_,i)=><div key={i} onClick={()=>setHero(i)} style={{width:8,height:8,borderRadius:"50%",background:hero===i?"#fff":"rgba(255,255,255,.4)",cursor:"pointer"}}/>)}</div></div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Welcome back, {user.fullName}!</h2><p style={{color:T.tx2,fontSize:14,marginBottom:24}}>Here's your portfolio overview</p>
      <div style={{background:"linear-gradient(135deg,#4361EE,#6366F1)",borderRadius:14,padding:isMob?"20px 16px":"24px 28px",color:"#fff",position:"relative",overflow:"hidden",marginBottom:28}}><div><div style={{fontSize:14,opacity:.85,marginBottom:4}}>Total Portfolio Worth</div><div style={{fontSize:34,fontWeight:800}}>{fX(bal+tPV*XAF_RATE)}</div><div style={{fontSize:13,opacity:.75,marginTop:4}}>Deposit Balance: {fX(bal)}</div></div><div style={{position:"absolute",right:20,top:"50%",transform:"translateY(-50%)",width:52,height:52,borderRadius:"50%",background:"rgba(255,255,255,.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24}}>$</div></div>
      {/* Quick Actions */}
      <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:10,marginBottom:24,marginTop:24}}>
        <div onClick={()=>setPg("deposit")} style={{textAlign:"center",cursor:"pointer",padding:"14px 0",borderRadius:12,background:"#16A34A12",border:"1px solid #16A34A25"}}>
          <div style={{width:36,height:36,borderRadius:"50%",background:"#16A34A",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 6px",fontSize:16,fontWeight:700}}>+</div>
          <div style={{fontSize:12,fontWeight:600,color:"#16A34A"}}>Deposit</div>
        </div>
        <div onClick={()=>setPg("withdraw")} style={{textAlign:"center",cursor:"pointer",padding:"14px 0",borderRadius:12,background:"#EF444412",border:"1px solid #EF444425"}}>
          <div style={{width:36,height:36,borderRadius:"50%",background:"#EF4444",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 6px",fontSize:16,fontWeight:700}}>-</div>
          <div style={{fontSize:12,fontWeight:600,color:"#EF4444"}}>Withdraw</div>
        </div>
        <div onClick={()=>setPg("exchange")} style={{textAlign:"center",cursor:"pointer",padding:"14px 0",borderRadius:12,background:"#4361EE12",border:"1px solid #4361EE25"}}>
          <div style={{width:36,height:36,borderRadius:"50%",background:"#4361EE",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 6px",fontSize:16,fontWeight:700}}>$</div>
          <div style={{fontSize:12,fontWeight:600,color:"#4361EE"}}>Trade</div>
        </div>
        <div onClick={()=>setPg("crypto-withdraw")} style={{textAlign:"center",cursor:"pointer",padding:"14px 0",borderRadius:12,background:"#F59E0B12",border:"1px solid #F59E0B25"}}>
          <div style={{width:36,height:36,borderRadius:"50%",background:"#F59E0B",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 6px",fontSize:16,fontWeight:700}}>{">"}</div>
          <div style={{fontSize:12,fontWeight:600,color:"#F59E0B"}}>Send</div>
        </div>
      </div>
      <div style={cd}><div style={{padding:"18px 24px",borderBottom:`1px solid ${T.bd}`}}><h3 style={{fontSize:18,fontWeight:800}}>Your Portfolio</h3><p style={{fontSize:13,color:T.tx3,marginTop:2}}>View all your cryptocurrency holdings</p></div><div style={{display:"grid",gridTemplateColumns:"2fr 1fr",padding:"10px 24px",borderBottom:`1px solid ${T.bd}`,fontSize:12,fontWeight:600,color:T.tx3,textTransform:"uppercase",letterSpacing:".5px"}}><span>Cryptocurrency</span><span style={{textAlign:"right"}}>Balance</span></div>{ld?<div style={{padding:40,textAlign:"center"}}><Spin/></div>:allH.map(h=>(<div key={h.id} style={{display:"grid",gridTemplateColumns:"2fr 1fr",padding:"14px 24px",borderBottom:`1px solid ${T.bdL}`,alignItems:"center",cursor:"pointer"}} onMouseEnter={e=>e.currentTarget.style.background=T.bg} onMouseLeave={e=>e.currentTarget.style.background="transparent"} onClick={()=>{setExCoin(h.id);setExDir("buy");setExAmt("");setExPg("buy");window.history.pushState(null,"","/exchange/buy/"+h.id);}}><div style={{display:"flex",alignItems:"center",gap:12}}>{h.image&&<img src={h.image} alt="" width={34} height={34} style={{borderRadius:"50%"}}/>}<div><div style={{fontSize:14,fontWeight:600}}>{h.name} ({h.sym.toLowerCase()})</div><div style={{fontSize:12,color:T.tx3}}>{h.sym}</div></div></div><div style={{textAlign:"right"}}><div style={{fontSize:14,fontWeight:700,fontFeatureSettings:"'tnum'"}}>{h.qty.toFixed(8)}</div><div style={{fontSize:12,color:T.tx3}}>= {fX(h.valXAF)}</div></div></div>))}</div>
    </div>);
  };

  // ‚ïê‚ïê‚ïê WALLET (same as before) ‚ïê‚ïê‚ïê
  const Wallet=()=>{
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};
    const deps=txH.filter(t=>t.type==="deposit");
    const wds=txH.filter(t=>t.type==="withdraw");
    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>My Wallet</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:24}}>View your wallet balance and deposit history</p>

      {/* Balance Card */}
      <div style={{background:"linear-gradient(135deg,#4361EE,#6366F1)",borderRadius:14,padding:isMob?"20px 16px":"24px 28px",color:"#fff",marginBottom:24,position:"relative",overflow:"hidden"}}>
        <div style={{fontSize:13,opacity:.85,marginBottom:4}}>Current Balance</div>
        <div style={{fontSize:36,fontWeight:800,marginBottom:6}}>{fX(bal)}</div>
        <div style={{fontSize:13,opacity:.75,marginBottom:18}}>Available funds for trading and withdrawals</div>
        <div style={{display:"flex",gap:12}}>
          <button onClick={()=>setPg("deposit")} style={{flex:1,padding:"12px 0",borderRadius:10,border:"2px solid rgba(255,255,255,.4)",background:"rgba(255,255,255,.15)",color:"#fff",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>+ Deposit</button>
          <button onClick={()=>setPg("withdraw")} style={{flex:1,padding:"12px 0",borderRadius:10,border:"none",background:"rgba(255,255,255,.25)",color:"#fff",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>Withdraw</button>
        </div>
      </div>

      {/* Deposit Transactions */}
      <div style={{...sCard,marginBottom:20}}>
        <div style={{padding:"18px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid "+T.bd}}>
          <h3 style={{fontSize:18,fontWeight:700}}>Deposit Transactions</h3>
          <button onClick={()=>setPg("deposit")} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:12,padding:"8px 18px",borderRadius:10,background:"linear-gradient(135deg,#4361EE,#5B6CF0)",color:"#fff",boxShadow:"0 2px 8px rgba(67,97,238,.25)",transition:"all .2s"}}>Add Money</button>
        </div>
        {deps.length===0?
          <div style={{padding:"48px 20px",textAlign:"center"}}>
            <svg width="48" height="48" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 12px"}}><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
            <div style={{fontSize:15,fontWeight:600,color:T.tx2}}>No deposit transactions yet</div>
            <div style={{fontSize:13,color:T.tx3,marginTop:4,marginBottom:16}}>Start by adding money to your wallet</div>
            <button onClick={()=>setPg("deposit")} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:13,padding:"10px 24px",borderRadius:8,background:T.pr,color:"#fff"}}>Add Money</button>
          </div>:<div style={{overflowX:"auto",WebkitOverflowScrolling:"touch"}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontFamily:f}}>
            <thead><tr style={{background:"#FAFBFD"}}>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Date</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Reference</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Amount</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Status</th>
            </tr></thead>
            <tbody>{deps.slice(0,15).map((tx,i)=>{const ref=tx.method&&tx.method.includes("fapshi:")?tx.method.split(":")[1]:("TX"+tx.id);const dt=new Date(tx.date);const ds=dt.getFullYear()+"-"+String(dt.getMonth()+1).padStart(2,"0")+"-"+String(dt.getDate()).padStart(2,"0")+" "+String(dt.getHours()).padStart(2,"0")+":"+String(dt.getMinutes()).padStart(2,"0");return(
              <tr key={i} style={{borderBottom:"1px solid #F8F8F8",transition:"background .15s"}} onMouseEnter={e=>e.currentTarget.style.background="#FAFBFD"} onMouseLeave={e=>e.currentTarget.style.background=""}>
                <td style={{padding:"14px 20px",fontSize:12,color:"#9CA3AF",whiteSpace:"nowrap"}}>{ds}</td>
                <td style={{padding:"14px 20px",fontSize:13,fontWeight:600,color:"#111827",fontFamily:"'SF Mono',Consolas,monospace"}}>{ref}</td>
                <td style={{padding:"14px 20px",fontSize:14,fontWeight:700,color:"#059669",whiteSpace:"nowrap"}}>{Math.round(tx.xaf||tx.tXAF||0).toLocaleString("fr-CM")+".00 XAF"}</td>
                <td style={{padding:"14px 20px"}}><span style={{display:"inline-flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:.3,background:tx.status==="completed"?"rgba(16,185,129,.08)":"rgba(245,158,11,.08)",color:tx.status==="completed"?"#059669":"#D97706"}}>{tx.status==="completed"?"SUCCESSFUL":tx.status?.toUpperCase()||"PENDING"}</span></td>
              </tr>);})}</tbody>
          </table></div>
        }
      </div>

      {/* Withdrawal Transactions */}
      <div style={sCard}>
        <div style={{padding:"18px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid "+T.bd}}>
          <h3 style={{fontSize:18,fontWeight:700}}>Withdrawal Transactions</h3>
          <button onClick={()=>setPg("withdraw")} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:700,fontSize:12,padding:"8px 18px",borderRadius:10,background:"linear-gradient(135deg,#16A34A,#22C55E)",color:"#fff",boxShadow:"0 2px 8px rgba(22,163,74,.25)",transition:"all .2s"}}>Withdraw</button>
        </div>
        {wds.length===0?
          <div style={{padding:"48px 20px",textAlign:"center"}}>
            <svg width="48" height="48" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 12px"}}><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            <div style={{fontSize:15,fontWeight:600,color:T.tx2}}>No withdrawal transactions yet</div>
            <div style={{fontSize:13,color:T.tx3,marginTop:4}}>Withdrawals will appear here</div>
          </div>:<div style={{overflowX:"auto",WebkitOverflowScrolling:"touch"}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontFamily:f}}>
            <thead><tr style={{background:"#FAFBFD"}}>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Date</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Reference</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Amount</th>
              <th style={{padding:"12px 20px",fontSize:11,fontWeight:600,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:.5,textAlign:"left",borderBottom:"1px solid #F0F0F0"}}>Status</th>
            </tr></thead>
            <tbody>{wds.slice(0,15).map((tx,i)=>{const ref=tx.method&&tx.method.includes("fapshi:")?tx.method.split(":")[1]:("WD"+tx.id);const dt=new Date(tx.date);const ds=dt.getFullYear()+"-"+String(dt.getMonth()+1).padStart(2,"0")+"-"+String(dt.getDate()).padStart(2,"0")+" "+String(dt.getHours()).padStart(2,"0")+":"+String(dt.getMinutes()).padStart(2,"0");return(
              <tr key={i} style={{borderBottom:"1px solid #F8F8F8",transition:"background .15s"}} onMouseEnter={e=>e.currentTarget.style.background="#FAFBFD"} onMouseLeave={e=>e.currentTarget.style.background=""}>
                <td style={{padding:"14px 20px",fontSize:12,color:"#9CA3AF",whiteSpace:"nowrap"}}>{ds}</td>
                <td style={{padding:"14px 20px",fontSize:13,fontWeight:600,color:"#111827",fontFamily:"'SF Mono',Consolas,monospace"}}>{ref}</td>
                <td style={{padding:"14px 20px",fontSize:14,fontWeight:700,color:"#D97706",whiteSpace:"nowrap"}}>{"-"+Math.round(tx.xaf||tx.tXAF||0).toLocaleString("fr-CM")+".00 XAF"}</td>
                <td style={{padding:"14px 20px"}}><span style={{display:"inline-flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:.3,background:tx.status==="completed"?"rgba(16,185,129,.08)":"rgba(245,158,11,.08)",color:tx.status==="completed"?"#059669":"#D97706"}}>{tx.status==="completed"?"SUCCESSFUL":tx.status?.toUpperCase()||"PENDING"}</span></td>
              </tr>);})}</tbody>
          </table></div>
        }
      </div>

      {/* Quick Stats */}
      <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:12,marginTop:20}}>
        <div style={{...sCard,padding:"16px",textAlign:"center"}}><div style={{fontSize:11,color:T.tx3,marginBottom:4}}>Total Deposits</div><div style={{fontSize:16,fontWeight:800,color:T.gn}}>{fX(deps.reduce((s,t)=>s+(t.xaf||t.tXAF||0),0))}</div></div>
        <div style={{...sCard,padding:"16px",textAlign:"center"}}><div style={{fontSize:11,color:T.tx3,marginBottom:4}}>Total Withdrawals</div><div style={{fontSize:16,fontWeight:800,color:T.am}}>{fX(wds.reduce((s,t)=>s+(t.xaf||t.tXAF||0),0))}</div></div>
        <div style={{...sCard,padding:"16px",textAlign:"center"}}><div style={{fontSize:11,color:T.tx3,marginBottom:4}}>Transactions</div><div style={{fontSize:16,fontWeight:800,color:T.pr}}>{deps.length+wds.length}</div></div>
      </div>
    </div>);
  };


  // ‚ïê‚ïê‚ïê BUY/SELL PAGE ‚ïê‚ïê‚ïê
  const BuySellPage=()=>{
    const coin=gC(exCoin);if(!coin)return(<div><p>Loading...</p></div>);
    const isBuy=exDir==="buy";
    const p=coin.current_price;const pXAF=p*XAF_RATE;
    const xafAmt=parseFloat(exAmt)||0;
    const cryptoAmt=pXAF>0?xafAmt/pXAF:0;
    const maxBuy=pXAF>0?bal/pXAF:0;
    const held=port[exCoin]||0;const maxSell=held;
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};

    const doTrade=async()=>{
      const qty=isBuy?cryptoAmt:parseFloat(exAmt)||0;
      if(isBuy){if(xafAmt<1)return sT("Enter an amount","err");if(xafAmt>bal)return sT("Insufficient balance","err");if(qty<=0)return sT("Amount too small","err");}
      else{if(qty<=0)return sT("Enter a quantity","err");if(parseFloat(qty.toFixed(8))>parseFloat(held.toFixed(8)))return sT("Insufficient crypto balance","err");}
      try{
        const endpoint=isBuy?"/exchange/buy":"/exchange/sell";
        const body={coinId:exCoin,quantity:parseFloat(qty.toFixed(8))};
        const resp=await API(endpoint,{method:"POST",body:JSON.stringify(body)});
        sT(isBuy?("Bought "+qty.toFixed(6)+" "+coin.symbol.toUpperCase()+" successfully!"):("Sold "+qty.toFixed(6)+" "+coin.symbol.toUpperCase()+" successfully!"));
        if(resp.balance!==undefined)setBal(resp.balance);
        if(resp.portfolio)setPort(resp.portfolio);
        try{const tx=await API("/transactions");setTxH(tx.transactions||[]);}catch{}
        setExAmt("");setExPg(null);setPg("exchange");window.history.pushState(null,"","/exchange");
      }catch(e){sT(e.message||"Trade failed","err");}
    };

    return(<div style={{maxWidth:520}}>
      {/* Back link */}
      <div onClick={()=>{setExPg(null);setPg("exchange");window.history.pushState(null,"","/exchange");}} style={{display:"flex",alignItems:"center",gap:6,cursor:"pointer",color:T.pr,fontSize:14,fontWeight:600,marginBottom:16}}>
        <span style={{fontSize:18}}>{"<"}</span> Back to Exchange
      </div>

      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>{isBuy?"Buy":"Sell"} {coin.name} ({coin.symbol.toUpperCase()})</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:24}}>{isBuy?"Purchase cryptocurrency using your XAF deposit balance":"Sell cryptocurrency for XAF balance"}</p>

      <div style={{...sCard,padding:28}}>
        {/* Coin info header */}
        <div style={{display:"flex",alignItems:"center",gap:14,padding:"16px 20px",background:"#F0F4FF",borderRadius:12,marginBottom:20}}>
          {coin.image&&<img src={coin.image} alt="" width={44} height={44} style={{borderRadius:"50%"}}/>}
          <div>
            <div style={{fontSize:16,fontWeight:700}}>{coin.name}</div>
            <div style={{fontSize:13,color:T.tx2}}>1 {coin.symbol.toUpperCase()} = {Math.round(pXAF).toLocaleString()} XAF</div>
          </div>
        </div>

        {/* Available Balance */}
        <div style={{padding:"14px 20px",background:isBuy?"#F0FDF4":"#FFF7ED",borderRadius:10,marginBottom:20}}>
          <div style={{fontSize:12,color:T.tx2}}>Available Balance</div>
          <div style={{fontSize:20,fontWeight:800,color:isBuy?T.gn:T.am}}>{isBuy?fX(bal):(parseFloat(held.toFixed(8))+" "+coin.symbol.toUpperCase())}</div>
        </div>

        {/* Amount Input */}
        <label style={lS}>{isBuy?"XAF Amount":"Quantity ("+coin.symbol.toUpperCase()+")"} <span style={{color:T.rd}}>*</span></label>
        <div style={{position:"relative",marginBottom:6}}>
          <input type="number" style={{...iS,fontSize:18,fontWeight:700,paddingRight:50}} placeholder={isBuy?"Enter XAF amount":"Enter quantity"} value={exAmt} onChange={e=>setExAmt(e.target.value)}/>
          <div style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",width:36,height:36,borderRadius:8,background:T.pr,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",fontSize:14,fontWeight:700}} onClick={()=>{if(isBuy)setExAmt(String(Math.floor(bal)));else setExAmt(parseFloat(held.toFixed(8)).toString());}}>Max</div>
        </div>
        <div style={{fontSize:13,color:T.tx2,marginBottom:20}}>
          {isBuy?("You will receive "+cryptoAmt.toFixed(6)+" "+coin.symbol.toUpperCase()):("You will receive "+fX(Math.round((parseFloat(exAmt)||0)*pXAF)))}
        </div>

        {/* Quick amounts */}
        {isBuy&&<div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:20}}>{[1000,5000,10000,25000].map(v=>(<button key={v} onClick={()=>setExAmt(String(v))} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:10,borderRadius:8,fontSize:12,background:parseInt(exAmt)===v?T.gnL:T.bg,color:parseInt(exAmt)===v?T.gn:T.tx2,border:"1px solid "+(parseInt(exAmt)===v?"#16A34A40":T.bd)}}>{v>=1000?(v/1000)+"K":v}</button>))}</div>}
        {!isBuy&&<div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:20}}>{[25,50,75,100].map(p=>{const v=parseFloat((held*p/100).toFixed(8)).toString();return(<button key={p} onClick={()=>setExAmt(v)} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:10,borderRadius:8,fontSize:12,background:T.bg,color:T.tx2,border:"1px solid "+T.bd}}>{p}%</button>);})}</div>}

        {/* Trade button */}
        <button onClick={doTrade} style={{...bP,width:"100%",padding:14,fontSize:16,borderRadius:12,background:isBuy?"linear-gradient(135deg,#16A34A,#22C55E)":"linear-gradient(135deg,#EF4444,#F87171)",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
          + {isBuy?"Buy":"Sell"} {coin.symbol.toUpperCase()}
        </button>

        {/* Price info */}
        <div style={{marginTop:16,padding:"12px 16px",background:T.bg,borderRadius:8,fontSize:12,color:T.tx3}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span>Price (USD)</span><span style={{fontWeight:600}}>${p.toLocaleString()}</span></div>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span>Price (XAF)</span><span style={{fontWeight:600}}>{Math.round(pXAF).toLocaleString()} XAF</span></div>
          <div style={{display:"flex",justifyContent:"space-between"}}><span>Your Holdings</span><span style={{fontWeight:600}}>{parseFloat(held.toFixed(8))} {coin.symbol.toUpperCase()}</span></div>
        </div>
      </div>
    </div>);
  };

// ‚ïê‚ïê‚ïê EXCHANGE (matching screenshot exactly) ‚ïê‚ïê‚ïê
  const Exchange=()=>(<div>
    <h2 style={{fontSize:26,fontWeight:800,marginBottom:20}}>Exchange</h2>
    {/* 3 action buttons */}
    <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr 1fr",gap:10,marginBottom:24}}>
      <button onClick={()=>setPg("crypto-deposit")} style={{...bP,background:T.gn,padding:"14px",display:"flex",alignItems:"center",justifyContent:"center",gap:8,borderRadius:12}}>+ Crypto Deposit</button>
      <button onClick={()=>setPg("crypto-withdraw")} style={{...bP,background:T.pr,padding:"14px",display:"flex",alignItems:"center",justifyContent:"center",gap:8,borderRadius:12}}>{I.cWd} Crypto Withdraw</button>
      <button onClick={()=>setPg("transactions")} style={{...bO,padding:"14px",display:"flex",alignItems:"center",justifyContent:"center",gap:8,borderRadius:12,background:T.wh}}>{I.hist} History</button>
    </div>
    {/* Search */}
    <div style={{position:"relative",marginBottom:24}}><div style={{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)"}}>{I.search}</div><input value={exQ} onChange={e=>setExQ(e.target.value)} placeholder="Search cryptocurrencies by name or symbol..." style={{...iS,paddingLeft:42,borderRadius:12}}/></div>
    <h3 style={{fontSize:16,fontWeight:800,marginBottom:16}}>Available Cryptocurrencies</h3>
    {/* Coin cards grid - matches screenshot */}
    {ld?<div style={{padding:40,textAlign:"center"}}><Spin/></div>:
    <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr",gap:14}}>
      {filteredEx.map(c=>{const m=gM(c.id);return(
        <div key={c.id} style={{...cd,padding:"18px 20px"}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}>
            <div style={{display:"flex",alignItems:"center",gap:10}}>{c.image&&<img src={c.image} alt="" width={36} height={36} style={{borderRadius:"50%"}}/>}<div><div style={{fontSize:14,fontWeight:700}}>{c.name}</div><div style={{fontSize:12,color:T.tx3}}>{m.s}</div></div></div>
            <div style={{textAlign:"right"}}><div style={{fontSize:14,fontWeight:700,fontFeatureSettings:"'tnum'"}}>{c.qty.toFixed(8)}</div><div style={{fontSize:12,color:T.tx3}}>= {fX(c.valXAF)}</div></div>
          </div>
          <div style={{display:"flex",gap:8}}>
            <button onClick={()=>{setExCoin(c.id);setExDir("buy");setExAmt("");setExPg("buy");window.history.pushState(null,"","/exchange/buy/"+c.id);}} style={{...bP,flex:1,background:T.gn,padding:"10px",borderRadius:8,fontSize:13}}>+ Buy</button>
            <button onClick={()=>{setExCoin(c.id);setExDir("sell");setExAmt("");setExPg("sell");window.history.pushState(null,"","/exchange/sell/"+c.id);}} style={{...bO,flex:1,padding:"10px",borderRadius:8,fontSize:13,background:T.wh,color:T.tx2,borderColor:T.bd}}>‚Äî Sell</button>
          </div>
        </div>
      );})}
    </div>}
  </div>);

  // ‚ïê‚ïê‚ïê CRYPTO DEPOSIT (Binance Integration) ‚ïê‚ïê‚ïê
  const CryptoDep=()=>{
    const filtCD=cdQ?coins.filter(c2=>c2.name.toLowerCase().includes(cdQ.toLowerCase())||gM(c2.id).s.toLowerCase().includes(cdQ.toLowerCase())):coins;
    const selC=cdC?gC(cdC):null;const selM=cdC?gM(cdC):null;

    // Fetch networks when coin selected
    const fetchNetworks=async(coinSym)=>{
      try{const d=await API("/crypto/networks/"+coinSym);setCdNets(d.networks||[]);if(d.networks&&d.networks.length>0)setCdNet(d.networks[0].network);}catch(e){sT("Failed to load networks","err");setCdNets([]);}
    };
    // Get deposit address
    const getAddress=async()=>{
      if(!selM||!cdNet)return;setCdAddrLoading(true);
      try{const d=await API("/crypto/deposit-address",{method:"POST",body:JSON.stringify({coin:selM.s,network:cdNet})});setCdAddr(d.address);
      }catch(e){sT(e.message||"Failed to get address","err");}setCdAddrLoading(false);
    };
    // Create invoice
    const createInvoice=async()=>{
      if(!cdAmt||parseFloat(cdAmt)<=0)return sT("Enter deposit amount","err");
      if(!cdAddr)return sT("Get deposit address first","err");
      try{
        const d=await API("/crypto/create-invoice",{method:"POST",body:JSON.stringify({coin:selM.s,network:cdNet,amount:parseFloat(cdAmt),address:cdAddr})});
        setCdInvoice(d);setCdStatus({status:"pending",confirmations:0,requiredConfirmations:d.requiredConfirmations});
        sT("Invoice created! Send crypto to the address below.");
      }catch(e){sT(e.message||"Failed","err");}
    };
    // Poll for deposit status
    const checkStatus=async()=>{
      if(!cdInvoice)return;setCdPolling(true);
      try{const d=await API("/crypto/check-deposit/"+cdInvoice.invoiceId);setCdStatus(d);
        if(d.status==="completed"){sT("Deposit confirmed and credited!");
          // Refresh portfolio
          try{const me=await API("/auth/me");setPort(me.portfolio||{});setBal(me.user.balance);const tx=await API("/transactions");setTxH(tx.transactions||[]);}catch{}
        }
      }catch(e){}setCdPolling(false);
    };
    // Auto-poll every 15s when invoice active
    useEffect(()=>{if(!cdInvoice||cdStatus?.status==="completed")return;const iv=setInterval(checkStatus,15000);return()=>clearInterval(iv);},[cdInvoice,cdStatus?.status]);

    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};
    const netInfo=cdNets.find(n=>n.network===cdNet);
    const stepsDone=cdStatus?.status==="completed"?3:cdStatus?.status==="confirming"?2:cdStatus?.confirmations>0?1:0;

    // Invoice view (after creating)
    if(cdInvoice){return(<div>
      <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:24}}>
        <div onClick={()=>{setCdInvoice(null);setCdStatus(null);setCdAmt("");}} style={{cursor:"pointer",padding:8,borderRadius:10,background:T.bg,display:"flex"}}>
          <svg width="18" height="18" fill="none" stroke={T.tx} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
        </div>
        <h2 style={{fontSize:22,fontWeight:800}}>Deposit Invoice</h2>
      </div>
      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 340px",gap:20,alignItems:"start"}}>
        <div style={{...sCard,padding:0}}>
          {/* Invoice header */}
          <div style={{padding:"20px 28px",borderBottom:"1px solid "+T.bd,display:"flex",alignItems:"center",gap:10}}>
            <div style={{fontSize:20}}>üìã</div>
            <div><div style={{fontSize:16,fontWeight:700,color:T.gn}}>Deposit Invoice Created</div><div style={{fontSize:12,color:T.tx2}}>Send exactly {cdInvoice.amount} {cdInvoice.coin} to the address below</div></div>
          </div>
          {/* Invoice details */}
          <div style={{padding:"20px 28px"}}>
            {[{l:"Currency",v:cdInvoice.coin},{l:"Network",v:cdInvoice.networkName||cdInvoice.network},{l:"Amount",v:cdInvoice.amount+" "+cdInvoice.coin}].map((r,i)=>(
              <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"10px 0",borderBottom:"1px solid "+T.bdL,fontSize:14}}>
                <span style={{color:T.tx2}}>{r.l}</span><span style={{fontWeight:700}}>{r.v}</span>
              </div>
            ))}
            {/* QR Code */}
            <div style={{textAlign:"center",margin:"24px 0"}}>
              <img src={"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data="+encodeURIComponent(cdInvoice.address)} alt="QR" style={{width:180,height:180,borderRadius:12,border:"4px solid "+T.bd}}/>
              <div style={{fontSize:12,color:T.tx2,marginTop:8}}>Scan QR code with your wallet app</div>
            </div>
            {/* Address */}
            <div style={{marginBottom:16}}>
              <div style={{fontSize:12,color:T.tx2,marginBottom:6}}>Deposit Address ({cdInvoice.networkName||cdInvoice.network})</div>
              <div style={{display:"flex",alignItems:"center",gap:8}}>
                <div style={{flex:1,padding:"12px 14px",borderRadius:10,background:T.bg,border:"1px solid "+T.bd,fontSize:13,fontWeight:600,wordBreak:"break-all",fontFamily:"monospace"}}>{cdInvoice.address}</div>
                <div onClick={()=>{navigator.clipboard?.writeText(cdInvoice.address);sT("Address copied!");}} style={{cursor:"pointer",padding:10,borderRadius:10,background:T.bg,border:"1px solid "+T.bd,display:"flex"}}>
                  <svg width="18" height="18" fill="none" stroke={T.tx2} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                </div>
              </div>
            </div>
            {/* Live status */}
            <div style={{padding:"16px 20px",borderRadius:12,background:cdStatus?.status==="completed"?"#ECFDF5":cdStatus?.status==="confirming"?"#EFF6FF":"#FFFBEB",border:"1px solid "+(cdStatus?.status==="completed"?"#A7F3D0":cdStatus?.status==="confirming"?"#BFDBFE":"#FDE68A")}}>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}>
                <div style={{display:"flex",alignItems:"center",gap:8}}>
                  <div style={{fontSize:18}}>{cdStatus?.status==="completed"?"‚úÖ":cdStatus?.status==="confirming"?"‚è≥":"üì°"}</div>
                  <span style={{fontSize:14,fontWeight:700}}>{cdStatus?.status==="completed"?"Deposit Confirmed!":cdStatus?.status==="confirming"?"Confirming...":"Waiting for Transaction..."}</span>
                </div>
                <span style={{padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:700,background:cdStatus?.status==="completed"?T.gn+"18":"#F59E0B18",color:cdStatus?.status==="completed"?T.gn:"#F59E0B"}}>{cdStatus?.status==="completed"?"Confirmed":cdPolling?"Scanning":"Waiting"}</span>
              </div>
              {/* Status info */}
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:12}}>
                <div style={{textAlign:"center"}}><div style={{fontSize:12,color:T.tx3}}>Status</div><div style={{fontSize:14,fontWeight:700,textTransform:"capitalize"}}>{cdStatus?.status||"Pending"}</div></div>
                <div style={{textAlign:"center"}}><div style={{fontSize:12,color:T.tx3}}>Confirmations</div><div style={{fontSize:14,fontWeight:700}}>{cdStatus?.confirmations||0} / {cdStatus?.requiredConfirmations||3}</div></div>
                <div style={{textAlign:"center"}}><div style={{fontSize:12,color:T.tx3}}>Network</div><div style={{fontSize:14,fontWeight:700}}>{cdInvoice.network}</div></div>
              </div>
              {/* Progress bar */}
              <div style={{display:"flex",gap:4,marginBottom:8}}>{["Detected","Confirming","Confirmed"].map((s,i)=>(<div key={i} style={{flex:1,height:4,borderRadius:2,background:i<stepsDone?T.gn:i===stepsDone&&cdStatus?.status!=="pending"?"#F59E0B":"#E5E7EB",transition:"background .3s"}}/>))}</div>
              <div style={{display:"flex",justifyContent:"space-between",fontSize:10,color:T.tx3}}><span>Detected</span><span>Confirming</span><span>Confirmed</span></div>
            </div>
            {cdStatus?.txHash&&<div style={{marginTop:12,fontSize:12,color:T.tx2}}>TX: <span style={{fontFamily:"monospace",fontSize:11}}>{cdStatus.txHash.slice(0,20)}...{cdStatus.txHash.slice(-10)}</span></div>}
            <button onClick={checkStatus} disabled={cdPolling} style={{...bO,width:"100%",marginTop:16,opacity:cdPolling?.6:1}}>{cdPolling?<><Spin sz={14}/> Checking...</>:"‚Üª Check Status Now"}</button>
            {/* Warning */}
            <div style={{marginTop:16,padding:"12px 16px",borderRadius:10,background:"#FEF3C7",border:"1px solid #FDE68A",fontSize:12,display:"flex",gap:8}}>
              <span style={{fontSize:16}}>‚ö†</span>
              <div><strong>Important:</strong> Only send <strong>{cdInvoice.coin}</strong> on the <strong>{cdInvoice.networkName||cdInvoice.network}</strong> network to this address. Sending other assets or using a different network may result in permanent loss.</div>
            </div>
          </div>
        </div>
        {/* Right: Recent deposits */}
        <div>
          <div style={{...sCard,padding:20,marginBottom:16}}>
            <div style={{padding:"12px 16px",borderRadius:10,background:"#EFF6FF",border:"1px solid #BFDBFE",marginBottom:0}}>
              <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                <span style={{color:"#3B82F6"}}>‚úì</span>
                <span style={{fontSize:13,fontWeight:600}}>Deposit invoice created!</span>
              </div>
              <div style={{fontSize:12,color:T.tx2,lineHeight:1.5}}>Send exactly {cdInvoice.amount} {cdInvoice.coin} to the address below. Your deposit will be detected and confirmed automatically once the transaction appears on the blockchain.</div>
            </div>
          </div>
          <div style={sCard}>
            <div style={{padding:"14px 20px",borderBottom:"1px solid "+T.bd}}><h3 style={{fontSize:15,fontWeight:700}}>Recent Crypto Deposits</h3></div>
            {txH.filter(t=>t.type==="crypto_dep").length===0?
              <div style={{padding:24,textAlign:"center",fontSize:13,color:T.tx3}}>No crypto deposits yet</div>:
              txH.filter(t=>t.type==="crypto_dep").slice(0,8).map((tx,i)=>{
                const dt=new Date(tx.date);const dateStr=dt.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});
                const isPending=tx.status!=="completed";
                return(
                <div key={i} style={{padding:"14px 20px",borderBottom:"1px solid "+T.bdL}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}>
                    <div>
                      <div style={{fontSize:13,color:T.tx2,marginBottom:2}}>{dateStr}</div>
                      <div style={{fontSize:13,color:T.tx2}}>{tx.coin?tx.coin.toUpperCase():""} - {tx.network||"Network"}</div>
                    </div>
                    {isPending?<span onClick={()=>sT("Contact support to cancel","err")} style={{padding:"4px 12px",borderRadius:6,fontSize:12,fontWeight:600,background:"#FEF2F2",color:T.rd,cursor:"pointer",border:"1px solid #FECACA"}}>Cancel</span>:
                    <span style={{padding:"4px 12px",borderRadius:6,fontSize:12,fontWeight:600,background:T.gnL,color:T.gn}}>Completed</span>}
                  </div>
                  <div style={{fontSize:16,fontWeight:800,color:T.gn}}>{tx.qty?Number(tx.qty).toFixed(8):""} {tx.coin?tx.coin.toUpperCase():""}</div>
                </div>);
              })
            }
          </div>
        </div>
      </div>
    </div>);}

    // Selection/form view
    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Crypto Deposit</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:24}}>Deposit cryptocurrency directly to your wallet</p>
      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 340px",gap:20,alignItems:"start"}}>
        <div style={{...sCard,padding:28}}>
          <h3 style={{fontSize:18,fontWeight:700,marginBottom:20,display:"flex",alignItems:"center",gap:8}}>
            <svg width="20" height="20" fill="none" stroke={T.pr} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 8v8m-3-4h6"/></svg>
            Deposit Cryptocurrency
          </h3>
          {/* Step 1: Select Coin */}
          <label style={{...lS}}>Select Cryptocurrency <span style={{color:T.rd}}>*</span></label>
          <div style={{position:"relative",marginBottom:16}}>
            <div style={{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)"}}>{I.search}</div>
            <input value={cdQ} onChange={e=>{setCdQ(e.target.value);setCdShow(true);}} onFocus={()=>setCdShow(true)} placeholder="Search cryptocurrency (e.g., BTC, USDT, ETH)..." style={{...iS,paddingLeft:42}}/>
          </div>
          {cdShow&&<div style={{maxHeight:200,overflowY:"auto",WebkitOverflowScrolling:"touch",border:"1px solid "+T.bd,borderRadius:10,marginBottom:16}}>
            {filtCD.map(c2=>{const m2=gM(c2.id);return(<div key={c2.id} onClick={()=>{setCdC(c2.id);setCdQ(c2.name);setCdShow(false);setCdAddr("");setCdNet("");setCdAmt("");setCdInvoice(null);setCdStatus(null);fetchNetworks(m2.s);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",borderBottom:"1px solid "+T.bdL}} onMouseEnter={e=>e.currentTarget.style.background=T.bg} onMouseLeave={e=>e.currentTarget.style.background=T.wh}>{c2.image&&<img src={c2.image} width={28} height={28} style={{borderRadius:"50%"}}/>}<div><span style={{fontWeight:600,fontSize:14}}>{c2.name}</span><div style={{fontSize:12,color:T.tx3}}>{m2.s}</div></div></div>);})}
          </div>}
          {/* Selected coin badge */}
          {selC&&<div style={{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",borderRadius:12,background:T.bg,marginBottom:20}}>
            {selC.image&&<img src={selC.image} width={32} height={32} style={{borderRadius:"50%"}}/>}
            <div style={{flex:1}}><div style={{fontWeight:700,fontSize:15}}>{selC.name}</div><div style={{fontSize:12,color:T.tx3}}>{selM.s}</div></div>
            <div onClick={()=>{setCdC("");setCdQ("");setCdNets([]);setCdAddr("");setCdNet("");}} style={{cursor:"pointer",padding:6,borderRadius:8,background:T.wh,border:"1px solid "+T.bd}}>‚úï</div>
          </div>}
          {/* Step 2: Select Network */}
          {selC&&cdNets.length>0&&<>
            <label style={lS}>Select Network <span style={{color:T.rd}}>*</span></label>
            <select value={cdNet} onChange={e=>{setCdNet(e.target.value);setCdAddr("");}} style={{...iS,cursor:"pointer",marginBottom:6}}>
              {cdNets.map(n=>(<option key={n.network} value={n.network}>{n.network} ({n.name})</option>))}
            </select>
            <div style={{fontSize:11,color:T.tx3,marginBottom:20}}>Choose the blockchain network for this deposit</div>
          </>}
          {/* Step 3: Get Address */}
          {selC&&cdNet&&!cdAddr&&<button onClick={getAddress} disabled={cdAddrLoading} style={{...bP,width:"100%",marginBottom:20,background:"linear-gradient(135deg,#F59E0B,#D97706)",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
            {cdAddrLoading?<><Spin sz={16} c="#fff"/> Getting Address...</>:"Get Deposit Address"}
          </button>}
          {/* Step 4: Enter Amount & Create Invoice */}
          {cdAddr&&<>
            <div style={{padding:"12px 16px",borderRadius:10,background:"#ECFDF5",border:"1px solid #A7F3D0",marginBottom:16,fontSize:13,display:"flex",alignItems:"center",gap:8}}>
              <span style={{color:T.gn,fontSize:16}}>‚úì</span>
              <span>Address ready: <strong style={{fontFamily:"monospace",fontSize:12}}>{cdAddr.slice(0,16)}...{cdAddr.slice(-8)}</strong></span>
            </div>
            <label style={lS}>Deposit Amount <span style={{color:T.rd}}>*</span></label>
            <div style={{position:"relative",marginBottom:6}}>
              <input type="number" value={cdAmt} onChange={e=>setCdAmt(e.target.value)} placeholder="0.00" style={{...iS,paddingRight:60,fontSize:18,fontWeight:700}}/>
              <span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:14,fontWeight:700,color:T.tx2}}>{selM.s}</span>
            </div>
            <div style={{fontSize:12,color:T.tx2,marginBottom:20}}>Enter the amount of cryptocurrency you want to deposit ¬∑ <span style={{color:T.rd}}>Minimum: {netInfo?.minDeposit||"0.001"} {selM.s}</span></div>
            <button onClick={createInvoice} style={{...bP,width:"100%",background:"linear-gradient(135deg,#F59E0B,#D97706)",fontSize:16,padding:"14px",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
              <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Create Deposit Invoice
            </button>
          </>}
        </div>
        {/* Right: Recent Deposits */}
        <div style={sCard}>
          <div style={{padding:"14px 20px",borderBottom:"1px solid "+T.bd}}><h3 style={{fontSize:15,fontWeight:700}}>Recent Crypto Deposits</h3></div>
          {txH.filter(t=>t.type==="crypto_dep").length===0?
            <div style={{padding:32,textAlign:"center"}}>{I.empty}<div style={{fontSize:13,color:T.tx3,marginTop:8}}>No crypto deposits yet</div></div>:
            txH.filter(t=>t.type==="crypto_dep").slice(0,8).map((tx,i)=>(
              <div key={i} style={{padding:"12px 20px",borderBottom:"1px solid "+T.bdL}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <div><div style={{fontSize:13,fontWeight:700}}>{tx.qty} {tx.coin}</div><div style={{fontSize:11,color:T.tx3}}>{tx.network} ¬∑ {tA(tx.date)}</div></div>
                  <span style={{padding:"3px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:T.gnL,color:T.gn}}>‚úì completed</span>
                </div>
                <div style={{marginTop:4,height:3,borderRadius:2,background:T.gn,width:"100%"}}/>
              </div>
            ))
          }
        </div>
      </div>
    </div>);
  };

    // ‚ïê‚ïê‚ïê CRYPTO WITHDRAW (Professional) ‚ïê‚ïê‚ïê
  const CryptoWd=()=>{
    const filtCW=cwQ?coins.filter(c=>c.name.toLowerCase().includes(cwQ.toLowerCase())||gM(c.id).s.toLowerCase().includes(cwQ.toLowerCase())):coins;
    const selC=cwC?gC(cwC):null;const selM=cwC?gM(cwC):null;const held=cwC?(port[cwC]||0):0;
    const amt=parseFloat(cwAmt)||0;const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};

    // Address validation
    const vAddr=(addr,net)=>{
      if(!addr||addr.trim().length<10)return{valid:false,msg:"Address is too short"};
      if(addr.includes(" "))return{valid:false,msg:"Address cannot contain spaces"};
      const a=addr.trim();
      if(net==="ERC20"||net==="BEP20"||net==="AVAX"){
        if(!a.startsWith("0x"))return{valid:false,msg:"Must start with 0x for "+net};
        if(a.length!==42)return{valid:false,msg:net+" address must be 42 characters"};
        if(!/^0x[a-fA-F0-9]+$/.test(a))return{valid:false,msg:"Invalid hex characters"};
      }else if(net==="TRC20"){
        if(!a.startsWith("T"))return{valid:false,msg:"TRC20 address must start with T"};
        if(a.length!==34)return{valid:false,msg:"TRC20 address must be 34 characters"};
      }else if(net==="SOL"){
        if(a.length<32||a.length>44)return{valid:false,msg:"Invalid Solana address length"};
      }else if(net==="BTC"){
        if(!a.startsWith("bc1")&&!a.startsWith("1")&&!a.startsWith("3"))return{valid:false,msg:"BTC address must start with bc1, 1, or 3"};
        if(a.length<25||a.length>62)return{valid:false,msg:"Invalid BTC address length"};
      }
      return{valid:true,msg:"Valid "+net+" address"};
    };
    const addrCheck=cwAddr?vAddr(cwAddr,cwNet):{valid:false,msg:""};

    // Network fees (estimated)
    const netFees={BTC:{BTC:0.0001},ETH:{ERC20:0.001},BNB:{BEP20:0.0005},SOL:{SOL:0.01},XRP:{XRP:0.1},
      ADA:{ADA:1},DOGE:{DOGE:5},AVAX:{AVAX:0.01},DOT:{DOT:0.1},LTC:{LTC:0.001},LINK:{ERC20:0.3},
      UNI:{ERC20:0.5},TRX:{TRC20:1},USDT:{ERC20:5,TRC20:1,BEP20:0.5}};
    const coinSym=selM?selM.s.toUpperCase():"";
    const fee=(netFees[coinSym]&&netFees[coinSym][cwNet])||0;
    const receiveAmt=Math.max(0,amt-fee);

    

    const submitWithdraw=async()=>{
      if(!cwC)return sT("Select a coin","err");
      if(!cwAddr||!addrCheck.valid)return sT(addrCheck.msg||"Invalid address","err");
      if(amt<=0)return sT("Enter amount","err");
      if(amt>held)return sT("Insufficient balance: "+held.toFixed(8)+" "+coinSym,"err");
      if(amt<=fee)return sT("Amount must be greater than network fee ("+fee+" "+coinSym+")","err");
      if(!cwConfirm){setCwStep("confirm");return;}
      setCwStep("processing");
      try{
        const d=await API("/exchange/crypto-withdraw",{method:"POST",body:JSON.stringify({coinId:cwC,quantity:amt,address:cwAddr.trim(),network:cwNet})});
        if(d.portfolio)setPort(d.portfolio);
        try{const tx=await API("/transactions");setTxH(tx.transactions||[]);}catch{}
        sT("Withdrawal submitted: "+amt+" "+coinSym);
        setCwStep("success");
      }catch(e){sT(e.message||"Withdrawal failed","err");setCwStep("form");setCwConfirm(false);}
    };

    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Crypto Withdrawal</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:24}}>Withdraw cryptocurrency to your external wallet</p>

      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 320px",gap:20,alignItems:"start"}}>
        {cwStep==="form"&&<div style={{...sCard,padding:28}}>
          <h3 style={{fontSize:18,fontWeight:700,marginBottom:20}}>Withdraw Cryptocurrency</h3>

          {/* Coin Select */}
          <label style={lS}>Select Cryptocurrency <span style={{color:T.rd}}>*</span></label>
          <div style={{position:"relative",marginBottom:16}}>
            <input value={cwQ} onChange={e=>{setCwQ(e.target.value);setCwShow(true);}} onFocus={()=>setCwShow(true)} placeholder="Search (BTC, ETH, USDT...)" style={{...iS,paddingLeft:14}}/>
          </div>
          {cwShow&&<div style={{maxHeight:200,overflowY:"auto",WebkitOverflowScrolling:"touch",border:"1px solid "+T.bd,borderRadius:10,marginBottom:16,background:T.wh}}>
            {filtCW.map(fc=>{const m2=gM(fc.id);const h2=port[fc.id]||0;return(
              <div key={fc.id} onClick={()=>{setCwC(fc.id);setCwQ(fc.name);setCwShow(false);setCwStep("form");setCwConfirm(false);}} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",cursor:"pointer",borderBottom:"1px solid "+T.bdL}} onMouseEnter={e=>e.currentTarget.style.background=T.bg} onMouseLeave={e=>e.currentTarget.style.background=""}>
                {fc.image&&<img src={fc.image} width={24} height={24} style={{borderRadius:"50%"}}/>}
                <span style={{fontWeight:600,fontSize:13}}>{fc.name}</span>
                <span style={{fontSize:12,color:T.tx3}}>{m2.s}</span>
                <span style={{marginLeft:"auto",fontSize:12,color:h2>0?T.gn:T.tx3,fontWeight:h2>0?700:400}}>{h2>0?h2.toFixed(6):"0"}</span>
              </div>
            );})}
          </div>}

          {selC&&<div>
            {/* Selected coin info */}
            <div style={{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",borderRadius:10,background:"#F0F4FF",marginBottom:16}}>
              {selC.image&&<img src={selC.image} width={32} height={32} style={{borderRadius:"50%"}}/>}
              <div><div style={{fontWeight:700}}>{selC.name} ({coinSym})</div><div style={{fontSize:12,color:T.tx2}}>Balance: <strong>{held.toFixed(8)} {coinSym}</strong></div></div>
            </div>

            {/* Network */}
            <label style={lS}>Network <span style={{color:T.rd}}>*</span></label>
            <select value={cwNet} onChange={e=>setCwNet(e.target.value)} style={{...iS,cursor:"pointer",marginBottom:16}}>
              <option value="ERC20">ERC20 (Ethereum)</option>
              <option value="BEP20">BEP20 (BSC)</option>
              <option value="TRC20">TRC20 (Tron)</option>
              <option value="SOL">SOL (Solana)</option>
              <option value="BTC">BTC (Bitcoin)</option>
            </select>

            {/* Address */}
            <label style={lS}>Recipient Address <span style={{color:T.rd}}>*</span></label>
            <input value={cwAddr} onChange={e=>setCwAddr(e.target.value)} placeholder={"Enter "+cwNet+" wallet address"} style={{...iS,marginBottom:4,borderColor:cwAddr?(addrCheck.valid?"#16A34A":"#EF4444"):T.bd}}/>
            {cwAddr&&<div style={{fontSize:12,marginBottom:12,fontWeight:600,color:addrCheck.valid?T.gn:T.rd}}>{addrCheck.msg}</div>}
            {!cwAddr&&<div style={{fontSize:12,marginBottom:12,color:T.tx3}}>Make sure the address matches the selected network</div>}

            {/* Amount */}
            <label style={lS}>Amount ({coinSym}) <span style={{color:T.rd}}>*</span></label>
            <div style={{position:"relative",marginBottom:4}}>
              <input type="number" value={cwAmt} onChange={e=>setCwAmt(e.target.value)} placeholder="0.00000000" style={{...iS,fontSize:18,fontWeight:700,paddingRight:50}}/>
              <div onClick={()=>setCwAmt(parseFloat(held.toFixed(8)).toString())} style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",padding:"6px 10px",borderRadius:6,background:T.pr,color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>Max</div>
            </div>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:12,color:T.tx3,marginBottom:4}}>
              <span>Available: {held.toFixed(8)} {coinSym}</span>
            </div>
            {/* Quick % */}
            <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:16}}>{[25,50,75,100].map(p=>{const v=parseFloat((held*p/100).toFixed(8)).toString();return(<button key={p} onClick={()=>setCwAmt(v)} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:8,borderRadius:8,fontSize:12,background:T.bg,color:T.tx2,border:"1px solid "+T.bd}}>{p}%</button>);})}</div>

            {/* Fee info */}
            {amt>0&&<div style={{padding:"12px 16px",borderRadius:10,background:T.bg,marginBottom:20,fontSize:13}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{color:T.tx2}}>Network Fee</span><span style={{fontWeight:600}}>{fee} {coinSym}</span></div>
              <div style={{display:"flex",justifyContent:"space-between"}}><span style={{color:T.tx2}}>You Receive</span><span style={{fontWeight:700,color:receiveAmt>0?T.gn:T.rd}}>{receiveAmt.toFixed(8)} {coinSym}</span></div>
            </div>}

            {/* Warning */}
            <div style={{padding:"10px 14px",borderRadius:8,background:"#FFF7ED",border:"1px solid #FED7AA",marginBottom:20,fontSize:12,color:"#92400E"}}>
              Ensure the address and network are correct. Sending to a wrong address or network will result in permanent loss of funds.
            </div>

            <button onClick={submitWithdraw} disabled={!addrCheck.valid||amt<=0||amt>held} style={{...bP,width:"100%",padding:14,fontSize:15,borderRadius:12,background:(!addrCheck.valid||amt<=0||amt>held)?"#D1D5DB":"linear-gradient(135deg,#EF4444,#F87171)",cursor:(!addrCheck.valid||amt<=0||amt>held)?"not-allowed":"pointer",opacity:(!addrCheck.valid||amt<=0||amt>held)?.6:1}}>Withdraw {coinSym}</button>
          </div>}
        </div>}

        {/* Confirmation step */}
        {cwStep==="confirm"&&<div style={{...sCard,padding:28}}>
          <h3 style={{fontSize:20,fontWeight:800,marginBottom:20}}>Confirm Withdrawal</h3>
          <div style={{padding:"16px",borderRadius:10,background:T.bg,marginBottom:16}}>
            <div style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.bdL}}><span style={{color:T.tx2,fontSize:13}}>Coin</span><span style={{fontWeight:700}}>{coinSym}</span></div>
            <div style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.bdL}}><span style={{color:T.tx2,fontSize:13}}>Network</span><span style={{fontWeight:600}}>{cwNet}</span></div>
            <div style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.bdL}}><span style={{color:T.tx2,fontSize:13}}>Amount</span><span style={{fontWeight:700}}>{amt} {coinSym}</span></div>
            <div style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.bdL}}><span style={{color:T.tx2,fontSize:13}}>Fee</span><span style={{fontWeight:600}}>{fee} {coinSym}</span></div>
            <div style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid "+T.bdL}}><span style={{color:T.tx2,fontSize:13}}>You Receive</span><span style={{fontWeight:700,color:T.gn}}>{receiveAmt.toFixed(8)} {coinSym}</span></div>
            <div style={{padding:"8px 0"}}><span style={{color:T.tx2,fontSize:13}}>Address</span><div style={{fontFamily:"monospace",fontSize:12,wordBreak:"break-all",marginTop:4,fontWeight:600}}>{cwAddr}</div></div>
          </div>
          <div style={{padding:"10px 14px",borderRadius:8,background:"#FEF2F2",border:"1px solid #FECACA",marginBottom:20,fontSize:12,color:"#991B1B"}}>
            This action is irreversible. Double-check the address and network before confirming.
          </div>
          <div style={{display:"flex",gap:10}}>
            <button onClick={()=>{setCwStep("form");setCwConfirm(false);}} style={{...bO,flex:1,padding:14}}>Cancel</button>
            <button onClick={()=>{setCwConfirm(true);submitWithdraw();}} style={{...bP,flex:1,padding:14,background:"linear-gradient(135deg,#EF4444,#F87171)"}}>Confirm Withdrawal</button>
          </div>
        </div>}

        {/* Processing */}
        {cwStep==="processing"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center"}}><Spin sz={36}/><h3 style={{marginTop:18}}>Processing Withdrawal...</h3><p style={{color:T.tx2,fontSize:13,marginTop:6}}>Sending {amt} {coinSym} via {cwNet}</p></div>}

        {/* Success */}
        {cwStep==="success"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center"}}>
          <div style={{width:64,height:64,borderRadius:"50%",margin:"0 auto 14px",background:T.gnL,display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,color:T.gn,fontWeight:800}}>OK</div>
          <h3 style={{fontSize:20,fontWeight:800,color:T.gn,marginBottom:6}}>Withdrawal Submitted</h3>
          <p style={{fontSize:14}}><strong>{amt} {coinSym}</strong> sent via {cwNet}</p>
          <p style={{fontSize:12,color:T.tx3,marginTop:4,fontFamily:"monospace",wordBreak:"break-all"}}>{cwAddr}</p>
          <button onClick={()=>{setCwStep("form");setCwConfirm(false);setCwAmt("");setCwAddr("");setCwC("");setCwQ("");}} style={{...bO,marginTop:20}}>New Withdrawal</button>
        </div>}

        {/* Recent Withdrawals */}
        <div style={sCard}>
          <div style={{padding:"16px 20px",borderBottom:"1px solid "+T.bd}}><h3 style={{fontSize:16,fontWeight:700}}>Recent Withdrawals</h3></div>
          {txH.filter(t=>t.type==="crypto_wd").length===0?
            <div style={{padding:"48px 20px",textAlign:"center"}}><div style={{fontSize:14,color:T.tx3}}>No withdrawals yet</div></div>:
            txH.filter(t=>t.type==="crypto_wd").slice(0,8).map((tx,i)=>{
              const dt=new Date(tx.date);const dateStr=dt.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});
              return(<div key={i} style={{padding:"14px 20px",borderBottom:"1px solid "+T.bdL}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}>
                  <div style={{fontSize:13,color:T.tx2}}>{dateStr}</div>
                  <span style={{padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:600,background:T.gnL,color:T.gn}}>Completed</span>
                </div>
                <div style={{fontSize:13,color:T.tx2,marginBottom:2}}>{tx.coin?tx.coin.toUpperCase():""} - {tx.network||"Network"}</div>
                <div style={{fontSize:15,fontWeight:800,color:T.rd}}>-{tx.qty?Number(tx.qty).toFixed(8):""} {tx.coin?tx.coin.toUpperCase():""}</div>
                <div style={{fontSize:11,color:T.tx3,marginTop:4,fontFamily:"monospace",wordBreak:"break-all"}}>{tx.addr}</div>
              </div>);
            })
          }
        </div>
      </div>
    </div>);
  };


  // ‚ïê‚ïê‚ïê DEPOSIT XAF (Fapshi Integration) ‚ïê‚ïê‚ïê
  const DepositPage=()=>{
    const a=parseInt(dA)||0;
    const startFapshi=async()=>{
      if(a<100)return sT("Minimum deposit: 100 XAF","err");
      setDS("proc");
      var payWin=window.open("about:blank","_blank");
      try{
        const d=await API("/fapshi/initiate",{method:"POST",body:JSON.stringify({amount:a,note:dNote||"Deposit"})});
        if(d.link){setFapTx(d.transId);if(payWin&&!payWin.closed){payWin.location.href=d.link;}else{window.location.href=d.link;}setDS("waiting");sT("Complete payment in the new tab");}
        else{if(payWin)payWin.close();throw new Error("No payment link");}
      }catch(e){if(payWin&&!payWin.closed)payWin.close();setDS("form");sT(e.message||"Payment failed","err");}
    };
    const checkFapshi=async()=>{
      if(!fapTx)return;
      try{
        const d=await API("/fapshi/status/"+fapTx);
        if(d.status==="SUCCESSFUL"){
          setDS("ok");
          try{const me=await API("/auth/me");setBal(me.user.balance);const tx=await API("/transactions");setTxH(tx.transactions||[]);}catch{}
          sT("Deposit successful! Balance updated.");
        }else if(d.status==="FAILED"){setDS("form");sT("Payment failed or was cancelled","err");setFapTx(null);}
        else{sT("Payment still pending. Complete it in the Fapshi tab.");}
      }catch(e){sT("Checking...try again in a moment");}
    };
    // Auto-poll when waiting
    useEffect(()=>{if(dS!=="waiting"||!fapTx)return;const iv=setInterval(checkFapshi,10000);return()=>clearInterval(iv);},[dS,fapTx]);

    const fee=Math.round(a*0.05);const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};
    return(<div>
      {/* Balance Card */}
      <div style={{background:"linear-gradient(135deg,#4361EE,#6366F1)",borderRadius:14,padding:isMob?"20px 16px":"24px 28px",color:"#fff",marginBottom:24,position:"relative",overflow:"hidden"}}>
        <div style={{fontSize:13,opacity:.85,marginBottom:4}}>Current Balance</div>
        <div style={{fontSize:36,fontWeight:800,marginBottom:6}}>{fX(bal)}</div>
        <div style={{fontSize:13,opacity:.75}}>Top up using Mobile Money (MTN/Orange) via Fapshi</div>
        <div style={{display:"inline-flex",alignItems:"center",gap:6,marginTop:12,padding:"6px 14px",borderRadius:8,background:"rgba(255,255,255,.15)",fontSize:12,fontWeight:600}}>
          <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
          Deposit fee: 5.00% will be deducted
        </div>
        <div style={{position:"absolute",right:-20,top:"50%",transform:"translateY(-50%)",width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:40}}>$</div>
      </div>

      {dS==="form"&&<div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr",gap:20,alignItems:"start"}}>
        <div style={{...sCard,padding:28}}>
          <h3 style={{fontSize:22,fontWeight:800,marginBottom:20}}>Add Money</h3>

          {/* Payment Method */}
          <label style={lS}>Select Payment Method</label>
          <div style={{padding:"16px 20px",borderRadius:12,border:"2px solid "+T.pr,background:T.prL,marginBottom:20,cursor:"pointer"}}>
            <div style={{fontSize:15,fontWeight:700}}>Fapshi Pay</div>
            <div style={{fontSize:13,color:T.tx2}}>Secure Payment Gateway ¬∑ MTN MoMo & Orange Money</div>
          </div>

          {/* Amount */}
          <label style={lS}>Amount (XAF) <span style={{color:T.rd}}>*</span></label>
          <input type="number" style={{...iS,fontSize:20,fontWeight:700,marginBottom:4}} placeholder="Enter amount e.g. 1000" value={dA} onChange={e=>setDA(e.target.value)}/>
          <div style={{fontSize:12,color:T.tx3,marginBottom:16}}>Minimum amount: 100 XAF{a>=100?` ¬∑ Fee: ${fX(fee)} ¬∑ You receive: ${fX(a-fee)}`:""}</div>

          {/* Quick amounts */}
          <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:20}}>{[1000,5000,10000,25000,50000,100000,250000,500000].map(v=>(<button key={v} onClick={()=>setDA(String(v))} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:10,borderRadius:8,fontSize:12,background:parseInt(dA)===v?T.prL:T.bg,color:parseInt(dA)===v?T.pr:T.tx2,border:"1px solid "+(parseInt(dA)===v?T.pr+"40":T.bd)}}>{v>=1000?(v/1000)+"K":v}</button>))}</div>

          {/* Email */}
          <label style={lS}>Email</label>
          <input style={{...iS,marginBottom:16}} value={user.email} disabled/>

          {/* Note */}
          <label style={lS}>Note (optional)</label>
          <input style={{...iS,marginBottom:24}} placeholder="Reference for your records" value={dNote} onChange={e=>setDNote(e.target.value)}/>

          {/* Submit */}
          <button onClick={startFapshi} style={{...bP,width:"100%",padding:14,fontSize:16,display:"flex",alignItems:"center",justifyContent:"center",gap:8,borderRadius:12}}>
            <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Proceed to Payment
          </button>
        </div>

        {/* Recent Deposits */}
        <div style={sCard}>
          <div style={{padding:"16px 20px",borderBottom:"1px solid "+T.bd}}><h3 style={{fontSize:16,fontWeight:700}}>Recent Deposits</h3></div>
          {txH.filter(t=>t.type==="deposit").length===0?
            <div style={{padding:"48px 20px",textAlign:"center"}}>
              <svg width="40" height="40" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 10px"}}><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
              <div style={{fontSize:14,color:T.tx3}}>No deposits yet</div>
            </div>:
            txH.filter(t=>t.type==="deposit").slice(0,8).map((tx,i)=>(
              <div key={i} style={{padding:"12px 20px",borderBottom:"1px solid "+T.bdL,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                <div><div style={{fontSize:13,fontWeight:600}}>+{fX(tx.xaf)}</div><div style={{fontSize:11,color:T.tx3}}>{tx.method?.includes("fapshi")?"Fapshi Pay":tx.method} ¬∑ {tA(tx.date)}</div></div>
                <span style={{padding:"3px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:tx.status==="completed"?T.gnL:T.amL,color:tx.status==="completed"?T.gn:T.am}}>{tx.status}</span>
              </div>
            ))
          }
        </div>
      </div>}

      {dS==="proc"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center",maxWidth:520}}><Spin sz={36}/><h3 style={{marginTop:18}}>Connecting to Fapshi...</h3><p style={{color:T.tx2,fontSize:13,marginTop:6}}>Preparing payment page</p></div>}

      {dS==="waiting"&&<div style={{...sCard,padding:"40px 28px",textAlign:"center",maxWidth:520}}>
        <div style={{width:64,height:64,borderRadius:"50%",margin:"0 auto 16px",background:T.amL,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28}}>‚è≥</div>
        <h3 style={{fontSize:20,fontWeight:800,marginBottom:6}}>Complete Payment</h3>
        {fapTx&&<a href={"https://pay.fapshi.com/"+fapTx} target="_blank" rel="noopener" style={{display:"inline-block",padding:"10px 24px",borderRadius:8,background:T.pr,color:"#fff",fontWeight:700,fontSize:14,textDecoration:"none",marginBottom:12}}>Open Payment Page</a>}
        <p style={{color:T.tx2,fontSize:14,marginBottom:8}}>A Fapshi payment page has been opened in a new tab.</p>
        <p style={{color:T.tx2,fontSize:13,marginBottom:20}}>Complete the payment there, then come back here. We'll automatically detect it.</p>
        <div style={{padding:"14px 20px",borderRadius:10,background:T.bg,marginBottom:20}}>
          <div style={{fontSize:13,color:T.tx2}}>Amount</div>
          <div style={{fontSize:24,fontWeight:800}}>{fX(a)}</div>
          <div style={{fontSize:12,color:T.tx3,marginTop:2}}>Transaction ID: {fapTx}</div>
        </div>
        <div style={{display:"flex",gap:10,justifyContent:"center"}}>
          <button onClick={checkFapshi} style={{...bP,padding:"12px 24px"}}>Check Payment Status</button>
          <button onClick={()=>{setDS("form");setFapTx(null);}} style={{...bO,padding:"12px 24px"}}>Cancel</button>
        </div>
      </div>}

      {dS==="ok"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center",maxWidth:520}}>
        <div style={{width:64,height:64,borderRadius:"50%",margin:"0 auto 14px",background:T.gnL,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,color:T.gn}}>‚úì</div>
        <h3 style={{fontSize:20,fontWeight:800,color:T.gn,marginBottom:6}}>Deposit Successful!</h3>
        <p style={{fontSize:15}}><strong>{fX(a)}</strong> added to your balance</p>
        <div style={{display:"flex",gap:10,justifyContent:"center",marginTop:20}}>
          <button onClick={()=>{setDS("form");setDA("");setDNote("");setFapTx(null);}} style={bO}>Deposit Again</button>
          <button onClick={()=>setPg("exchange")} style={bP}>Buy Crypto</button>
        </div>
      </div>}
    </div>);
  };

    // ‚ïê‚ïê‚ïê WITHDRAW XAF (Enhanced) ‚ïê‚ïê‚ïê
  const WithdrawPage=()=>{
    const wAmt=parseInt(wA)||0;const fee=Math.round(wAmt*0.03);const net=wAmt-fee;
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};
    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Withdraw</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:24}}>Withdraw funds to your Mobile Money account</p>

      {/* Balance Card */}
      <div style={{background:"linear-gradient(135deg,#16A34A,#22C55E)",borderRadius:14,padding:isMob?"20px 16px":"24px 28px",color:"#fff",marginBottom:24,position:"relative",overflow:"hidden"}}>
        <div style={{fontSize:13,opacity:.85,marginBottom:4}}>Available Balance</div>
        <div style={{fontSize:36,fontWeight:800,marginBottom:6}}>{fX(bal)}</div>
        <div style={{fontSize:13,opacity:.75}}>Withdraw to Mobile Money (MTN/Orange) via Fapshi Pay</div>
        <div style={{display:"inline-flex",alignItems:"center",gap:6,marginTop:12,padding:"6px 14px",borderRadius:8,background:"rgba(255,255,255,.15)",fontSize:12,fontWeight:600}}>
          Withdrawal fee: 3.00% will be deducted
        </div>
        <div style={{position:"absolute",right:-20,top:"50%",transform:"translateY(-50%)",width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,.1)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:32,opacity:.6}}>{'$'}</div>
      </div>

      {wS==="form"&&<div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr",gap:20,alignItems:"start"}}>
        <div style={{...sCard,padding:28}}>
          <h3 style={{fontSize:22,fontWeight:800,marginBottom:20}}>Withdraw Funds</h3>

          {/* Amount */}
          <label style={lS}>Amount (XAF) <span style={{color:T.rd}}>*</span></label>
          <input type="number" style={{...iS,fontSize:20,fontWeight:700,marginBottom:4}} placeholder="Enter amount e.g. 1000" value={wA} onChange={e=>setWA(e.target.value)}/>
          <div style={{fontSize:12,color:T.tx3,marginBottom:4}}>Minimum amount: 150 XAF <span style={{color:"#D97706"}}>(Whole numbers only, no decimals)</span></div>
          {wAmt>=150&&<div style={{fontSize:12,color:T.tx3,marginBottom:16}}>Fee: {fX(fee)} | You receive: {fX(net)}</div>}
          {wAmt<150&&wAmt>0&&<div style={{fontSize:12,color:T.rd,marginBottom:16}}>Minimum withdrawal is 150 XAF</div>}

          {/* Quick amounts */}
          <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:20}}>{[25,50,75,100].map(p=>{const v=Math.floor(bal*p/100);return(<button key={p} onClick={()=>setWA(String(v))} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,padding:10,borderRadius:8,fontSize:12,background:parseInt(wA)===v?T.gnL:T.bg,color:parseInt(wA)===v?T.gn:T.tx2,border:"1px solid "+(parseInt(wA)===v?"#16A34A40":T.bd)}}>{p}%</button>);})}</div>

          {/* Phone */}
          <label style={lS}>Phone Number <span style={{color:T.rd}}>*</span></label>
          <input style={{...iS,marginBottom:20}} placeholder="237XXXXXXXXX" value={wP} onChange={e=>setWP(e.target.value.replace(/[^0-9]/g,""))}/>

          {/* Network */}
          <label style={lS}>Network <span style={{color:T.rd}}>*</span></label>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:24}}>
            {[{id:"mtn",l:"MTN",sub:"Mobile Money"},{id:"orange",l:"Orange",sub:"Mobile Money"}].map(n=>(<div key={n.id} onClick={()=>setWM(n.id)} style={{padding:"14px 16px",borderRadius:12,cursor:"pointer",border:"2px solid "+(wM===n.id?"#16A34A":T.bd),background:wM===n.id?"#F0FDF4":"transparent",display:"flex",alignItems:"center",justifyContent:"space-between"}}>
              <div><div style={{fontSize:14,fontWeight:700}}>{n.l}</div><div style={{fontSize:12,color:T.tx3}}>{n.sub}</div></div>
              <div style={{width:20,height:20,borderRadius:"50%",border:"2px solid "+(wM===n.id?"#16A34A":T.bd),display:"flex",alignItems:"center",justifyContent:"center"}}>{wM===n.id&&<div style={{width:10,height:10,borderRadius:"50%",background:"#16A34A"}}></div>}</div>
            </div>))}
          </div>

          {/* Submit */}
          <button onClick={doWd} style={{...bP,width:"100%",padding:14,fontSize:16,borderRadius:12,background:"linear-gradient(135deg,#16A34A,#22C55E)",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
            Process Withdrawal
          </button>
        </div>

        {/* Recent Withdrawals */}
        <div style={sCard}>
          <div style={{padding:"16px 20px",borderBottom:"1px solid "+T.bd}}><h3 style={{fontSize:16,fontWeight:700}}>Recent Withdrawals</h3></div>
          {txH.filter(t=>t.type==="withdraw").length===0?
            <div style={{padding:"48px 20px",textAlign:"center"}}>
              <svg width="40" height="40" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 10px"}}><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              <div style={{fontSize:14,color:T.tx3}}>No withdrawals yet</div>
            </div>:
            txH.filter(t=>t.type==="withdraw").slice(0,8).map((tx,i)=>(
              <div key={i} style={{padding:"12px 20px",borderBottom:"1px solid "+T.bdL,display:"flex",alignItems:"center",justifyContent:"space-between"}}>
                <div><div style={{fontSize:13,fontWeight:600}}>-{fX(tx.xaf||tx.tXAF)}</div><div style={{fontSize:11,color:T.tx3}}>{tx.method} | +237 {tx.phone} | {tA(tx.date)}</div></div>
                <span style={{padding:"3px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:tx.status==="completed"?T.gnL:T.amL,color:tx.status==="completed"?T.gn:T.am}}>{tx.status}</span>
              </div>
            ))
          }
        </div>
      </div>}

      {wS==="proc"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center",maxWidth:520}}><Spin sz={36}/><h3 style={{marginTop:18}}>Processing withdrawal...</h3><p style={{color:T.tx2,fontSize:13,marginTop:6}}>Sending to +237 {wP} via {wM==="mtn"?"MTN MoMo":"Orange Money"}</p></div>}

      {wS==="ok"&&<div style={{...sCard,padding:"48px 28px",textAlign:"center",maxWidth:520}}>
        <div style={{width:64,height:64,borderRadius:"50%",margin:"0 auto 14px",background:T.gnL,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,color:T.gn}}>OK</div>
        <h3 style={{fontSize:20,fontWeight:800,color:T.gn}}>Withdrawal Successful!</h3>
        <p style={{fontSize:15,marginTop:6}}><strong>{fX(wAmt)}</strong> sent to +237 {wP}</p>
        <p style={{fontSize:13,color:T.tx3,marginTop:2}}>Fee: {fX(fee)} | Net: {fX(net)}</p>
        <div style={{display:"flex",gap:10,justifyContent:"center",marginTop:20}}>
          <button onClick={()=>{setWS("form");setWA("");setWP("");}} style={bO}>Withdraw Again</button>
          <button onClick={()=>setPg("dashboard")} style={bP}>Dashboard</button>
        </div>
      </div>}
    </div>);
  };


  // ‚ïê‚ïê‚ïê TRANSACTIONS ‚ïê‚ïê‚ïê
  // ‚ïê‚ïê‚ïê TRANSACTIONS (Enhanced) ‚ïê‚ïê‚ïê
  const Txns=()=>{
    const walletTypes=["deposit","withdraw"];
    const cryptoTypes=["buy","sell","crypto_dep","crypto_wd"];
    const now=Date.now();
    const filterMs={all:0,"24h":864e5,"7d":6048e5,"30d":2592e6,"90d":7776e6};
    const filtered=txH.filter(tx=>{
      const isWallet=walletTypes.includes(tx.type);const isCrypto=cryptoTypes.includes(tx.type);
      if(txTab==="wallet"&&!isWallet)return false;
      if(txTab==="crypto"&&!isCrypto)return false;
      if(txFilter!=="all"&&filterMs[txFilter]){const age=now-new Date(tx.date).getTime();if(age>filterMs[txFilter])return false;}
      return true;
    });
    const typeInfo={deposit:{l:"Deposit",icon:"‚Üì",color:T.pr},withdraw:{l:"Withdrawal",icon:"‚Üë",color:T.am},buy:{l:"Crypto Buy",icon:"+",color:T.gn},sell:{l:"Crypto Sell",icon:"‚àí",color:T.rd},crypto_dep:{l:"Crypto Deposit",icon:"+",color:T.gn},crypto_wd:{l:"Crypto Withdraw",icon:"‚Üë",color:T.rd}};
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};
    const fmtDate=d=>{if(!d)return"";const dt=new Date(d);return dt.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" ¬∑ "+dt.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});};

    return(<div>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:isMob?"flex-start":"center",flexDirection:isMob?"column":"row",gap:12,marginBottom:24}}>
        <h2 style={{fontSize:26,fontWeight:800}}>Transactions</h2>
        <select value={txFilter} onChange={e=>setTxFilter(e.target.value)} style={{padding:"8px 14px",borderRadius:8,border:"1px solid "+T.bd,background:T.wh,fontSize:13,fontWeight:600,cursor:"pointer",fontFamily:f}}>
          <option value="7d">Last 7 Days</option>
          <option value="24h">Last 24 Hours</option>
          <option value="30d">Last 30 Days</option>
          <option value="90d">Last 90 Days</option>
          <option value="all">All Time</option>
        </select>
      </div>

      {/* Tabs */}
      <div style={{display:"flex",marginBottom:20,borderRadius:12,overflow:"hidden",border:"1px solid "+T.bd}}>
        {[{id:"wallet",l:"Wallet Transactions"},{id:"crypto",l:"Crypto Transactions"}].map(tab=>{const a=txTab===tab.id;return(
          <div key={tab.id} onClick={()=>{setTxTab(tab.id);setTxExpand(null);}} style={{flex:1,padding:"14px 20px",textAlign:"center",fontSize:14,fontWeight:a?700:500,cursor:"pointer",background:a?"#EFF6FF":"transparent",color:a?T.pr:T.tx2,borderBottom:a?"2px solid "+T.pr:"2px solid transparent",transition:"all .15s"}}>{tab.l}</div>
        );})}
      </div>

      {/* Transaction list */}
      <div style={sCard}>
        {filtered.length===0?
          <div style={{padding:"48px 20px",textAlign:"center"}}>
            <svg width="40" height="40" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 10px"}}><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
            <div style={{fontSize:15,fontWeight:600,color:T.tx2}}>No {txTab} transactions</div>
            <div style={{fontSize:13,color:T.tx3,marginTop:4}}>Transactions will appear here</div>
          </div>:
          filtered.map((tx,i)=>{
            const info=typeInfo[tx.type]||{l:tx.type,icon:"¬∑",color:T.tx3};
            const expanded=txExpand===i;
            const isCrypto=cryptoTypes.includes(tx.type);
            const ref=tx.method?.includes("fapshi")?"FAPSHI_"+tx.method.split(":")[1]:(tx.type==="crypto_dep"||tx.type==="crypto_wd")?("CRYPTO_"+tx.type.toUpperCase()+"_"+tx.id):("TX_"+tx.id+"_"+Date.parse(tx.date)?.toString(36)?.toUpperCase()?.slice(0,8));

            return(<div key={i}>
              <div onClick={()=>setTxExpand(expanded?null:i)} style={{padding:isMob?"14px 16px":"16px 20px",borderBottom:"1px solid "+T.bdL,cursor:"pointer",transition:"background .1s"}} onMouseEnter={e=>e.currentTarget.style.background=T.bg} onMouseLeave={e=>e.currentTarget.style.background=""}>
                <div style={{display:"flex",alignItems:"center",gap:12}}>
                  {/* Icon */}
                  <div style={{width:40,height:40,borderRadius:10,background:info.color+"14",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:info.color,flexShrink:0}}>{info.icon}</div>
                  {/* Main info */}
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
                      <span style={{fontSize:14,fontWeight:600}}>{info.l}</span>
                      {isCrypto&&tx.coin&&<span style={{padding:"2px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:T.prL,color:T.pr}}>{tx.coin.toUpperCase()}</span>}
                      {isCrypto&&tx.network&&<span style={{padding:"2px 8px",borderRadius:5,fontSize:10,fontWeight:600,background:T.bg,color:T.tx3,border:"1px solid "+T.bd}}>{tx.network}</span>}
                    </div>
                    <div style={{fontSize:12,color:T.tx3,marginTop:2}}>{fmtDate(tx.date)}</div>
                  </div>
                  {/* Amount */}
                  <div style={{textAlign:"right",flexShrink:0}}>
                    <div style={{fontSize:15,fontWeight:700,color:info.color,fontFeatureSettings:"'tnum'"}}>{tx.type==="deposit"||tx.type==="buy"||tx.type==="crypto_dep"||tx.type==="sell"?"+":"‚àí"}{isCrypto&&tx.qty?Number(tx.qty).toFixed(4):fX(tx.xaf||tx.tXAF||0)}</div>
                    {/* Status badge */}
                    <span style={{display:"inline-block",marginTop:4,padding:"2px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:tx.status==="completed"?T.gnL:tx.status==="pending"?T.amL:T.rdL,color:tx.status==="completed"?T.gn:tx.status==="pending"?T.am:T.rd}}>{tx.status==="completed"?"‚úì Completed":tx.status==="pending"?"Pending":"Check"}</span>
                  </div>
                </div>
                {/* Reference row */}
                <div style={{display:"flex",alignItems:"center",gap:6,marginTop:8,padding:"6px 10px",borderRadius:6,background:T.bg,fontSize:11,color:T.tx3}}>
                  <span>Ref:</span>
                  <span style={{fontFamily:"monospace",fontWeight:600,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{ref}</span>
                  <div onClick={e=>{e.stopPropagation();navigator.clipboard?.writeText(ref);sT("Reference copied!");}} style={{cursor:"pointer",padding:"2px 6px",borderRadius:4,background:T.wh,border:"1px solid "+T.bd,fontSize:10}}>üìã</div>
                </div>
              </div>

              {/* Expanded detail */}
              {expanded&&<div style={{padding:"16px 20px",background:T.bg,borderBottom:"1px solid "+T.bd}}>
                <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr 1fr",gap:12}}>
                  <div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Type</div><div style={{fontSize:13,fontWeight:600}}>{info.l}</div></div>
                  <div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Amount (XAF)</div><div style={{fontSize:13,fontWeight:700}}>{fX(tx.xaf||tx.tXAF||0)}</div></div>
                  <div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Status</div><div style={{fontSize:13,fontWeight:600,color:tx.status==="completed"?T.gn:T.am}}>{tx.status}</div></div>
                  {tx.coin&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Coin</div><div style={{fontSize:13,fontWeight:600}}>{tx.coin.toUpperCase()}</div></div>}
                  {tx.qty&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Quantity</div><div style={{fontSize:13,fontWeight:700,fontFeatureSettings:"'tnum'"}}>{Number(tx.qty).toFixed(8)}</div></div>}
                  {tx.price&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Price (USD)</div><div style={{fontSize:13,fontWeight:600}}>${Number(tx.price).toLocaleString()}</div></div>}
                  {tx.network&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Network</div><div style={{fontSize:13,fontWeight:600}}>{tx.network}</div></div>}
                  {tx.addr&&<div style={{gridColumn:isMob?"1":"1/4"}}><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Address</div><div style={{fontSize:12,fontFamily:"monospace",wordBreak:"break-all"}}>{tx.addr}</div></div>}
                  {tx.method&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Method</div><div style={{fontSize:13}}>{tx.method.includes("fapshi")?"Fapshi Pay":tx.method}</div></div>}
                  {tx.phone&&<div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Phone</div><div style={{fontSize:13}}>+237 {tx.phone}</div></div>}
                  <div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Date</div><div style={{fontSize:13}}>{fmtDate(tx.date)}</div></div>
                  <div><div style={{fontSize:11,color:T.tx3,marginBottom:2}}>Reference</div><div style={{fontSize:12,fontFamily:"monospace"}}>{ref}</div></div>
                </div>
              </div>}
            </div>);
          })
        }
      </div>

      {/* Summary */}
      {filtered.length>0&&<div style={{marginTop:16,display:"flex",justifyContent:"space-between",fontSize:12,color:T.tx3}}>
        <span>{filtered.length} transaction{filtered.length!==1?"s":""}</span>
        <span>Showing {txFilter==="all"?"all time":txFilter==="24h"?"last 24 hours":txFilter==="7d"?"last 7 days":txFilter==="30d"?"last 30 days":"last 90 days"}</span>
      </div>}
    </div>);
  };


  // ‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê
  const Profile=()=>{
    // TG config at App level
    // TG check at App level
    // Connect Telegram handler
    const connectTelegram=async()=>{setTgLoading(true);try{const r=await fetch(`${TG_API}/api/telegram/generate-link`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:user.email,email:user.email})});const d=await r.json();if(d.deepLink){window.location.href=d.deepLink;sT("Opened Telegram ‚Äî tap Start in the bot!");let polls=0;const iv=setInterval(async()=>{polls++;try{const s=await fetch(`${TG_API}/api/telegram/status/${user.email}`);const sd=await s.json();if(sd.connected){setTgConnected(true);setTgUsername(sd.username||"Connected");clearInterval(iv);sT("Telegram connected!");}}catch{}if(polls>30)clearInterval(iv);},3000);}}catch(e){sT("Server not available. Deploy the bot first ‚Äî see DEPLOY.md","err");}setTgLoading(false);};
    // Disconnect Telegram
    const disconnectTelegram=async()=>{try{await fetch(`${TG_API}/api/telegram/disconnect/${user.email}`,{method:"POST"});setTgConnected(false);setTgUsername("");sT("Telegram disconnected");}catch{setTgConnected(false);}};
    const chevron=<svg width="16" height="16" fill="none" stroke={T.tx3} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>;
    const quickLinks=[
      {l:"Dashboard",i:I.dash,p:"dashboard"},
      {l:"Wallet",i:I.wall,p:"wallet"},
      {l:"Exchange",i:I.exch,p:"exchange"},
      {l:"Transactions",i:I.txn,p:"transactions"},
      {l:"Deposit",i:I.depX,p:"deposit",c:T.pr},
      {l:"Crypto Deposit",i:I.cDep,p:"crypto-deposit"},
      {l:"Crypto Withdraw",i:I.cWd,p:"crypto-withdraw"},
      {l:"Withdraw (XAF)",i:I.wdX,p:"withdraw"},
      {l:"Support",i:<svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,p:null},
    ];
    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Profile</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:28}}>Manage your account settings</p>
      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 1fr",gap:20,alignItems:"start"}}>
        {/* Left: Profile Card */}
        <div style={{...cd,padding:"32px 28px",textAlign:"center"}}>
          {/* Avatar */}
          <div style={{width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg,#7C3AED,#A855F7)",margin:"0 auto 16px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:32,fontWeight:800,color:"#fff",boxShadow:"0 8px 24px rgba(124,58,237,.3)"}}>{user.fullName.charAt(0).toUpperCase()}</div>
          <div style={{fontSize:20,fontWeight:800,marginBottom:4}}>{user.fullName}</div>
          <div style={{fontSize:14,color:T.tx2,marginBottom:20}}>{user.email}</div>
          {/* Telegram & 2FA status */}
          <div style={{borderTop:`1px solid ${T.bdL}`,paddingTop:16,marginBottom:20}}>
            {[{l:"Telegram",v:tgConnected?`@${tgUsername}`:"Not Connected",connected:tgConnected},{l:"2FA",v:tfa?"Enabled":"Disabled",connected:tfa}].map((item,i)=>(
              <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",fontSize:14}}>
                <span style={{color:T.tx2,fontWeight:500}}>{item.l}</span>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  {!item.connected&&<span style={{color:T.rd,fontSize:16}}>‚úï</span>}
                  {item.connected&&<span style={{color:T.gn,fontSize:16}}>‚úì</span>}
                  <span style={{color:item.connected?T.gn:T.tx3,fontWeight:500}}>{item.v}</span>
                </div>
              </div>
            ))}
          </div>
          {/* Action Buttons */}
          <div style={{display:"flex",flexDirection:"column",gap:10}}>
            <button onClick={()=>setShowPwModal(true)} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:10,fontSize:14,padding:"12px",background:T.pr,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all .15s"}}>
              <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M12 2a5 5 0 015 5v3H7V7a5 5 0 015-5z"/><rect x="3" y="10" width="18" height="12" rx="2"/><circle cx="12" cy="16" r="1"/></svg>
              Change Password
            </button>
            <button onClick={()=>setShow2FA(true)} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:10,fontSize:14,padding:"12px",background:"linear-gradient(135deg,#7C3AED,#A855F7)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all .15s"}}>
              <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
              Manage 2FA
            </button>
            <button onClick={()=>setShowSettings(true)} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:500,borderRadius:10,fontSize:14,padding:"12px",background:T.wh,color:T.tx2,border:`1.5px solid ${T.bd}`,display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all .15s"}}>
              <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
              Settings
            </button>
            <button onClick={()=>{setUser(null);setBal(0);setPort({});setTxH([]);setView("landing");localStorage.removeItem("cxc_token");window.history.pushState(null,'','/');setOtp(false);}} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:10,fontSize:14,padding:"12px",background:T.rd,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all .15s"}}>
              {I.out} Logout
            </button>
          </div>
          {/* Telegram Banner */}
          {!tgConnected ? (
          <div style={{marginTop:20,padding:"14px 16px",borderRadius:10,background:"#EFF6FF",border:"1px solid #BFDBFE",display:"flex",alignItems:"center",gap:12}}>
            <div style={{width:32,height:32,borderRadius:8,background:"#3B82F6",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.01-.03.01-.14-.07-.2-.08-.06-.19-.04-.27-.02-.12.02-1.96 1.25-5.54 3.66-.52.36-1.0.54-1.42.53-.47-.01-1.37-.27-2.04-.49-.82-.27-1.47-.42-1.41-.88.03-.24.37-.49 1.02-.75 3.98-1.73 6.64-2.87 7.97-3.44 3.8-1.58 4.59-1.86 5.1-1.87.11 0 .37.03.54.17.14.12.18.28.2.45-.01.06.01.24 0 .37z"/></svg>
            </div>
            <div style={{flex:1,textAlign:"left"}}><div style={{fontSize:13,fontWeight:600,color:T.tx}}>Connect Telegram to receive instant updates</div><div style={{fontSize:11,color:T.tx2,marginTop:2}}>Get notified for deposits, trades & withdrawals</div></div>
            <button onClick={connectTelegram} disabled={tgLoading} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:8,fontSize:12,padding:"8px 16px",background:"#3B82F6",color:"#fff",display:"flex",alignItems:"center",gap:4,opacity:tgLoading?.7:1}}>{tgLoading&&<Spin sz={12} c="#fff"/>}{tgLoading?"Waiting...":"Connect"}</button>
          </div>
          ) : (
          <div style={{marginTop:20,padding:"14px 16px",borderRadius:10,background:T.gnL,border:`1px solid ${T.gnBd||"#A7F3D0"}`,display:"flex",alignItems:"center",gap:12}}>
            <div style={{width:32,height:32,borderRadius:8,background:T.gn,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.01-.03.01-.14-.07-.2-.08-.06-.19-.04-.27-.02-.12.02-1.96 1.25-5.54 3.66-.52.36-1.0.54-1.42.53-.47-.01-1.37-.27-2.04-.49-.82-.27-1.47-.42-1.41-.88.03-.24.37-.49 1.02-.75 3.98-1.73 6.64-2.87 7.97-3.44 3.8-1.58 4.59-1.86 5.1-1.87.11 0 .37.03.54.17.14.12.18.28.2.45-.01.06.01.24 0 .37z"/></svg>
            </div>
            <div style={{flex:1,textAlign:"left"}}><div style={{fontSize:13,fontWeight:600,color:T.tx}}>Telegram Connected ‚úì</div><div style={{fontSize:11,color:T.tx2,marginTop:2}}>Receiving notifications as @{tgUsername}</div></div>
            <button onClick={disconnectTelegram} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:500,borderRadius:8,fontSize:12,padding:"8px 14px",background:T.wh||"#fff",color:T.rd,border:`1px solid ${T.rd}30`}}>Disconnect</button>
          </div>
          )}
        </div>
        {/* Right: Quick Access */}
        <div style={{...cd,padding:"24px 0"}}>
          <h3 style={{fontSize:18,fontWeight:800,padding:"0 24px",marginBottom:8}}>Quick Access</h3>
          {quickLinks.map((lnk,i)=>(
            <div key={i} onClick={()=>{if(lnk.p)setPg(lnk.p);}} style={{display:"flex",alignItems:"center",gap:12,padding:"14px 24px",cursor:lnk.p?"pointer":"default",borderBottom:`1px solid ${T.bdL}`,transition:"background .1s"}} onMouseEnter={e=>{if(lnk.p)e.currentTarget.style.background=T.bg;}} onMouseLeave={e=>e.currentTarget.style.background=""}>
              <span style={{display:"flex",alignItems:"center",color:lnk.c||T.tx3}}>{lnk.i}</span>
              <span style={{flex:1,fontSize:14,fontWeight:500,color:lnk.c||T.tx}}>{lnk.l}</span>
              {chevron}
            </div>
          ))}
        </div>
      </div>
      {/* Change Password Modal */}
      {showPwModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(4px)"}} onClick={()=>setShowPwModal(false)}>
        <div onClick={e=>e.stopPropagation()} style={{background:T.wh,borderRadius:16,width:420,padding:28,boxShadow:"0 20px 60px rgba(0,0,0,.15)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><h3 style={{fontSize:18,fontWeight:800}}>Change Password</h3><span onClick={()=>setShowPwModal(false)} style={{cursor:"pointer",fontSize:20,color:T.tx3}}>‚úï</span></div>
          <div style={{marginBottom:14}}><label style={lS}>Current Password</label><input type="password" style={iS} placeholder="Enter current password" value={pwForm.cur} onChange={e=>setPwForm(x=>({...x,cur:e.target.value}))}/></div>
          <div style={{marginBottom:14}}><label style={lS}>New Password</label><input type="password" style={iS} placeholder="Min. 8 characters" value={pwForm.nw} onChange={e=>setPwForm(x=>({...x,nw:e.target.value}))}/></div>
          <div style={{marginBottom:14}}><label style={lS}>Confirm New Password</label><input type="password" style={iS} placeholder="Repeat new password" value={pwForm.cnf} onChange={e=>setPwForm(x=>({...x,cnf:e.target.value}))}/></div>
          {pwMsg&&<div style={{color:pwMsg.includes("success")?T.gn:T.rd,fontSize:13,marginBottom:12}}>{pwMsg}</div>}
          <button onClick={()=>{if(pwForm.cur.length<6){setPwMsg("Enter current password");return;}if(pwForm.nw.length<8){setPwMsg("New password min 8 chars");return;}if(pwForm.nw!==pwForm.cnf){setPwMsg("Passwords don't match");return;}setPwMsg("Password changed successfully!");setPwForm({cur:"",nw:"",cnf:""});setTimeout(()=>setShowPwModal(false),1500);}} style={{...bP,width:"100%"}}>Update Password</button>
        </div>
      </div>}
      {/* 2FA Modal */}
      {show2FA&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(4px)"}} onClick={()=>setShow2FA(false)}>
        <div onClick={e=>e.stopPropagation()} style={{background:T.wh,borderRadius:16,width:420,padding:28,boxShadow:"0 20px 60px rgba(0,0,0,.15)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><h3 style={{fontSize:18,fontWeight:800}}>Two-Factor Authentication</h3><span onClick={()=>setShow2FA(false)} style={{cursor:"pointer",fontSize:20,color:T.tx3}}>‚úï</span></div>
          <div style={{textAlign:"center",padding:"20px 0"}}>
            <div style={{width:64,height:64,borderRadius:"50%",margin:"0 auto 16px",background:tfa?T.gnL:"#FEF3C7",display:"flex",alignItems:"center",justifyContent:"center",fontSize:28}}>{tfa?"üîí":"üîì"}</div>
            <div style={{fontSize:16,fontWeight:700,marginBottom:4}}>{tfa?"2FA is Enabled":"2FA is Disabled"}</div>
            <p style={{fontSize:13,color:T.tx2,marginBottom:20,lineHeight:1.6}}>{tfa?"Your account is protected with two-factor authentication.":"Add an extra layer of security to your account by enabling 2FA."}</p>
            <button onClick={()=>{setTfa(!tfa);sT(tfa?"2FA disabled":"2FA enabled!");setTimeout(()=>setShow2FA(false),800);}} style={{...bP,background:tfa?T.rd:"linear-gradient(135deg,#7C3AED,#A855F7)",padding:"12px 32px"}}>{tfa?"Disable 2FA":"Enable 2FA"}</button>
          </div>
        </div>
      </div>}
      {/* Settings Modal */}
      {showSettings&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",WebkitBackdropFilter:"blur(8px)",backdropFilter:"blur(4px)"}} onClick={()=>setShowSettings(false)}>
        <div onClick={e=>e.stopPropagation()} style={{background:T.wh,borderRadius:16,width:440,padding:28,boxShadow:"0 20px 60px rgba(0,0,0,.15)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}><h3 style={{fontSize:18,fontWeight:800}}>Settings</h3><span onClick={()=>setShowSettings(false)} style={{cursor:"pointer",fontSize:20,color:T.tx3}}>‚úï</span></div>
          {[{l:"Display Currency",v:"XAF (Central African CFA)"},{l:"Language",v:"English"},{l:"Timezone",v:"Africa/Douala (GMT+1)"},{l:"Email Notifications",v:"Enabled",c:T.gn},{l:"Price Alerts",v:"Enabled",c:T.gn},{l:"Exchange Rate",v:"$1 = 530 XAF"}].map((s,i)=>(
            <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 0",borderBottom:`1px solid ${T.bdL}`,fontSize:14}}>
              <span style={{color:T.tx2}}>{s.l}</span>
              <span style={{fontWeight:600,color:s.c||T.tx}}>{s.v}</span>
            </div>
          ))}
          <div style={{marginTop:16,padding:"12px 16px",borderRadius:10,background:T.bg,fontSize:13,color:T.tx2}}>
            <div style={{fontWeight:600,color:T.tx,marginBottom:4}}>Account Information</div>
            <div>Member since: {new Date(user.joined).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})}</div>
            <div>Phone: +237 {user.phone}</div>
            <div>Country: Cameroon üá®üá≤</div>
          </div>
        </div>
      </div>}
    </div>);
  };


  // ‚ïê‚ïê‚ïê SUPPORT PAGE ‚ïê‚ïê‚ïê
  const SupportPage=()=>{
    const submitTicket=async()=>{
      if(!tktSubject.trim()||tktSubject.length<3)return sT("Enter a subject (min 3 characters)","err");
      if(!tktMsg.trim()||tktMsg.length<10)return sT("Describe your issue (min 10 characters)","err");
      try{
        const d=await API("/support/create",{method:"POST",body:JSON.stringify({subject:tktSubject.trim(),message:tktMsg.trim(),category:tktCat})});
        setTickets(prev=>[d.ticket,...prev]);setTktSubject("");setTktMsg("");setTktCat("general");sT("Ticket submitted! We'll respond within 24 hours.");
      }catch(e){sT(e.message||"Failed to submit ticket","err");}
    };
    const sendReply=async(ticketId)=>{
      if(!tktReply.trim())return;
      try{
        const d=await API("/support/reply",{method:"POST",body:JSON.stringify({ticketId,message:tktReply.trim()})});
        setTickets(prev=>prev.map(t=>t.id===ticketId?{...t,messages:[...(t.messages||[]),d.message],status:d.status||t.status}:t));setTktReply("");
      }catch(e){sT(e.message||"Failed to send","err");}
    };
    const refreshTickets=async()=>{try{const d=await API("/support/tickets");setTickets(d.tickets||[]);}catch{}};
    const catColors={general:T.pr,deposit:"#F59E0B",withdrawal:"#EF4444",trading:"#10B981",account:"#8B5CF6",technical:"#6366F1"};
    const statusColors={open:T.am,pending:T.pr,"in-progress":"#8B5CF6",resolved:T.gn,closed:T.tx3};
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,overflow:"hidden"};

    // Viewing a specific ticket
    if(tktView){
      const tk=tickets.find(t=>t.id===tktView);
      if(!tk)return null;
      return(<div>
        <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:24}}>
          <div onClick={()=>setTktView(null)} style={{cursor:"pointer",padding:8,borderRadius:10,background:T.bg,display:"flex"}}>
            <svg width="18" height="18" fill="none" stroke={T.tx} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
          </div>
          <div style={{flex:1}}>
            <h2 style={{fontSize:20,fontWeight:800}}>{tk.subject}</h2>
            <div style={{display:"flex",alignItems:"center",gap:8,marginTop:4}}>
              <span style={{padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:700,background:(statusColors[tk.status]||T.tx3)+"18",color:statusColors[tk.status]||T.tx3,textTransform:"uppercase"}}>{tk.status}</span>
              <span style={{padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:600,background:(catColors[tk.category]||T.pr)+"14",color:catColors[tk.category]||T.pr}}>{tk.category}</span>
              <span style={{fontSize:12,color:T.tx3}}>#{tk.id}</span>
            </div>
          </div>
        </div>
        <div style={sCard}>
          <div style={{maxHeight:400,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:20}}>
            {(tk.messages||[{from:"user",text:tk.message,date:tk.date}]).map((msg,i)=>{
              const isAdmin=msg.from==="admin";
              return(<div key={i} style={{display:"flex",flexDirection:"column",alignItems:isAdmin?"flex-start":"flex-end",marginBottom:16}}>
                <div style={{maxWidth:"80%",padding:"12px 16px",borderRadius:isAdmin?"4px 14px 14px 14px":"14px 4px 14px 14px",background:isAdmin?"#F3F4F6":"linear-gradient(135deg,#4361EE,#5B6CF0)",color:isAdmin?T.tx:"#fff",fontSize:14,lineHeight:1.5}}>
                  {msg.text}
                </div>
                <div style={{display:"flex",alignItems:"center",gap:6,marginTop:4,fontSize:11,color:T.tx3}}>
                  <span style={{fontWeight:600}}>{isAdmin?"Support Team":"You"}</span>
                  <span>¬∑</span>
                  <span>{tA(msg.date)}</span>
                </div>
              </div>);
            })}
          </div>
          {tk.status!=="closed"&&tk.status!=="resolved"&&<div style={{padding:"16px 20px",borderTop:"1px solid "+T.bd,display:"flex",gap:10}}>
            <input value={tktReply} onChange={e=>setTktReply(e.target.value)} placeholder="Type your reply..." onKeyDown={e=>{if(e.key==="Enter"&&!e.shiftKey)sendReply(tk.id);}} style={{...iS,flex:1}}/>
            <button onClick={()=>sendReply(tk.id)} style={{...bP,padding:"12px 20px",display:"flex",alignItems:"center",gap:6}}>
              <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Send
            </button>
          </div>}
        </div>
        <button onClick={refreshTickets} style={{...bO,marginTop:16,fontSize:13,padding:"10px 20px"}}>‚Üª Refresh Messages</button>
      </div>);
    }

    return(<div>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:isMob?"flex-start":"center",flexDirection:isMob?"column":"row",gap:12,marginBottom:24}}>
        <div><h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Support Center</h2><p style={{color:T.tx2,fontSize:14}}>Get help from our support team</p></div>
        <button onClick={refreshTickets} style={{...bO,fontSize:13,padding:"8px 16px",display:"flex",alignItems:"center",gap:6}}>
          <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>Refresh
        </button>
      </div>
      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 380px",gap:20,alignItems:"start"}}>
        {/* Ticket List */}
        <div>
          <div style={{...sCard,marginBottom:20}}>
            <div style={{padding:"18px 24px",borderBottom:"1px solid "+T.bd,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <h3 style={{fontSize:16,fontWeight:700}}>Your Tickets</h3>
              <span style={{fontSize:12,color:T.tx3}}>{tickets.length} total</span>
            </div>
            {tickets.length===0?
              <div style={{padding:"48px 24px",textAlign:"center"}}>
                <svg width="48" height="48" fill="none" stroke="#D1D5DB" strokeWidth="1.5" strokeLinecap="round" viewBox="0 0 24 24" style={{margin:"0 auto 12px"}}><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z"/></svg>
                <div style={{fontSize:15,fontWeight:600,color:T.tx2}}>No tickets yet</div>
                <div style={{fontSize:13,color:T.tx3,marginTop:4}}>Submit a ticket to get help from our team</div>
              </div>:
              tickets.map(tk=>(
                <div key={tk.id} onClick={()=>setTktView(tk.id)} style={{padding:"16px 24px",borderBottom:"1px solid "+T.bdL,cursor:"pointer",transition:"background .1s"}} onMouseEnter={e=>e.currentTarget.style.background=T.bg} onMouseLeave={e=>e.currentTarget.style.background=""}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}>
                    <div style={{fontSize:14,fontWeight:600,flex:1}}>{tk.subject}</div>
                    <span style={{padding:"2px 8px",borderRadius:5,fontSize:10,fontWeight:700,background:(statusColors[tk.status]||T.tx3)+"18",color:statusColors[tk.status]||T.tx3,textTransform:"uppercase",whiteSpace:"nowrap",marginLeft:8}}>{tk.status}</span>
                  </div>
                  <div style={{fontSize:13,color:T.tx2,marginBottom:6,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{tk.message}</div>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <span style={{padding:"2px 8px",borderRadius:5,fontSize:10,fontWeight:600,background:(catColors[tk.category]||T.pr)+"14",color:catColors[tk.category]||T.pr}}>{tk.category}</span>
                    <span style={{fontSize:11,color:T.tx3}}>#{tk.id} ¬∑ {tA(tk.date)}</span>
                    <span style={{fontSize:11,color:T.tx3,marginLeft:"auto"}}>{(tk.messages||[]).length} messages</span>
                  </div>
                </div>
              ))
            }
          </div>
        </div>
        {/* New Ticket Form */}
        <div style={{...sCard,padding:24}}>
          <h3 style={{fontSize:16,fontWeight:700,marginBottom:4}}>Submit a Ticket</h3>
          <p style={{fontSize:12,color:T.tx2,marginBottom:20}}>Our team typically responds within 24 hours</p>
          <div style={{marginBottom:14}}>
            <label style={lS}>Category</label>
            <select value={tktCat} onChange={e=>setTktCat(e.target.value)} style={{...iS,cursor:"pointer"}}>
              <option value="general">General Inquiry</option>
              <option value="deposit">Deposit Issue</option>
              <option value="withdrawal">Withdrawal Issue</option>
              <option value="trading">Trading Problem</option>
              <option value="account">Account & Security</option>
              <option value="technical">Technical Issue</option>
            </select>
          </div>
          <div style={{marginBottom:14}}>
            <label style={lS}>Subject</label>
            <input value={tktSubject} onChange={e=>setTktSubject(e.target.value)} placeholder="Brief description of your issue" style={iS}/>
          </div>
          <div style={{marginBottom:14}}>
            <label style={lS}>Message</label>
            <textarea value={tktMsg} onChange={e=>setTktMsg(e.target.value)} placeholder="Describe your issue in detail..." rows={5} style={{...iS,resize:"vertical",minHeight:120,fontFamily:f}}/>
          </div>
          <button onClick={submitTicket} style={{...bP,width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
            <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Submit Ticket
          </button>
          <div style={{marginTop:20,padding:16,borderRadius:10,background:T.bg}}>
            <div style={{fontSize:13,fontWeight:700,marginBottom:8}}>Quick Help</div>
            {[{q:"How do I deposit?",a:"Go to Deposit page, select MoMo or Orange Money, enter amount"},{q:"Why is my withdrawal pending?",a:"Withdrawals are processed within 30 minutes"},{q:"How to enable 2FA?",a:"Go to Settings ‚Üí Connect Telegram ‚Üí Enable 2FA"}].map((faq,i)=>(
              <div key={i} style={{padding:"8px 0",borderBottom:i<2?"1px solid "+T.bd:"none"}}>
                <div style={{fontSize:12,fontWeight:600,color:T.pr}}>{faq.q}</div>
                <div style={{fontSize:11,color:T.tx2,marginTop:2}}>{faq.a}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>);
  };

  // ‚ïê‚ïê‚ïê SETTINGS PAGE ‚ïê‚ïê‚ïê
  const SettingsPage=()=>{
    const connectTelegram=async()=>{setTgLoading(true);try{const r=await fetch(TG_API+"/api/telegram/generate-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:user.email,email:user.email})});const d=await r.json();if(d.deepLink){window.location.href=d.deepLink;sT("Opened Telegram ‚Äî tap Start in the bot!");let polls=0;const iv=setInterval(async()=>{polls++;try{const s=await fetch(TG_API+"/api/telegram/status/"+user.email);const sd=await s.json();if(sd.connected){setTgConnected(true);setTgUsername(sd.username||"Connected");clearInterval(iv);sT("Telegram connected!");}}catch{}if(polls>30)clearInterval(iv);},3000);}}catch(e){sT("Telegram bot not available","err");}setTgLoading(false);};
    const disconnectTelegram=async()=>{try{await fetch(TG_API+"/api/telegram/disconnect/"+user.email,{method:"POST"});setTgConnected(false);setTgUsername("");sT("Telegram disconnected");}catch{setTgConnected(false);}};
    const doPwChange=async()=>{if(pwForm.cur.length<1){setPwMsg("Enter current password");return;}if(pwForm.nw.length<8){setPwMsg("New password must be at least 8 characters");return;}if(pwForm.nw!==pwForm.cnf){setPwMsg("Passwords don't match");return;}
      try{const d=await API("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:pwForm.cur,newPassword:pwForm.nw})});setPwMsg(d.message||"Password changed!");setPwForm({cur:"",nw:"",cnf:""});}catch(e){setPwMsg(e.message||"Failed to change password");}};
    const pwStrength=pwForm.nw.length===0?null:pwForm.nw.length<6?"weak":pwForm.nw.length<10?"medium":"strong";
    const sCard={background:T.wh,borderRadius:14,border:"1px solid "+T.bd,padding:isMob?20:28,marginBottom:20};
    const sHdr={fontSize:18,fontWeight:800,marginBottom:4};
    const sSub={fontSize:13,color:T.tx2,marginBottom:20};
    const sRow={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 0",borderBottom:"1px solid "+T.bdL};

    return(<div>
      <h2 style={{fontSize:26,fontWeight:800,marginBottom:4}}>Settings</h2>
      <p style={{color:T.tx2,fontSize:14,marginBottom:28}}>Manage your account preferences and security</p>

      <div style={{display:"grid",gridTemplateColumns:isMob?"1fr":"1fr 320px",gap:20,alignItems:"start"}}>
        {/* Left Column - Main Settings */}
        <div>
          {/* Telegram Connection */}
          <div style={sCard}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
              <div><h3 style={sHdr}>Telegram Connection</h3><p style={sSub}>Connect Telegram to receive notifications and enable 2FA</p></div>
            </div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderRadius:12,background:tgConnected?"#ECFDF5":"#F0F2F5"}}>
              <div style={{display:"flex",alignItems:"center",gap:12}}>
                <div style={{width:40,height:40,borderRadius:10,background:tgConnected?"#10B981":"#3B82F6",display:"flex",alignItems:"center",justifyContent:"center"}}>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.12.12 0 00-.07-.2c-.08-.06-.19-.04-.27-.02-.12.02-1.96 1.25-5.54 3.66-.52.36-1 .54-1.42.53-.47-.01-1.37-.27-2.04-.49-.82-.27-1.47-.42-1.41-.88.03-.24.37-.49 1.02-.75 3.98-1.73 6.64-2.87 7.97-3.44 3.8-1.58 4.59-1.86 5.1-1.87.11 0 .37.03.54.17.14.12.18.28.2.45-.01.06.01.24 0 .37z"/></svg>
                </div>
                <div>
                  <div style={{fontSize:14,fontWeight:700}}>{tgConnected?"Connected":"Not Connected"}</div>
                  <div style={{fontSize:12,color:T.tx2}}>{tgConnected?"@"+tgUsername:"Connect to receive alerts"}</div>
                </div>
              </div>
              {tgConnected?
                <button onClick={disconnectTelegram} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:8,fontSize:12,padding:"8px 16px",background:"#FEE2E2",color:T.rd}}>Disconnect</button>:
                <button onClick={connectTelegram} disabled={tgLoading} style={{border:"none",cursor:"pointer",fontFamily:f,fontWeight:700,borderRadius:8,fontSize:12,padding:"10px 20px",background:"#3B82F6",color:"#fff",opacity:tgLoading?.6:1}}>{tgLoading?<Spin sz={14} c="#fff"/>:"Connect Telegram"}</button>
              }
            </div>
          </div>

          {/* Two-Factor Authentication */}
          <div style={sCard}>
            <h3 style={sHdr}>Two-Factor Authentication</h3>
            <p style={sSub}>Protect your account with Telegram-based 2FA</p>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderRadius:12,background:tfa?"#ECFDF5":"#FFFBEB"}}>
              <div style={{display:"flex",alignItems:"center",gap:12}}>
                <div style={{fontSize:28}}>{tfa?"üîí":"üîì"}</div>
                <div>
                  <div style={{fontSize:14,fontWeight:700}}>{tfa?"2FA Enabled":"2FA Disabled"}</div>
                  <div style={{fontSize:12,color:T.tx2}}>{tfa?"Extra security layer active":tgConnected?"Click toggle to enable":"Connect Telegram first"}</div>
                </div>
              </div>
              <div onClick={()=>{if(!tgConnected){sT("Connect Telegram first to enable 2FA","err");return;}setTfa(!tfa);sT(tfa?"2FA disabled":"2FA enabled!");}} style={{width:48,height:26,borderRadius:13,background:tfa?T.gn:"#D1D5DB",cursor:tgConnected?"pointer":"not-allowed",opacity:tgConnected?1:.5,position:"relative",transition:"background .2s"}}>
                <div style={{width:22,height:22,borderRadius:11,background:"#fff",position:"absolute",top:2,left:tfa?24:2,transition:"left .2s",boxShadow:"0 1px 3px rgba(0,0,0,.2)"}}/>
              </div>
            </div>
            {!tgConnected&&<p style={{fontSize:12,color:T.am,marginTop:10,display:"flex",alignItems:"center",gap:4}}>‚ö† Please connect Telegram first to enable 2FA</p>}
          </div>

          {/* Change Password */}
          <div style={sCard}>
            <h3 style={sHdr}>Change Password</h3>
            <p style={sSub}>Update your account password</p>
            <div style={{marginBottom:14}}><label style={lS}>Current Password</label><input type="password" style={iS} placeholder="Enter current password" value={pwForm.cur} onChange={e=>setPwForm(x=>({...x,cur:e.target.value}))}/></div>
            <div style={{marginBottom:6}}><label style={lS}>New Password</label><input type="password" style={iS} placeholder="Min. 8 characters" value={pwForm.nw} onChange={e=>setPwForm(x=>({...x,nw:e.target.value}))}/></div>
            {pwForm.nw.length>0&&<div style={{marginBottom:14}}>
              <div style={{display:"flex",gap:4,marginTop:6,marginBottom:4}}>{["weak","medium","strong"].map((s,i)=>(<div key={i} style={{flex:1,height:4,borderRadius:2,background:pwStrength==="weak"?(i===0?"#EF4444":"#E5E7EB"):pwStrength==="medium"?(i<2?"#F59E0B":"#E5E7EB"):"#10B981"}}/>))}</div>
              <div style={{fontSize:11,fontWeight:600,color:pwStrength==="weak"?T.rd:pwStrength==="medium"?T.am:T.gn,textTransform:"capitalize"}}>{pwStrength} password</div>
            </div>}
            <div style={{marginBottom:14}}><label style={lS}>Confirm New Password</label><input type="password" style={iS} placeholder="Repeat new password" value={pwForm.cnf} onChange={e=>setPwForm(x=>({...x,cnf:e.target.value}))}/></div>
            {pwMsg&&<div style={{padding:"10px 14px",borderRadius:8,marginBottom:12,fontSize:13,fontWeight:600,background:pwMsg.toLowerCase().includes("success")||pwMsg.toLowerCase().includes("changed")?T.gnL:T.rdL,color:pwMsg.toLowerCase().includes("success")||pwMsg.toLowerCase().includes("changed")?T.gn:T.rd}}>{pwMsg}</div>}
            <button onClick={doPwChange} style={{...bP,width:"100%"}}>Update Password</button>
          </div>

          {/* Account Settings */}
          <div style={sCard}>
            <h3 style={sHdr}>Account Settings</h3>
            <p style={sSub}>General preferences</p>
            {[{l:"Display Currency",v:"XAF (Central African CFA)"},{l:"Language",v:"English"},{l:"Timezone",v:"Africa/Douala (GMT+1)"},{l:"Email Notifications",v:"Enabled",c:T.gn},{l:"Price Alerts",v:"Enabled",c:T.gn},{l:"Exchange Rate",v:"$1 = 530 XAF"}].map((s,i)=>(
              <div key={i} style={sRow}><span style={{color:T.tx2,fontSize:14}}>{s.l}</span><span style={{fontWeight:600,fontSize:14,color:s.c||T.tx}}>{s.v}</span></div>
            ))}
          </div>
        </div>

        {/* Right Column - Profile & Security */}
        <div>
          {/* Profile Card */}
          <div style={{...sCard,textAlign:"center"}}>
            <div style={{width:72,height:72,borderRadius:"50%",background:"linear-gradient(135deg,#4361EE,#7C3AED)",margin:"0 auto 14px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,fontWeight:800,color:"#fff",boxShadow:"0 6px 20px rgba(67,97,238,.3)"}}>{user.fullName.charAt(0).toUpperCase()}</div>
            <div style={{fontSize:18,fontWeight:800,marginBottom:2}}>{user.fullName}</div>
            <div style={{fontSize:13,color:T.tx2,marginBottom:4}}>{user.email}</div>
            <div style={{fontSize:12,color:T.tx3}}>+237 {user.phone}</div>
            <div style={{fontSize:11,color:T.tx3,marginTop:8}}>Member since {new Date(user.joined).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}</div>
          </div>

          {/* Security Status */}
          <div style={sCard}>
            <h3 style={{fontSize:16,fontWeight:700,marginBottom:16,display:"flex",alignItems:"center",gap:8}}>
              <svg width="18" height="18" fill="none" stroke={T.pr} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              Security
            </h3>
            {[
              {l:"Password",ok:true,v:"Set"},
              {l:"Email",ok:true,v:"Verified"},
              {l:"Telegram",ok:tgConnected,v:tgConnected?"Connected":"Not connected"},
              {l:"2FA",ok:tfa,v:tfa?"Enabled":"Disabled"},
            ].map((s,i)=>(
              <div key={i} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderBottom:i<3?"1px solid "+T.bdL:"none"}}>
                <span style={{fontSize:13,color:T.tx2}}>{s.l}</span>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  <div style={{width:8,height:8,borderRadius:4,background:s.ok?T.gn:T.rd}}/>
                  <span style={{fontSize:13,fontWeight:600,color:s.ok?T.gn:T.tx3}}>{s.v}</span>
                </div>
              </div>
            ))}
          </div>

          {/* KYC Status */}
          <div style={sCard}>
            <h3 style={{fontSize:16,fontWeight:700,marginBottom:16,display:"flex",alignItems:"center",gap:8}}>
              <svg width="18" height="18" fill="none" stroke={T.am} strokeWidth="2" strokeLinecap="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M5 20c0-3.3 3.1-6 7-6s7 2.7 7 6"/><path d="M15 3l2 2 4-4"/></svg>
              KYC Verification
            </h3>
            <div style={{padding:"16px 20px",borderRadius:12,background:kycStatus==="verified"?"#ECFDF5":kycStatus==="pending"?"#FFFBEB":"#FEF2F2"}}>
              <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
                <div style={{width:10,height:10,borderRadius:5,background:kycStatus==="verified"?T.gn:kycStatus==="pending"?T.am:T.rd}}/>
                <span style={{fontSize:14,fontWeight:700,textTransform:"capitalize"}}>{kycStatus==="verified"?"Verified":kycStatus==="pending"?"KYC Pending":"Not Verified"}</span>
              </div>
              <p style={{fontSize:12,color:T.tx2,lineHeight:1.5}}>{kycStatus==="verified"?"Your identity has been verified. Full trading access enabled.":kycStatus==="pending"?"Your documents are being reviewed. This usually takes 24-48 hours.":"Complete KYC verification to unlock higher limits."}</p>
              {kycStatus!=="verified"&&<button onClick={()=>{setKycStatus("pending");sT("KYC verification submitted! Review takes 24-48 hours.");}} style={{marginTop:12,border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:8,fontSize:12,padding:"8px 16px",background:T.am,color:"#fff"}}>{kycStatus==="pending"?"Under Review...":"Submit KYC"}</button>}
            </div>
          </div>

          {/* Danger Zone */}
          <div style={{...sCard,borderColor:"#FCA5A5"}}>
            <h3 style={{fontSize:16,fontWeight:700,marginBottom:8,color:T.rd}}>Danger Zone</h3>
            <p style={{fontSize:12,color:T.tx2,marginBottom:16}}>Irreversible actions</p>
            <button onClick={()=>{setUser(null);setBal(0);setPort({});setTxH([]);setView("landing");localStorage.removeItem("cxc_token");window.history.pushState(null,'','/');setOtp(false);}} style={{width:"100%",border:"none",cursor:"pointer",fontFamily:f,fontWeight:600,borderRadius:10,fontSize:14,padding:"12px",background:T.rd,color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>{I.out} Logout</button>
          </div>
        </div>
      </div>
    </div>);
  };

  return(
    <div style={{fontFamily:f,background:T.bg,color:T.tx,minHeight:"100vh"}}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap');*{margin:0;padding:0;box-sizing:border-box}body{background:${T.bg}}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:${T.bg}}::-webkit-scrollbar-thumb{background:${T.bd};border-radius:3px}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}input[type=number]{-moz-appearance:textfield}input:focus{border-color:${T.pr}!important;box-shadow:0 0 0 3px ${T.pr}12!important}select:focus{border-color:${T.pr}!important}button{transition:all .15s}button:hover{opacity:.9}button:active{transform:scale(.98)}@keyframes spin{to{transform:rotate(360deg)}}@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes toastIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}@media(max-width:768px){.ex-grid-3{grid-template-columns:1fr!important}}`}</style>
      <Sidebar/>
      <ExModal/>
      {isMob&&<div style={{position:"fixed",bottom:0,left:0,right:0,zIndex:60,background:T.wh,borderTop:`1px solid ${T.bd}`,display:"flex",justifyContent:"space-around",padding:"8px 0 12px",boxShadow:"0 -2px 12px rgba(0,0,0,.06)"}}>{[{id:"dashboard",l:"Home",i:I.dash},{id:"wallet",l:"Wallet",i:I.wall},{id:"exchange",l:"Trade",i:I.exch},{id:"deposit",l:"Deposit",i:I.depX},{id:"profile",l:"Profile",i:I.prof}].map(n=>{const a=pg===n.id;return(<div key={n.id} onClick={()=>{setPg(n.id);if(n.id==="deposit")setDS("form");}} style={{display:"flex",flexDirection:"column",alignItems:"center",gap:2,cursor:"pointer",color:a?T.pr:T.tx3,fontSize:10,fontWeight:a?700:500}}><span style={{display:"flex"}}>{n.i}</span>{n.l}</div>);})}</div>}
      <div style={{marginLeft:isMob?0:220}}>
        <TopBar title={NAV.find(n=>n.id===pg)?.l||"Dashboard"}/>
        <main style={{padding:isMob?"16px 16px 80px":"24px 32px 60px",animation:"fadeUp .3s ease"}}>
          {toast&&<div style={{position:"fixed",top:12,right:24,padding:"12px 20px",borderRadius:10,zIndex:999,background:toast.t==="err"?T.rd:T.gn,color:"#fff",fontWeight:600,fontSize:13,boxShadow:"0 4px 20px rgba(0,0,0,.12)",animation:"toastIn .25s ease",maxWidth:400}}>{toast.m}</div>}
          {pg==="dashboard"&&<Dashboard/>}
          {pg==="wallet"&&<Wallet/>}
          {pg==="exchange"&&(exPg?<BuySellPage/>:<Exchange/>)}
          {pg==="deposit"&&<DepositPage/>}
          {pg==="crypto-deposit"&&<CryptoDep/>}
          {pg==="crypto-withdraw"&&<CryptoWd/>}
          {pg==="withdraw"&&<WithdrawPage/>}
          {pg==="transactions"&&<Txns/>}
          {pg==="profile"&&<Profile/>}
          {pg==="settings"&&<SettingsPage/>}
          {pg==="support"&&<SupportPage/>}
        </main>
      </div>
    </div>
  );
}


ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

<!-- ‚ïê‚ïê‚ïê INPUT FOCUS PRESERVATION ‚ïê‚ïê‚ïê -->
<script>
(function(){
  var _lastFocusId='',_lastFocusVal='',_lastCursorPos=0,_lastTagName='';
  // Save focus state before React re-renders
  var _mo=new MutationObserver(function(){
    var el=document.activeElement;
    if(el&&(el.tagName==='INPUT'||el.tagName==='TEXTAREA'||el.tagName==='SELECT')){
      _lastFocusId=el.id||el.getAttribute('placeholder')||'';
      _lastFocusVal=el.value||'';
      _lastCursorPos=el.selectionStart||0;
      _lastTagName=el.tagName;
      // Restore focus after React re-render
      requestAnimationFrame(function(){
        if(!_lastFocusId)return;
        var target=null;
        if(_lastFocusId){
          target=document.getElementById(_lastFocusId);
          if(!target){
            var inputs=document.querySelectorAll('input,textarea,select');
            for(var i=0;i<inputs.length;i++){
              if(inputs[i].getAttribute('placeholder')===_lastFocusId||inputs[i].id===_lastFocusId){
                target=inputs[i];break;
              }
            }
          }
        }
        if(target&&document.activeElement!==target){
          target.focus();
          if(target.setSelectionRange&&(target.type==='text'||target.type==='tel'||target.type==='number'||target.tagName==='TEXTAREA')){
            try{target.setSelectionRange(_lastCursorPos,_lastCursorPos);}catch(e){}
          }
        }
      });
    }
  });
  _mo.observe(document.getElementById('root'),{childList:true,subtree:true});
})();
</script>

<script>
// Avatar dropdown - pure JS, no JSX
document.addEventListener('click', function(e) {
  var avatar = e.target.closest('[data-avatar]');
  var existing = document.getElementById('cxc-avatar-dropdown');
  
  if (existing && !e.target.closest('#cxc-avatar-dropdown')) {
    existing.remove();
    return;
  }
  
  if (!avatar) return;
  if (existing) { existing.remove(); return; }
  
  var rect = avatar.getBoundingClientRect();
  var d = document.createElement('div');
  d.id = 'cxc-avatar-dropdown';
  d.innerHTML = '<div style="position:fixed;inset:0;z-index:89" id="cxc-drop-bg"></div>' +
    '<div style="position:fixed;top:' + (rect.bottom + 8) + 'px;right:16px;width:220px;background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.12);border:1px solid #E5E7EB;z-index:90;overflow:hidden;font-family:Inter,sans-serif">' +
    '<div style="padding:14px 16px;border-bottom:1px solid #F3F4F6"><div style="font-size:14px;font-weight:700">' + (avatar.dataset.name || '') + '</div><div style="font-size:12px;color:#9CA3AF;margin-top:2px">' + (avatar.dataset.email || '') + '</div></div>' +
    '<div class="cxc-dd-item" data-page="profile" style="display:flex;align-items:center;gap:10px;padding:11px 16px;cursor:pointer;font-size:13px;font-weight:500;color:#1F2937">Profile</div>' +
    '<div class="cxc-dd-item" data-page="settings" style="display:flex;align-items:center;gap:10px;padding:11px 16px;cursor:pointer;font-size:13px;font-weight:500;color:#1F2937">Settings</div>' +
    '<div style="border-top:1px solid #F3F4F6"><div class="cxc-dd-item" data-action="logout" style="display:flex;align-items:center;gap:10px;padding:11px 16px;cursor:pointer;font-size:13px;font-weight:600;color:#EF4444">Logout</div></div>' +
    '</div>';
  document.body.appendChild(d);
  
  d.querySelectorAll('.cxc-dd-item').forEach(function(item) {
    item.onmouseenter = function() { this.style.background = '#F9FAFB'; };
    item.onmouseleave = function() { this.style.background = ''; };
    item.onclick = function(ev) {
      ev.stopPropagation();
      d.remove();
      if (this.dataset.action === 'logout') {
        localStorage.removeItem('cxc_token');
        window.location.href = '/';
      } else if (this.dataset.page) {
        window.location.hash = '';
        window.history.pushState(null, '', '/' + this.dataset.page);
        window.dispatchEvent(new PopStateEvent('popstate'));
      }
    };
  });
  
  document.getElementById('cxc-drop-bg').onclick = function() { d.remove(); };
});
</script>

<script>
// Override Telegram connect functions after React mounts
window._cxcTgOverride = function() {
  // Wait for React to render
  var checkInterval = setInterval(function() {
    var connectBtns = document.querySelectorAll('[data-tg-connect]');
    if (connectBtns.length > 0) clearInterval(checkInterval);
  }, 1000);
};

// Intercept fetch calls to fix telegram endpoints
var _origFetch = window.fetch;
window.fetch = function(url, opts) {
  if (typeof url === 'string') {
    var token = localStorage.getItem('cxc_token');
    
    // Fix telegram generate-link ‚Üí our connect endpoint
    if (url.indexOf('/api/telegram/generate-link') !== -1) {
      return _origFetch('/api/telegram/connect', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        }
      }).then(function(r) { return r.json(); }).then(function(data) {
        if (data.link) {
          window.location.href = data.link;
          // Poll for connection
          var tries = 0;
          var pollIv = setInterval(function() {
            tries++;
            _origFetch('/api/telegram/status', {
              headers: { 'Authorization': 'Bearer ' + token }
            }).then(function(r) { return r.json(); }).then(function(s) {
              if (s.connected) {
                clearInterval(pollIv);
                // Trigger UI update by dispatching custom event
                window.dispatchEvent(new CustomEvent('tg-connected'));
              }
            }).catch(function(){});
            if (tries > 15) clearInterval(pollIv);
          }, 4000);
        }
        // Return a fake response that the old code expects
        return new Response(JSON.stringify({ link: data.link || '', code: data.code || '' }), {
          status: 200, headers: { 'Content-Type': 'application/json' }
        });
      }).catch(function(e) {
        return new Response(JSON.stringify({ error: e.message }), {
          status: 500, headers: { 'Content-Type': 'application/json' }
        });
      });
    }
    
    // Fix telegram status check
    if (url.indexOf('/api/telegram/status/') !== -1) {
      return _origFetch('/api/telegram/status', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
    }
    
    // Fix telegram disconnect
    if (url.indexOf('/api/telegram/disconnect/') !== -1) {
      return _origFetch('/api/telegram/disconnect', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        }
      });
    }
  }
  return _origFetch.apply(this, arguments);
};
</script>


<!-- ‚ïê‚ïê‚ïê LOADING GUARD ‚Äî hides React content during auto-login ‚ïê‚ïê‚ïê -->
<script>
(function(){
  if(!localStorage.getItem('cxc_token'))return;
  // 1. Inject CSS to hide React root immediately
  var s=document.createElement('style');s.id='cxcHide';
  s.textContent='#root>div{visibility:hidden!important}#cxcLG{position:fixed;inset:0;z-index:99998;background:#F0F2F5;display:flex;align-items:center;justify-content:center;font-family:Outfit,sans-serif}';
  document.head.appendChild(s);
  // 2. Loading overlay
  var ld=document.createElement('div');ld.id='cxcLG';
  ld.innerHTML='<div style="text-align:center"><div style="width:40px;height:40px;border:3px solid #E5E7EB;border-top-color:#4361EE;border-radius:50%;animation:_lg .7s linear infinite;margin:0 auto"></div><p style="margin-top:16px;color:#6B7280;font-size:14px">Loading CryptoxCore...</p></div><style>@keyframes _lg{to{transform:rotate(360deg)}}</style>';
  document.body.appendChild(ld);
  // 3. Poll for dashboard render (cheaper than MutationObserver on textContent)
  var iv=setInterval(function(){
    var el=document.querySelector('[style*="Total Portfolio"]');
    if(!el){var all=document.querySelectorAll('div');for(var i=0;i<all.length;i++){if(all[i].textContent==='Total Portfolio Worth'&&all[i].closest('[style*="linear-gradient"]')){el=all[i];break;}}}
    if(el){clear();}
  },200);
  function clear(){
    clearInterval(iv);
    var h=document.getElementById('cxcHide');if(h)h.remove();
    ld.style.opacity='0';ld.style.transition='opacity .25s';
    setTimeout(function(){if(ld.parentNode)ld.remove();},250);
  }
  // Fallback
  setTimeout(function(){clearInterval(iv);clear();},4000);
})();
</script>

<!-- ‚ïê‚ïê‚ïê PREMIUM DASHBOARD HEADER ENHANCEMENT ‚ïê‚ïê‚ïê -->
<script>
(function(){
'use strict';
var hdrCSS=document.createElement('style');
hdrCSS.id='cxcHdrPrem';
hdrCSS.textContent='\
/* Premium dashboard header */\
.cxc-prem-hdr{background:rgba(255,255,255,.72)!important;backdrop-filter:blur(28px) saturate(1.8)!important;-webkit-backdrop-filter:blur(28px) saturate(1.8)!important;border-bottom:1px solid rgba(67,97,238,.06)!important;box-shadow:0 1px 0 rgba(0,0,0,.01),0 4px 24px rgba(0,0,0,.025)!important}\
.cxc-prem-hdr::before{content:"";position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#4361EE 0%,#7C3AED 30%,#EC4899 60%,#4361EE 100%);background-size:200% 100%;animation:cxcGrad 4s linear infinite;opacity:.5}\
@keyframes cxcGrad{0%{background-position:0% 0}100%{background-position:200% 0}}\
/* Balance pill */\
.cxc-prem-bal{background:linear-gradient(135deg,#ECFDF5,#D1FAE5)!important;border:1.5px solid rgba(16,185,129,.2)!important;box-shadow:0 2px 8px rgba(16,185,129,.08)!important;transition:all .25s!important}\
.cxc-prem-bal:hover{box-shadow:0 4px 16px rgba(16,185,129,.15)!important;transform:translateY(-2px)!important}\
/* Deposit btn */\
.cxc-prem-dep{box-shadow:0 3px 12px rgba(16,185,129,.3),inset 0 1px 0 rgba(255,255,255,.2)!important;transition:all .25s!important}\
.cxc-prem-dep:hover{box-shadow:0 6px 20px rgba(16,185,129,.4)!important;transform:translateY(-2px)!important}\
/* Bell */\
.cxc-prem-bell{transition:all .2s!important}\
.cxc-prem-bell:hover{background:#EEF0F5!important;transform:scale(1.1)!important}\
/* Avatar */\
.cxc-prem-avatar{box-shadow:0 2px 10px rgba(67,97,238,.35),0 0 0 2.5px rgba(255,255,255,.9)!important;transition:all .3s!important}\
.cxc-prem-avatar:hover{box-shadow:0 4px 18px rgba(67,97,238,.45),0 0 0 3px rgba(67,97,238,.2)!important;transform:scale(1.1)!important}\
/* Hamburger */\
.cxc-prem-ham{transition:all .2s!important}\
.cxc-prem-ham:hover{background:#EEF0F5!important;transform:scale(1.05)!important}\
/* Status badges */\
.cxc-hdr-row{display:flex;align-items:center;gap:6px;margin-top:2px;flex-wrap:nowrap}\
.cxc-hdr-status{display:inline-flex;align-items:center;gap:4px;padding:2px 9px;border-radius:20px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.12);font-family:Outfit,sans-serif;font-size:10px;font-weight:600;color:#059669;white-space:nowrap;letter-spacing:.2px}\
.cxc-hdr-status .dot{width:5px;height:5px;border-radius:50%;background:#10B981;box-shadow:0 0 6px rgba(16,185,129,.6);animation:cxcPl 2s ease infinite;flex-shrink:0}\
@keyframes cxcPl{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}\
.cxc-hdr-btc{display:inline-flex;align-items:center;gap:4px;padding:2px 9px;border-radius:20px;background:rgba(247,147,26,.07);border:1px solid rgba(247,147,26,.12);font-family:Outfit,sans-serif;font-size:10px;font-weight:700;color:#92400E;white-space:nowrap}\
.cxc-hdr-btc .up{color:#059669}.cxc-hdr-btc .dn{color:#DC2626}\
';
document.head.appendChild(hdrCSS);

function enhanceHeader(){
  var hdr=document.querySelector('#root header');
  if(!hdr||hdr.classList.contains('cxc-prem-hdr'))return;
  // Must be the sticky dashboard header
  var cs=hdr.getAttribute('style')||'';
  if(cs.indexOf('sticky')===-1)return;
  // Add premium class
  hdr.classList.add('cxc-prem-hdr');
  hdr.style.position='sticky';hdr.style.position='-webkit-sticky';
  // Tag child elements by their role
  var allDivs=hdr.querySelectorAll('div');
  for(var i=0;i<allDivs.length;i++){
    var d=allDivs[i];var s=d.getAttribute('style')||'';
    // Balance pill - has green dot inside
    if(s.indexOf('F0FDF4')!==-1||s.indexOf('ECFDF5')!==-1||(s.indexOf('linear-gradient')!==-1&&s.indexOf('F0FDF')!==-1)){
      d.classList.add('cxc-prem-bal');
    }
    // Deposit button  
    if(s.indexOf('10B981')!==-1&&s.indexOf('059669')!==-1&&d.textContent.indexOf('Deposit')!==-1){
      d.classList.add('cxc-prem-dep');
    }
    // Notification bell area
    if(d.querySelector('svg path[d*="18 8A6"]')){
      d.classList.add('cxc-prem-bell');
    }
    // Avatar
    if(d.getAttribute('data-avatar')==='1'){
      d.classList.add('cxc-prem-avatar');
    }
    // Hamburger (mobile)
    if(s.indexOf('flexDirection')!==-1&&s.indexOf('column')!==-1&&s.indexOf('cursor')!==-1){
      d.classList.add('cxc-prem-ham');
    }
  }
  // Add status row below title
  var h2=hdr.querySelector('h2');
  if(h2&&!hdr.querySelector('.cxc-hdr-row')){
    var wrap=h2.parentElement;
    if(wrap){
      var row=document.createElement('div');
      row.className='cxc-hdr-row';
      row.innerHTML='<span class="cxc-hdr-status"><span class="dot"></span>Markets Open</span><span class="cxc-hdr-btc" id="cxcHdrBtc">BTC $...</span>';
      wrap.appendChild(row);
      // Fetch BTC price
      function updBtc(){
        fetch('/api/coins').then(function(r){return r.json();}).then(function(d){
          var cs2=d.coins||[];var btc=cs2.find(function(c){return c.id==='bitcoin';});
          var el2=document.getElementById('cxcHdrBtc');
          if(btc&&el2){var ch=btc.price_change_percentage_24h||0;el2.innerHTML='BTC <span class="'+(ch>=0?'up':'dn')+'">$'+btc.current_price.toLocaleString('en-US',{maximumFractionDigits:0})+'</span>';}
        }).catch(function(){});
      }
      updBtc();setInterval(updBtc,30000);
    }
  }
}
// Poll for header
var _hdrIv=setInterval(function(){
  if(document.activeElement&&(document.activeElement.tagName==='INPUT'||document.activeElement.tagName==='TEXTAREA'||document.activeElement.tagName==='SELECT'))return;
  var hdr=document.querySelector('#root header');
  if(hdr){var s=hdr.getAttribute('style')||'';if(s.indexOf('sticky')!==-1&&!hdr.classList.contains('cxc-prem-hdr'))enhanceHeader();}
},500);
// Re-check after React re-renders
var _hdrObs=new MutationObserver(function(){
  if(document.activeElement&&(document.activeElement.tagName==='INPUT'||document.activeElement.tagName==='TEXTAREA'||document.activeElement.tagName==='SELECT'))return;
  var hdr=document.querySelector('#root header');
  if(hdr&&!hdr.classList.contains('cxc-prem-hdr')){enhanceHeader();}
});
_hdrObs.observe(document.body,{childList:true,subtree:false});
})();
</script>

<!-- ‚ïê‚ïê‚ïê PREMIUM SUPPORT CENTER v3 ‚Äî CSS-based hide ‚ïê‚ïê‚ïê -->
<script>
(function(){
'use strict';

// ‚îÄ‚îÄ‚îÄ‚îÄ CSS ‚îÄ‚îÄ‚îÄ‚îÄ
var css=document.createElement('style');css.id='cxcSPv3';
css.textContent='\
body.sp-on #cxcSPWrap{display:block!important}\
body:not(.sp-on) #cxcSPWrap{display:none!important}\
.sp-wrap{font-family:Outfit,sans-serif;animation:spFI .4s ease}\
@keyframes spFI{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}\
.sp-hdr{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;flex-wrap:wrap;gap:12px}\
.sp-hdr h2{font-size:26px;font-weight:800;color:#111827;margin:0 0 4px}\
.sp-hdr p{font-size:14px;color:#6B7280;margin:0}\
.sp-hdr-r{display:flex;align-items:center;gap:8px;flex-wrap:wrap}\
.sp-live{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:20px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.12);font-size:11px;font-weight:600;color:#059669}\
.sp-live i{width:6px;height:6px;border-radius:50%;background:#10B981;box-shadow:0 0 6px rgba(16,185,129,.5);animation:spPl 2s ease infinite;display:block}\
@keyframes spPl{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}\
.sp-btn-new{padding:9px 20px;border-radius:10px;border:none;font-family:Outfit,sans-serif;font-size:13px;font-weight:700;color:#fff;background:linear-gradient(135deg,#4361EE,#5B6CF0);box-shadow:0 2px 10px rgba(67,97,238,.25);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}\
.sp-btn-new:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(67,97,238,.35)}\
.sp-metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}\
@media(max-width:768px){.sp-metrics{grid-template-columns:repeat(2,1fr)}}\
.sp-mc{background:#fff;border-radius:14px;padding:16px 18px;border:1px solid #F0F0F0;transition:all .2s}\
.sp-mc:hover{border-color:#E0E0E8;box-shadow:0 4px 16px rgba(0,0,0,.04)}\
.sp-mc .v{font-size:24px;font-weight:800;margin-bottom:2px}\
.sp-mc .l{font-size:12px;color:#9CA3AF;font-weight:500}\
.sp-grid{display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start}\
@media(max-width:900px){.sp-grid{grid-template-columns:1fr}}\
.sp-card{background:#fff;border-radius:14px;border:1px solid #F0F0F0;overflow:hidden}\
.sp-card-hd{padding:16px 20px;border-bottom:1px solid #F5F5F5;display:flex;justify-content:space-between;align-items:center}\
.sp-card-hd h3{font-size:15px;font-weight:700;margin:0}\
.sp-card-hd span{font-size:12px;color:#9CA3AF}\
.sp-search{padding:12px 16px;border-bottom:1px solid #F5F5F5}\
.sp-search input{width:100%;padding:8px 14px;border-radius:8px;border:1.5px solid #E5E7EB;font-family:Outfit,sans-serif;font-size:13px;background:#FAFAFA;outline:none;transition:border .2s;box-sizing:border-box}\
.sp-search input:focus{border-color:#4361EE;background:#fff}\
.sp-filters{display:flex;gap:4px;padding:10px 16px;flex-wrap:wrap}\
.sp-fbtn{padding:5px 12px;border-radius:16px;border:1px solid #E5E7EB;font-family:Outfit,sans-serif;font-size:11px;font-weight:600;color:#6B7280;cursor:pointer;background:#fff;transition:all .15s}\
.sp-fbtn:hover{border-color:#CBD5E1;background:#F8F9FB}\
.sp-fbtn.act{background:#4361EE;color:#fff;border-color:#4361EE}\
.sp-tk{padding:14px 20px;border-bottom:1px solid #F8F8F8;cursor:pointer;transition:all .15s;display:flex;gap:14px;align-items:flex-start}\
.sp-tk:hover{background:#FAFBFD}\
.sp-tk:last-child{border-bottom:none}\
.sp-tk-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}\
.sp-tk-body{flex:1;min-width:0}\
.sp-tk-top{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:4px}\
.sp-tk-subj{font-size:14px;font-weight:600;color:#111827;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\
.sp-badge{padding:2px 8px;border-radius:5px;font-size:10px;font-weight:700;text-transform:uppercase;white-space:nowrap;letter-spacing:.3px}\
.sp-tk-msg{font-size:12px;color:#9CA3AF;margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\
.sp-tk-meta{display:flex;align-items:center;gap:8px;font-size:11px;color:#9CA3AF}\
.sp-tk-meta .cnt{display:flex;align-items:center;gap:3px}\
.sp-empty{padding:48px 24px;text-align:center}\
.sp-empty svg{margin:0 auto 12px;display:block}\
.sp-empty .t{font-size:15px;font-weight:600;color:#6B7280;margin-bottom:4px}\
.sp-empty .s{font-size:13px;color:#9CA3AF}\
.sp-form-inner{padding:20px}\
.sp-form-inner h3{font-size:16px;font-weight:700;margin-bottom:4px}\
.sp-form-inner .sub{font-size:12px;color:#9CA3AF;margin-bottom:18px}\
.sp-lbl{display:block;font-size:12px;font-weight:600;color:#374151;margin-bottom:5px}\
.sp-inp{width:100%;padding:10px 14px;border-radius:10px;border:1.5px solid #E5E7EB;font-family:Outfit,sans-serif;font-size:14px;background:#FAFAFA;outline:none;box-sizing:border-box;transition:border .2s,box-shadow .2s}\
.sp-inp:focus{border-color:#4361EE;box-shadow:0 0 0 3px rgba(67,97,238,.08);background:#fff}\
.sp-sel{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg width=\'10\' height=\'6\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M0 0l5 6 5-6z\' fill=\'%239CA3AF\'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:32px}\
.sp-ta{resize:vertical;min-height:100px;font-family:Outfit,sans-serif;line-height:1.6}\
.sp-btn-submit{width:100%;padding:12px;border-radius:10px;border:none;font-family:Outfit,sans-serif;font-size:14px;font-weight:700;color:#fff;background:linear-gradient(135deg,#4361EE,#5B6CF0);box-shadow:0 2px 10px rgba(67,97,238,.2);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px}\
.sp-btn-submit:hover{box-shadow:0 4px 18px rgba(67,97,238,.3);transform:translateY(-1px)}\
.sp-btn-submit:disabled{opacity:.5;cursor:not-allowed;transform:none}\
.sp-faq{margin-top:20px;border-top:1px solid #F0F0F0;padding-top:16px}\
.sp-faq h4{font-size:13px;font-weight:700;color:#374151;margin-bottom:10px;display:flex;align-items:center;gap:6px}\
.sp-faq-item{padding:10px 14px;border-radius:10px;background:#FAFBFD;margin-bottom:6px;cursor:pointer;transition:all .15s;border:1px solid #F0F0F0}\
.sp-faq-item:hover{background:#F0F2F8;border-color:#E0E2EA}\
.sp-faq-item .q{font-size:13px;font-weight:600;color:#111827;display:flex;justify-content:space-between;align-items:center}\
.sp-faq-item .a{font-size:12px;color:#6B7280;line-height:1.6;margin-top:6px;display:none}\
.sp-faq-item.open .a{display:block}\
.sp-faq-item.open .q svg{transform:rotate(180deg)}\
.sp-detail{animation:spFI .3s ease}\
.sp-det-hdr{display:flex;align-items:flex-start;gap:14px;margin-bottom:20px}\
.sp-det-back{width:36px;height:36px;border-radius:10px;background:#F5F5F7;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0;border:none}\
.sp-det-back:hover{background:#EEEEF2}\
.sp-timeline{display:flex;align-items:center;gap:0;margin-bottom:20px;padding:16px 20px;background:#FAFBFD;border-radius:12px;border:1px solid #F0F0F0;overflow-x:auto}\
.sp-tl-step{display:flex;align-items:center;gap:8px;white-space:nowrap}\
.sp-tl-dot{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}\
.sp-tl-dot.done{background:linear-gradient(135deg,#10B981,#059669);color:#fff}\
.sp-tl-dot.active{background:linear-gradient(135deg,#4361EE,#5B6CF0);color:#fff;box-shadow:0 0 0 4px rgba(67,97,238,.15)}\
.sp-tl-dot.wait{background:#E5E7EB;color:#9CA3AF}\
.sp-tl-label{font-size:11px;font-weight:600}\
.sp-tl-line{width:32px;height:2px;margin:0 4px;flex-shrink:0}\
.sp-tl-line.done{background:#10B981}\
.sp-tl-line.wait{background:#E5E7EB}\
.sp-chat{background:#fff;border-radius:14px;border:1px solid #F0F0F0;overflow:hidden}\
.sp-chat-msgs{max-height:420px;overflow-y:auto;padding:20px;-webkit-overflow-scrolling:touch}\
.sp-msg{display:flex;flex-direction:column;margin-bottom:16px}\
.sp-msg.usr{align-items:flex-end}\
.sp-msg.adm{align-items:flex-start}\
.sp-msg-bub{max-width:80%;padding:12px 16px;font-size:14px;line-height:1.6;word-wrap:break-word}\
.sp-msg.usr .sp-msg-bub{background:linear-gradient(135deg,#4361EE,#5B6CF0);color:#fff;border-radius:16px 4px 16px 16px}\
.sp-msg.adm .sp-msg-bub{background:#F3F4F6;color:#111827;border-radius:4px 16px 16px 16px}\
.sp-msg-info{display:flex;align-items:center;gap:6px;margin-top:4px;font-size:11px;color:#9CA3AF}\
.sp-msg-info .who{font-weight:600}\
.sp-reply-bar{padding:14px 20px;border-top:1px solid #F0F0F0;display:flex;gap:10px;align-items:center;background:#FAFBFD}\
.sp-reply-bar input{flex:1;padding:10px 14px;border-radius:10px;border:1.5px solid #E5E7EB;font-family:Outfit,sans-serif;font-size:14px;background:#fff;outline:none;transition:border .2s;box-sizing:border-box}\
.sp-reply-bar input:focus{border-color:#4361EE}\
.sp-reply-bar button{width:40px;height:40px;border-radius:10px;border:none;background:linear-gradient(135deg,#4361EE,#5B6CF0);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}\
.sp-reply-bar button:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(67,97,238,.3)}\
.sp-quick{display:flex;gap:6px;padding:10px 20px;border-top:1px solid #F5F5F5;flex-wrap:wrap}\
.sp-quick span{padding:5px 12px;border-radius:16px;font-size:11px;font-weight:600;color:#6B7280;background:#F3F4F6;cursor:pointer;transition:all .15s;border:1px solid #E5E7EB}\
.sp-quick span:hover{background:#E8EAEF;color:#374151}\
.sp-closed-bar{padding:14px 20px;border-top:1px solid #F0F0F0;text-align:center;font-size:13px;color:#9CA3AF;background:#FAFBFD}\
';
document.head.appendChild(css);

// ‚îÄ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ
var _tk=[],_view=null,_filter='all',_search='',_pollIv=null,_wrap=null,_faqOpen={},_lastPg='';

function sAPI(p,o){var t=localStorage.getItem('cxc_token');var h={'Content-Type':'application/json'};if(t)h['Authorization']='Bearer '+t;return fetch('/api'+p,Object.assign({},o,{headers:h})).then(function(r){return r.json().then(function(d){if(!r.ok)throw new Error(d.error||'Failed');return d;});});}
function tAgo(d){if(!d)return'';var x=Date.now()-new Date(d).getTime();return x<6e4?'Just now':x<36e5?Math.floor(x/6e4)+'m ago':x<864e5?Math.floor(x/36e5)+'h ago':new Date(d).toLocaleDateString('en-GB',{day:'numeric',month:'short'});}
function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function loadTk(){sAPI('/support/tickets').then(function(d){_tk=d.tickets||[];render();}).catch(function(){});}
function cntS(s){return _tk.filter(function(t){return t.status===s;}).length;}

// ‚îÄ‚îÄ‚îÄ‚îÄ Detect current page ‚îÄ‚îÄ‚îÄ‚îÄ
function getCurrentPage(){
  var path=window.location.pathname.replace('/','');
  if(path)return path;
  // Fallback: check which nav item is active by looking at sidebar
  return '';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Render list ‚îÄ‚îÄ‚îÄ‚îÄ
function render(){
  if(!_wrap)return;if(_view){renderDetail();return;}
  var open=cntS('open'),pend=cntS('pending')+cntS('in-progress'),res=cntS('resolved')+cntS('closed');
  var filtered=_tk.filter(function(t){if(_filter!=='all'&&t.status!==_filter)return false;if(_search){var q=_search.toLowerCase();return t.subject.toLowerCase().indexOf(q)!==-1||t.category.toLowerCase().indexOf(q)!==-1;}return true;});
  var catIco={general:'\u{1F4AC}',deposit:'\u{1F4B0}',withdrawal:'\u{1F4B8}',trading:'\u{1F4C8}',account:'\u{1F510}',technical:'\u{2699}\uFE0F'};
  var catBg={general:'#EBF0FF',deposit:'#FFFBE5',withdrawal:'#FEF2F2',trading:'#ECFDF5',account:'#F3EAFF',technical:'#EFF6FF'};
  var stCol={open:'#F59E0B',pending:'#4361EE','in-progress':'#8B5CF6',resolved:'#10B981',closed:'#9CA3AF'};
  var stBg={open:'#FEF3C7',pending:'#EBF0FF','in-progress':'#F3EAFF',resolved:'#D1FAE5',closed:'#F3F4F6'};
  var h='<div class="sp-wrap"><div class="sp-hdr"><div><h2>Support Center</h2><p>Get help from our team \u2014 we typically respond within 24 hours</p></div><div class="sp-hdr-r"><span class="sp-live"><i></i>Auto-refresh</span><button class="sp-btn-new" id="spNewFocus">+ New Ticket</button></div></div>';
  h+='<div class="sp-metrics"><div class="sp-mc"><div class="v" style="color:#F59E0B">'+open+'</div><div class="l">Open</div></div><div class="sp-mc"><div class="v" style="color:#4361EE">'+pend+'</div><div class="l">In Progress</div></div><div class="sp-mc"><div class="v" style="color:#10B981">'+res+'</div><div class="l">Resolved</div></div><div class="sp-mc"><div class="v" style="color:#374151">'+_tk.length+'</div><div class="l">Total</div></div></div>';
  h+='<div class="sp-grid"><div><div class="sp-card"><div class="sp-card-hd"><h3>Your Tickets</h3><span>'+filtered.length+' shown</span></div>';
  h+='<div class="sp-search"><input type="text" placeholder="Search tickets..." id="spSearch" value="'+esc(_search)+'"/></div><div class="sp-filters">';
  ['all','open','pending','in-progress','resolved','closed'].forEach(function(f){h+='<button class="sp-fbtn'+(f===_filter?' act':'')+'" data-f="'+f+'">'+(f==='all'?'All':f.charAt(0).toUpperCase()+f.slice(1))+'</button>';});
  h+='</div>';
  if(!filtered.length){h+='<div class="sp-empty"><svg width="48" height="48" fill="none" stroke="#D1D5DB" stroke-width="1.5" stroke-linecap="round" viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z"/></svg><div class="t">No tickets found</div><div class="s">'+(_filter!=='all'?'Try a different filter':'Submit a ticket to get help')+'</div></div>';}
  else{filtered.forEach(function(tk){var msgs=(tk.messages||[]).length;var last=tk.messages&&tk.messages.length>1?tk.messages[tk.messages.length-1]:null;var nr=last&&last.from==='admin';h+='<div class="sp-tk" data-tid="'+tk.id+'"><div class="sp-tk-ico" style="background:'+(catBg[tk.category]||'#F3F4F6')+'">'+(catIco[tk.category]||'\u{1F4AC}')+'</div><div class="sp-tk-body"><div class="sp-tk-top"><span class="sp-tk-subj">'+esc(tk.subject)+'</span><span class="sp-badge" style="background:'+(stBg[tk.status]||'#F3F4F6')+';color:'+(stCol[tk.status]||'#9CA3AF')+'">'+tk.status+'</span></div><div class="sp-tk-msg">'+esc(tk.message)+'</div><div class="sp-tk-meta"><span class="cnt"><svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z"/></svg>'+msgs+'</span><span>#'+tk.id+'</span><span>'+tAgo(tk.date)+'</span>'+(nr?'<span style="color:#10B981;font-weight:600">\u2022 Reply</span>':'')+'</div></div></div>';});}
  h+='</div></div>';
  h+='<div><div class="sp-card"><div class="sp-form-inner" id="spFormArea"><h3>Submit a Ticket</h3><div class="sub">Describe your issue and we\'ll get back to you</div>';
  h+='<div style="margin-bottom:14px"><label class="sp-lbl">Category</label><select class="sp-inp sp-sel" id="spCat"><option value="general">\u{1F4AC} General Inquiry</option><option value="deposit">\u{1F4B0} Deposit Issue</option><option value="withdrawal">\u{1F4B8} Withdrawal Issue</option><option value="trading">\u{1F4C8} Trading Problem</option><option value="account">\u{1F510} Account & Security</option><option value="technical">\u{2699}\uFE0F Technical Issue</option></select></div>';
  h+='<div style="margin-bottom:14px"><label class="sp-lbl">Subject</label><input class="sp-inp" placeholder="Brief description of your issue" id="spSubj" maxlength="200"/></div>';
  h+='<div style="margin-bottom:14px"><label class="sp-lbl">Message</label><textarea class="sp-inp sp-ta" placeholder="Describe your issue in detail..." id="spMsg" maxlength="2000"></textarea><div style="text-align:right;font-size:11px;color:#9CA3AF;margin-top:4px"><span id="spMsgCt">0</span>/2000</div></div>';
  h+='<button class="sp-btn-submit" id="spSubmit"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Submit Ticket</button>';
  h+='<div class="sp-faq"><h4><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg> Quick Help</h4>';
  [{q:'How do I deposit XAF?',a:'Navigate to Deposit page, select MTN MoMo or Orange Money, enter amount and phone number.'},{q:'Why is my withdrawal pending?',a:'Withdrawals are processed within 30 minutes. If delayed, contact support.'},{q:'How to enable 2FA?',a:'Go to Settings \u2192 Connect Telegram \u2192 Our bot sends security codes.'},{q:'How do I buy crypto?',a:'Go to Exchange, select a coin, enter amount, and confirm.'},{q:'Is my account safe?',a:'Yes \u2014 AES-256 encryption, bcrypt hashing, rate limiting, and Telegram alerts.'}].forEach(function(faq,i){h+='<div class="sp-faq-item'+(_faqOpen[i]?' open':'')+'" data-faq="'+i+'"><div class="q">'+faq.q+'<svg width="12" height="12" fill="none" stroke="#9CA3AF" stroke-width="2" viewBox="0 0 24 24" style="transition:transform .2s;flex-shrink:0"><path d="M6 9l6 6 6-6"/></svg></div><div class="a">'+faq.a+'</div></div>';});
  h+='</div></div></div></div></div></div>';
  _wrap.innerHTML=h;bindList();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Render detail ‚îÄ‚îÄ‚îÄ‚îÄ
function renderDetail(){
  if(!_wrap||!_view)return;var tk=_tk.find(function(t){return t.id===_view;});if(!tk){_view=null;render();return;}
  var stCol={open:'#F59E0B',pending:'#4361EE','in-progress':'#8B5CF6',resolved:'#10B981',closed:'#9CA3AF'};
  var stBg={open:'#FEF3C7',pending:'#EBF0FF','in-progress':'#F3EAFF',resolved:'#D1FAE5',closed:'#F3F4F6'};
  var steps=['open','pending','in-progress','resolved'];var curIdx=steps.indexOf(tk.status);if(tk.status==='closed')curIdx=3;
  var h='<div class="sp-detail"><div class="sp-det-hdr"><button class="sp-det-back" id="spBack"><svg width="18" height="18" fill="none" stroke="#374151" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>';
  h+='<div style="flex:1"><h2 style="font-size:20px;font-weight:800;margin:0 0 6px">'+esc(tk.subject)+'</h2><div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap"><span class="sp-badge" style="background:'+(stBg[tk.status]||'#F3F4F6')+';color:'+(stCol[tk.status]||'#9CA3AF')+'">'+tk.status+'</span><span class="sp-badge" style="background:#F0F0F0;color:#6B7280">'+tk.category+'</span><span style="font-size:12px;color:#9CA3AF">#'+tk.id+' \u00b7 '+tAgo(tk.date)+'</span></div></div></div>';
  h+='<div class="sp-timeline">';steps.forEach(function(s,i){var isDone=i<curIdx,isAct=i===curIdx;if(i>0)h+='<div class="sp-tl-line '+(isDone||isAct?'done':'wait')+'"></div>';h+='<div class="sp-tl-step"><div class="sp-tl-dot '+(isDone?'done':isAct?'active':'wait')+'">'+(isDone?'\u2713':(i+1))+'</div><span class="sp-tl-label" style="color:'+(isDone||isAct?'#374151':'#9CA3AF')+'">'+s.charAt(0).toUpperCase()+s.slice(1).replace('-',' ')+'</span></div>';});h+='</div>';
  h+='<div class="sp-chat"><div class="sp-chat-msgs" id="spMsgs">';
  (tk.messages||[]).forEach(function(msg){var isA=msg.from==='admin';h+='<div class="sp-msg '+(isA?'adm':'usr')+'"><div class="sp-msg-bub">'+esc(msg.text)+'</div><div class="sp-msg-info"><span class="who">'+(isA?'Support Team':'You')+'</span><span>\u00b7</span><span>'+tAgo(msg.date)+'</span></div></div>';});
  h+='</div>';
  if(tk.status!=='closed'&&tk.status!=='resolved'){
    h+='<div class="sp-quick">';['Thanks!','Got it','Need more help','When will this be resolved?','Can you check again?'].forEach(function(q){h+='<span data-qr="'+esc(q)+'">'+q+'</span>';});h+='</div>';
    h+='<div class="sp-reply-bar"><input placeholder="Type your reply..." id="spReplyIn" maxlength="1000"/><button id="spSendBtn"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button></div>';
  }else{h+='<div class="sp-closed-bar">This ticket has been '+tk.status+'. <span style="color:#4361EE;cursor:pointer;font-weight:600" id="spNewFromClosed">Open a new ticket</span></div>';}
  h+='</div></div>';_wrap.innerHTML=h;
  var ms=document.getElementById('spMsgs');if(ms)ms.scrollTop=ms.scrollHeight;bindDetail(tk);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Bind events: list ‚îÄ‚îÄ‚îÄ‚îÄ
function bindList(){
  var si=document.getElementById('spSearch');if(si)si.oninput=function(){_search=si.value;render();};
  _wrap.querySelectorAll('.sp-fbtn').forEach(function(b){b.onclick=function(){_filter=b.getAttribute('data-f');render();};});
  _wrap.querySelectorAll('.sp-tk').forEach(function(el){el.onclick=function(){_view=parseInt(el.getAttribute('data-tid'));render();};});
  var nb=document.getElementById('spNewFocus');if(nb)nb.onclick=function(){var fa=document.getElementById('spFormArea');if(fa)fa.scrollIntoView({behavior:'smooth'});var s=document.getElementById('spSubj');if(s)setTimeout(function(){s.focus();},400);};
  var msg=document.getElementById('spMsg'),ct=document.getElementById('spMsgCt');if(msg&&ct)msg.oninput=function(){ct.textContent=msg.value.length;};
  var sub=document.getElementById('spSubmit');if(sub)sub.onclick=function(){var sj=document.getElementById('spSubj'),mg=document.getElementById('spMsg'),ca=document.getElementById('spCat');if(!sj||!mg)return;if(sj.value.trim().length<3){alert('Subject: min 3 characters');return;}if(mg.value.trim().length<10){alert('Message: min 10 characters');return;}sub.disabled=true;sub.textContent='Submitting...';sAPI('/support/create',{method:'POST',body:JSON.stringify({subject:sj.value.trim(),message:mg.value.trim(),category:ca?ca.value:'general'})}).then(function(d){_tk.unshift(d.ticket);sj.value='';mg.value='';render();}).catch(function(e){alert(e.message||'Failed');sub.disabled=false;sub.textContent='Submit Ticket';});};
  _wrap.querySelectorAll('.sp-faq-item').forEach(function(el){el.onclick=function(){var i=el.getAttribute('data-faq');_faqOpen[i]=!_faqOpen[i];el.classList.toggle('open');};});
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Bind events: detail ‚îÄ‚îÄ‚îÄ‚îÄ
function bindDetail(tk){
  var bb=document.getElementById('spBack');if(bb)bb.onclick=function(){_view=null;render();};
  _wrap.querySelectorAll('[data-qr]').forEach(function(el){el.onclick=function(){var inp=document.getElementById('spReplyIn');if(inp){inp.value=el.getAttribute('data-qr');inp.focus();}};});
  var sb=document.getElementById('spSendBtn'),inp=document.getElementById('spReplyIn');
  function doSend(){if(!inp||!inp.value.trim())return;var m=inp.value.trim();sb.style.opacity='.5';inp.disabled=true;sAPI('/support/reply',{method:'POST',body:JSON.stringify({ticketId:tk.id,message:m})}).then(function(d){var t=_tk.find(function(x){return x.id===tk.id;});if(t){t.messages=(t.messages||[]).concat(d.message);t.status=d.status||t.status;}inp.value='';renderDetail();}).catch(function(e){alert(e.message||'Failed');sb.style.opacity='1';inp.disabled=false;});}
  if(sb)sb.onclick=doSend;if(inp)inp.onkeydown=function(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();doSend();}};
  var nfc=document.getElementById('spNewFromClosed');if(nfc)nfc.onclick=function(){_view=null;render();setTimeout(function(){var fa=document.getElementById('spFormArea');if(fa)fa.scrollIntoView({behavior:'smooth'});},100);};
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Bootstrap: create wrapper once, in <main> ‚îÄ‚îÄ‚îÄ‚îÄ
function bootstrap(){
  var main=document.querySelector('#root main');
  if(!main)return;
  if(document.getElementById('cxcSPWrap'))return;
  _wrap=document.createElement('div');
  _wrap.id='cxcSPWrap';
  _wrap.style.display='none';
  main.appendChild(_wrap);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Page watcher: toggle visibility via body class ‚îÄ‚îÄ‚îÄ‚îÄ
var _spOn=false;
function checkPage(){
  if(document.activeElement&&(document.activeElement.tagName==='INPUT'||document.activeElement.tagName==='TEXTAREA'))return;
  if(!localStorage.getItem('cxc_token'))return;
  var path=window.location.pathname.replace('/','');
  var onSupport=(path==='support');
  if(onSupport&&!_spOn){
    _spOn=true;
    document.body.classList.add('sp-on');
    if(!_wrap)bootstrap();
    loadTk();
    if(!_pollIv)_pollIv=setInterval(loadTk,15000);
  }else if(!onSupport&&_spOn){
    _spOn=false;
    document.body.classList.remove('sp-on');
    if(_pollIv){clearInterval(_pollIv);_pollIv=null;}
    _view=null;_filter='all';_search='';
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ Hide React SupportPage content when premium is active ‚îÄ‚îÄ‚îÄ‚îÄ
// This uses a MutationObserver to add display:none on React's rendered support elements
var _hideStyle=document.createElement('style');
_hideStyle.id='cxcSPHide';
_hideStyle.textContent='body.sp-on #root main>div:not(#cxcSPWrap):not([style*="position:fixed"]):not([style*="position: fixed"]){display:none!important}';
document.head.appendChild(_hideStyle);

// ‚îÄ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ
bootstrap();
setInterval(checkPage,300);
// Also watch for pushState navigation
var _origPush=history.pushState;
history.pushState=function(){_origPush.apply(this,arguments);setTimeout(checkPage,50);};
var _origReplace=history.replaceState;
history.replaceState=function(){_origReplace.apply(this,arguments);setTimeout(checkPage,50);};
window.addEventListener('popstate',function(){setTimeout(checkPage,50);});
})();
</script>

<!-- ‚ïê‚ïê‚ïê FINTECH AUTH SYSTEM v5 ‚Äî Full-page SaaS ‚ïê‚ïê‚ïê -->
<script>
(function(){
'use strict';
var _f=window.fetch;
var S=document.createElement('style');
S.textContent='#cxcMO{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);z-index:99999;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s}#cxcMO.on{opacity:1;pointer-events:all}#cxcMO .card{background:#fff;border-radius:20px;padding:36px 32px 28px;text-align:center;box-shadow:0 24px 80px rgba(0,0,0,.2);transform:scale(.88) translateY(16px);transition:transform .4s cubic-bezier(.175,.885,.32,1.275);max-width:300px;width:88%}#cxcMO.on .card{transform:scale(1) translateY(0)}#cxcMO .sp{width:52px;height:52px;margin:0 auto 16px}#cxcMO .sp svg{width:52px;height:52px;animation:_ms 1s linear infinite}@keyframes _ms{to{transform:rotate(360deg)}}#cxcMO .ok{width:52px;height:52px;margin:0 auto 16px;border-radius:50%;background:linear-gradient(135deg,#10B981,#059669);align-items:center;justify-content:center;transform:scale(0);transition:transform .4s cubic-bezier(.175,.885,.32,1.275);box-shadow:0 6px 20px rgba(16,185,129,.3);display:none}#cxcMO .ok.on{display:flex;transform:scale(1)}#cxcMO .tt{font-family:Outfit,sans-serif;font-size:17px;font-weight:700;color:#111827;margin-bottom:4px}#cxcMO .sb{font-family:Outfit,sans-serif;font-size:13px;color:#6B7280}#cxcMO .dots{display:flex;justify-content:center;gap:5px;margin-top:12px}#cxcMO .dots i{width:5px;height:5px;border-radius:50%;background:#D1D5DB;animation:_md 1.4s ease-in-out infinite;display:block}#cxcMO .dots i:nth-child(2){animation-delay:.2s}#cxcMO .dots i:nth-child(3){animation-delay:.4s}@keyframes _md{0%,80%,100%{background:#D1D5DB;transform:scale(1)}40%{background:#4361EE;transform:scale(1.3)}}#cxcAP{position:fixed;inset:0;z-index:85;font-family:Outfit,sans-serif;display:flex;background:#fff;overflow-y:auto;-webkit-overflow-scrolling:touch}#cxcAP *{box-sizing:border-box}#cxcAP a{text-decoration:none}#cxcAP button{cursor:pointer;font-family:inherit;border:none;outline:none}.ap-left{width:45%;min-height:100vh;background:linear-gradient(145deg,#4361EE,#5B6CF0,#6366F1);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:60px 40px;position:relative;overflow:hidden}.ap-left::before{content:"";position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width=\'40\' height=\'40\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ccircle cx=\'1\' cy=\'1\' r=\'.8\' fill=\'rgba(255,255,255,.06)\'/%3E%3C/svg%3E");pointer-events:none}.ap-left-logo{position:absolute;top:32px;left:32px;display:flex;align-items:center;gap:10px;color:#fff;cursor:pointer;z-index:2}.ap-left-logo i{width:34px;height:34px;border-radius:9px;background:rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;font-style:normal;font-size:15px;font-weight:900}.ap-left-logo span{font-size:18px;font-weight:800}.ap-left-c{text-align:center;color:#fff;position:relative;z-index:1;max-width:360px}.ap-left-c .xi{width:80px;height:80px;border-radius:20px;margin:0 auto 24px;background:rgba(255,255,255,.12);border:2px solid rgba(255,255,255,.18);display:flex;align-items:center;justify-content:center;font-size:36px}.ap-left-c h1{font-size:30px;font-weight:800;line-height:1.2;margin-bottom:14px}.ap-left-c p{font-size:15px;opacity:.8;line-height:1.7;margin-bottom:20px}.ap-chips{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}.ap-chips span{padding:7px 16px;border-radius:8px;font-size:12px;font-weight:600;color:#fff}.ap-rate{margin-top:20px;font-size:13px;opacity:.6}.ap-rate strong{opacity:1}.ap-right{flex:1;display:flex;align-items:center;justify-content:center;padding:40px 24px;min-height:100vh;background:#fff;overflow-y:auto}.ap-form{width:100%;max-width:400px}.ap-mob{display:none;align-items:center;gap:8px;margin-bottom:24px;cursor:pointer}.ap-mob i{width:32px;height:32px;border-radius:8px;background:#4361EE;display:flex;align-items:center;justify-content:center;font-style:normal;font-size:13px;font-weight:900;color:#fff}.ap-mob span{font-size:17px;font-weight:800;color:#111}.ap-form .ico{width:60px;height:60px;border-radius:15px;display:flex;align-items:center;justify-content:center;margin:0 auto 14px}.ap-form .ico.bl{background:linear-gradient(135deg,#4361EE,#6366F1);box-shadow:0 8px 24px rgba(67,97,238,.25)}.ap-form .ico.pu{background:linear-gradient(135deg,#7C3AED,#9333EA);box-shadow:0 8px 24px rgba(124,58,237,.25)}.ap-form .ico.am{background:linear-gradient(135deg,#F59E0B,#D97706);box-shadow:0 8px 24px rgba(245,158,11,.25)}.ap-form .ico.gn{background:linear-gradient(135deg,#10B981,#059669);box-shadow:0 8px 24px rgba(16,185,129,.25)}.ap-form h2{font-size:26px;font-weight:800;text-align:center;margin-bottom:4px;color:#111}.ap-form .sub{text-align:center;color:#6B7280;font-size:14px;margin-bottom:24px;line-height:1.5}.ap-form .sub a{color:#4361EE;font-weight:700;font-size:15px;text-decoration:none}.ap-form .lbl{font-size:13px;font-weight:600;color:#374151;margin-bottom:5px;display:block}.ap-form .inp{width:100%;padding:12px 14px;border-radius:10px;border:1.5px solid #E5E7EB;font-family:Outfit,sans-serif;font-size:15px;background:#FAFAFA;outline:none;transition:border .2s,box-shadow .2s;-webkit-appearance:none;box-sizing:border-box}.ap-form .inp:focus{border-color:#4361EE;box-shadow:0 0 0 3px rgba(67,97,238,.08);background:#fff}.ap-form .row{display:flex;align-items:center;justify-content:space-between;margin:6px 0 16px}.ap-form .row label{display:flex;align-items:center;gap:6px;font-size:13px;color:#6B7280;cursor:pointer;user-select:none}.ap-form .row label input{width:16px;height:16px;accent-color:#4361EE}.ap-form .row a{font-size:13px;color:#4361EE;font-weight:600;cursor:pointer}.ap-form .row a:hover{text-decoration:underline}.ap-form .btn{width:100%;padding:13px;border:none;border-radius:10px;font-family:Outfit,sans-serif;font-size:15px;font-weight:700;color:#fff;cursor:pointer;background:#4361EE;transition:all .15s;box-sizing:border-box}.ap-form .btn:hover{background:#5B6CF0}.ap-form .btn:active{transform:scale(.985)}.ap-form .btn:disabled{opacity:.5;cursor:not-allowed}.ap-form .btn.pu{background:#7C3AED}.ap-form .btn.pu:hover{background:#9333EA}.ap-form .btn.gn{background:#10B981}.ap-form .btn.gn:hover{background:#059669}.ap-form .err{color:#EF4444;font-size:13px;padding:10px 14px;border-radius:8px;background:#FEF2F2;margin-bottom:12px}.ap-form .bot{text-align:center;margin-top:16px;font-size:14px;color:#6B7280}.ap-form .bot a{color:#4361EE;font-weight:600;cursor:pointer;text-decoration:none}.ap-form .bot a:hover{text-decoration:underline}.ap-form .badge{display:flex;align-items:center;justify-content:center;gap:5px;margin-top:20px;padding:7px;border-radius:8px;background:#F8F9FB;font-size:11px;color:#9CA3AF}.ap-form .or{display:flex;align-items:center;gap:12px;margin:18px 0;color:#D1D5DB;font-size:12px;font-weight:500}.ap-form .or::before,.ap-form .or::after{content:"";flex:1;height:1px;background:#E5E7EB}.ap-form .otp{display:flex;gap:8px;justify-content:center;margin:14px 0}.ap-form .otp input{width:44px;height:52px;text-align:center;font-size:22px;font-weight:700;font-family:Outfit,sans-serif;border:1.5px solid #E5E7EB;border-radius:10px;background:#FAFAFA;outline:none;-webkit-appearance:none;box-sizing:border-box}.ap-form .otp input:focus{border-color:#4361EE;box-shadow:0 0 0 3px rgba(67,97,238,.08)}.ap-form .timer{font-size:12px;color:#9CA3AF;text-align:center;margin-top:8px}.ap-form .timer b{color:#4361EE}.ap-form .timer span{color:#4361EE;font-weight:600;cursor:pointer}.ap-form .pm{height:4px;border-radius:4px;background:#E5E7EB;margin-top:5px;overflow:hidden}.ap-form .pm div{height:100%;border-radius:4px;transition:width .35s,background .3s;width:0}.ap-form .ph{font-size:11px;color:#9CA3AF;margin-top:3px;transition:color .3s}.ap-form .back{text-align:center;margin-top:14px;font-size:13px;color:#6B7280}.ap-form .back a{color:#4361EE;font-weight:600;cursor:pointer;text-decoration:none}@keyframes apFU{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.ap-form{animation:apFU .35s ease}@media(max-width:768px){.ap-left{display:none!important}.ap-right{padding:30px 20px}}';
document.head.appendChild(S);

/* Modal */
var MO=document.createElement('div');MO.id='cxcMO';
MO.innerHTML='<div class="card"><div class="sp" id="_sp"><svg viewBox="0 0 52 52" fill="none"><circle cx="26" cy="26" r="22" stroke="#E5E7EB" stroke-width="4"/><path d="M48 26c0-12.15-9.85-22-22-22" stroke="#4361EE" stroke-width="4" stroke-linecap="round"/></svg></div><div class="ok" id="_ok"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div><div class="tt" id="_mt">Verifying</div><div class="sb" id="_ms">Please wait...</div><div class="dots" id="_md"><i></i><i></i><i></i></div></div>';
document.body.appendChild(MO);
function mShow(t,s){document.getElementById('_sp').style.display='block';document.getElementById('_ok').className='ok';document.getElementById('_mt').textContent=t;document.getElementById('_mt').style.color='#111827';document.getElementById('_ms').textContent=s;document.getElementById('_md').style.display='flex';MO.classList.add('on');}
function mOk(t,s){return new Promise(function(r){document.getElementById('_sp').style.display='none';document.getElementById('_ok').className='ok on';document.getElementById('_mt').textContent=t;document.getElementById('_mt').style.color='#059669';document.getElementById('_ms').textContent=s;document.getElementById('_md').style.display='none';setTimeout(function(){MO.classList.remove('on');r();},1300);});}
function mHide(){MO.classList.remove('on');}

/* Fetch interceptor */
window.fetch=function(url,opts){
  if(typeof url==='string'&&opts&&opts.method==='POST'){
    if(url.indexOf('/api/auth/login')!==-1){mShow('Verifying Details','Processing your login...');return _f(url,opts).then(function(r){var c=r.clone();return c.json().then(function(d){if(r.ok&&d.token)return mOk('Login Successful!','Redirecting to dashboard...').then(function(){return r;});mHide();return r;}).catch(function(){mHide();return r;});}).catch(function(e){mHide();throw e;});}
    if(url.indexOf('/api/auth/register')!==-1){mShow('Creating Account','Setting up your account...');return _f(url,opts).then(function(r){var c=r.clone();return c.json().then(function(d){if(r.ok&&d.token)return mOk('Account Created!','Welcome to CryptoxCore!').then(function(){return r;});mHide();return r;}).catch(function(){mHide();return r;});}).catch(function(e){mHide();throw e;});}
  }
  return _f.apply(this,arguments);
};

/* SVGs */
var IC={lock:'<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>',user:'<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>',q:'<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',mail:'<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 7l-8.97 5.7a1.94 1.94 0 01-2.06 0L2 7"/></svg>',chk:'<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',sh:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',bk:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#4361EE" stroke-width="2.5" style="vertical-align:-2px;margin-right:3px"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>'};

/* State */
var fp={step:'email',email:'',masked:'',code:'',token:''};
var cdI=null;
var _chain=window.fetch;

/* Left Panel */
function LP(){return '<div class="ap-left"><div class="ap-left-logo" id="apH"><i>$</i><span>CryptoxCore</span></div><div class="ap-left-c"><div class="xi">\u20BF</div><h1>Buy & Sell Crypto<br>with Mobile Money</h1><p>Deposit XAF via MTN MoMo or Orange Money and trade 14+ cryptocurrencies securely.</p><div class="ap-chips"><span style="background:rgba(255,203,5,.18);border:1px solid rgba(255,203,5,.3)">üì± MTN MoMo</span><span style="background:rgba(255,102,0,.18);border:1px solid rgba(255,102,0,.3)">üì≤ Orange Money</span></div><div class="ap-rate">$1 = <strong>530 XAF</strong></div></div></div>';}

/* Helpers */
function Q(s){return document.querySelector(s);}
function showE(m){var e=Q('#_e');if(e){e.className='err';e.textContent=m;}}
function findRI(type,idx){var divs=document.querySelectorAll('div[style]');for(var i=0;i<divs.length;i++){var st=divs[i].getAttribute('style')||'';if(st.indexOf('max-width')!==-1&&st.indexOf('420')!==-1){var ins=divs[i].querySelectorAll('input[type="'+type+'"]');return ins[idx||0]||null;}}return null;}
function setRI(type,val,idx){var inp=findRI(type,idx);if(!inp)return;var ns=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,'value').set;ns.call(inp,val);inp.dispatchEvent(new Event('input',{bubbles:true}));inp.dispatchEvent(new Event('change',{bubbles:true}));}
function clickRB(text){var bs=document.querySelectorAll('button');for(var i=0;i<bs.length;i++){if(bs[i].closest('#cxcAP'))continue;if(bs[i].textContent.indexOf(text)!==-1){bs[i].click();return;}}}
function clickRL(text){var ss=document.querySelectorAll('span[style*="cursor"]');for(var i=0;i<ss.length;i++){if(ss[i].closest('#cxcAP'))continue;if(ss[i].textContent.trim()===text){ss[i].click();return;}}}
function removePg(){var el=document.getElementById('cxcAP');if(el)el.remove();if(cdI)clearInterval(cdI);}
function goLogin(){removePg();window.history.pushState(null,'','/login');setTimeout(function(){buildPg('login');},100);}

/* Build page */
function buildPg(page){
  removePg();
  var el=document.createElement('div');el.id='cxcAP';
  var fh='';
  if(page==='login')fh='<div class="ico bl">'+IC.lock+'</div><h2>Welcome Back</h2><p class="sub">Sign in to your account to continue<br><a href="/">CryptoxCore</a></p><div id="_e"></div><div style="margin-bottom:14px"><label class="lbl">Email Address</label><input class="inp" type="email" id="_em" placeholder="Enter your email"/></div><div style="margin-bottom:2px"><label class="lbl">Password</label><input class="inp" type="password" id="_pw" placeholder="Enter your password"/></div><div class="row"><label><input type="checkbox"/> Remember me</label><a id="_fg">Forgot password?</a></div><button class="btn" id="_si">Sign In</button><div class="or">or</div><p class="bot">Don\'t have an account? <a id="_gs">Create one now</a></p><div class="badge">'+IC.sh+' Protected by 256-bit SSL encryption</div>';
  else if(page==='signup')fh='<div class="ico pu">'+IC.user+'</div><h2>Create Account</h2><p class="sub">Sign up to get started with crypto exchange<br><a href="/" style="color:#7C3AED">CryptoxCore</a></p><div id="_e"></div><div style="margin-bottom:14px"><label class="lbl">Full Name</label><input class="inp" id="_fn" placeholder="Enter your full name"/></div><div style="margin-bottom:14px"><label class="lbl">Phone Number</label><div style="display:flex;gap:8px"><div style="padding:12px 14px;border-radius:10px;background:#F5F5F5;border:1.5px solid #E5E7EB;font-size:14px;font-weight:600;color:#6B7280;white-space:nowrap">+237</div><input class="inp" id="_ph" placeholder="6XXXXXXXX" maxlength="9" inputmode="numeric"/></div></div><div style="margin-bottom:14px"><label class="lbl">Email Address</label><input class="inp" type="email" id="_sem" placeholder="Enter your email"/></div><div style="margin-bottom:14px"><label class="lbl">Password</label><input class="inp" type="password" id="_spw" placeholder="Create a password"/><div class="pm"><div id="_pb"></div></div><div class="ph" id="_pp">Must be at least 8 characters</div></div><div style="margin-bottom:16px"><label class="lbl">Confirm Password</label><input class="inp" type="password" id="_cpw" placeholder="Confirm your password"/></div><div style="display:flex;align-items:flex-start;gap:8px;margin-bottom:16px;font-size:12px;color:#6B7280"><input type="checkbox" checked style="margin-top:2px;accent-color:#7C3AED;width:16px;height:16px"/><span>I agree to the <a href="#" style="color:#7C3AED;font-weight:600">Terms</a> and <a href="#" style="color:#7C3AED;font-weight:600">Privacy Policy</a></span></div><button class="btn pu" id="_su">Create Account</button><div class="or">or</div><p class="bot">Already have an account? <a id="_gl">Sign in here</a></p><div class="badge">'+IC.sh+' Protected by 256-bit SSL encryption</div>';
  else if(page==='forgot')fh='<div class="ico am">'+IC.q+'</div><h2>Forgot Password?</h2><p class="sub">No worries! Enter your email and we\'ll send<br>a reset code via Telegram.</p><div id="_e"></div><div style="margin-bottom:16px"><label class="lbl">Email Address</label><input class="inp" type="email" id="_fpe" placeholder="Enter your registered email" value="'+(fp.email||'')+'"/></div><button class="btn" id="_fps">Send Reset Code</button><p class="back" style="margin-top:16px">'+IC.bk+'<a id="_fpb">Back to Sign In</a></p>';
  else if(page==='code')fh='<div class="ico am">'+IC.mail+'</div><h2>Enter Reset Code</h2><p class="sub">We sent a 6-digit code to<br><strong style="color:#111">'+fp.masked+'</strong></p><div id="_e"></div><div class="otp" id="_otp"><input maxlength="1" inputmode="numeric"/><input maxlength="1" inputmode="numeric"/><input maxlength="1" inputmode="numeric"/><input maxlength="1" inputmode="numeric"/><input maxlength="1" inputmode="numeric"/><input maxlength="1" inputmode="numeric"/></div><div class="timer">Code expires in <b id="_cd">14:59</b></div><button class="btn" id="_cv" style="margin-top:14px" disabled>Verify Code</button><div class="timer" style="margin-top:12px">Didn\'t receive a code? <span id="_rs">Resend</span></div><p class="back" style="margin-top:14px">'+IC.bk+'<a id="_cb">Back to Sign In</a></p>';
  else if(page==='reset')fh='<div class="ico bl">'+IC.lock+'</div><h2>Create New Password</h2><p class="sub">Your new password must be different<br>from your previous password.</p><div id="_e"></div><div style="margin-bottom:16px"><label class="lbl">New Password</label><input type="password" class="inp" id="_np" placeholder="Min. 8 characters"/><div class="pm"><div id="_rpb"></div></div><div class="ph" id="_rpp">Must be at least 8 characters</div></div><div style="margin-bottom:18px"><label class="lbl">Confirm New Password</label><input type="password" class="inp" id="_cp" placeholder="Confirm your password"/></div><button class="btn" id="_rr">Reset Password</button>';
  else if(page==='done')fh='<div class="ico gn">'+IC.chk+'</div><h2 style="color:#059669">Password Reset!</h2><p class="sub">Your password has been successfully changed.<br>You can now sign in with your new password.</p><button class="btn gn" id="_gdl">Sign In Now</button>';

  el.innerHTML=LP()+'<div class="ap-right"><div class="ap-form"><div class="ap-mob" id="apMH"><i>$</i><span>CryptoxCore</span></div>'+fh+'</div></div>';
  document.body.appendChild(el);

  /* Home links */
  var hls=el.querySelectorAll('#apH,#apMH');
  hls.forEach(function(h){h.onclick=function(){removePg();window.history.pushState(null,'','/');};});

  /* Bind page-specific events */
  if(page==='login'){
    Q('#_em').onkeydown=function(e){if(e.key==='Enter')Q('#_pw').focus();};
    Q('#_pw').onkeydown=function(e){if(e.key==='Enter')Q('#_si').click();};
    Q('#_si').onclick=function(){var em=Q('#_em').value.trim(),pw=Q('#_pw').value;if(!em||em.indexOf('@')===-1){showE('Please enter a valid email address');return;}if(!pw){showE('Please enter your password');return;}Q('#_si').disabled=true;Q('#_si').textContent='Signing in...';mShow('Verifying Details','Processing your login...');var origFetch=_f;origFetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:em,password:pw})}).then(function(r){return r.json().then(function(d){return{ok:r.ok,data:d};});}).then(function(res){if(!res.ok){mHide();showE(res.data.error||'Login failed');Q('#_si').disabled=false;Q('#_si').textContent='Sign In';return;}localStorage.setItem('cxc_token',res.data.token);mOk('Login Successful!','Redirecting to dashboard...').then(function(){removePg();window.location.replace('/dashboard');});}).catch(function(e){mHide();showE(e.message||'Network error');Q('#_si').disabled=false;Q('#_si').textContent='Sign In';});};
    Q('#_fg').onclick=function(e){e.preventDefault();fp={step:'email',email:Q('#_em').value||'',masked:'',code:'',token:''};window.history.pushState(null,'','/forgot-password');buildPg('forgot');};
    Q('#_gs').onclick=function(e){e.preventDefault();removePg();clickRL('Sign Up');};
  }
  else if(page==='signup'){
    Q('#_ph').oninput=function(){this.value=this.value.replace(/\D/g,'');};
    Q('#_spw').oninput=function(){var pw=this.value,str=0;if(pw.length>=8)str++;if(pw.length>=12)str++;if(/[A-Z]/.test(pw)&&/[a-z]/.test(pw))str++;if(/\d/.test(pw))str++;if(/[^A-Za-z0-9]/.test(pw))str++;var p=Math.min(str/5*100,100),c=['#EF4444','#F59E0B','#F59E0B','#10B981','#059669'],l=['Very weak','Weak','Fair','Strong','Very strong'];var bar=Q('#_pb');if(bar){bar.style.width=p+'%';bar.style.background=c[Math.min(str,4)];}var h=Q('#_pp');if(h){h.textContent=pw?l[Math.min(str,4)]:'Must be at least 8 characters';h.style.color=pw?c[Math.min(str,4)]:'#9CA3AF';}};
    Q('#_su').onclick=function(){var fn=Q('#_fn').value.trim(),ph=Q('#_ph').value.trim(),em=Q('#_sem').value.trim(),pw=Q('#_spw').value,cpw=Q('#_cpw').value;if(!fn){showE('Full name is required');return;}if(!ph||ph.length<9){showE('Valid phone number required (9 digits)');return;}if(!em||em.indexOf('@')===-1){showE('Valid email address required');return;}if(pw.length<8){showE('Password must be at least 8 characters');return;}if(pw!==cpw){showE('Passwords do not match');return;}Q('#_su').disabled=true;Q('#_su').textContent='Creating...';mShow('Creating Account','Setting up your account...');var origFetch=_f;origFetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({fullName:fn,email:em,phone:ph,password:pw})}).then(function(r){return r.json().then(function(d){return{ok:r.ok,data:d};});}).then(function(res){if(!res.ok){mHide();showE(res.data.error||'Registration failed');Q('#_su').disabled=false;Q('#_su').textContent='Create Account';return;}localStorage.setItem('cxc_token',res.data.token);mOk('Account Created!','Welcome to CryptoxCore!').then(function(){removePg();window.location.replace('/dashboard');});}).catch(function(e){mHide();showE(e.message||'Network error');Q('#_su').disabled=false;Q('#_su').textContent='Create Account';});};
    Q('#_gl').onclick=function(e){e.preventDefault();removePg();clickRL('Sign In');};
  }
  else if(page==='forgot'){
    Q('#_fpe').onkeydown=function(e){if(e.key==='Enter')Q('#_fps').click();};
    Q('#_fps').onclick=function(){var em=Q('#_fpe').value.trim();if(!em||em.indexOf('@')===-1){showE('Please enter a valid email');return;}fp.email=em;var btn=Q('#_fps');btn.disabled=true;btn.textContent='Sending...';_chain('/api/auth/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:em})}).then(function(r){return r.json();}).then(function(d){if(d.error){showE(d.error);btn.disabled=false;btn.textContent='Send Reset Code';return;}fp.masked=d.maskedEmail||em;window.history.pushState(null,'','/forgot-password');buildPg('code');}).catch(function(){showE('Network error');btn.disabled=false;btn.textContent='Send Reset Code';});};
    Q('#_fpb').onclick=function(e){e.preventDefault();goLogin();};
  }
  else if(page==='code'){
    var oi=Q('#_otp').querySelectorAll('input');
    oi.forEach(function(inp,idx){
      inp.oninput=function(){inp.value=inp.value.replace(/\D/g,'').charAt(0)||'';if(inp.value&&idx<5)oi[idx+1].focus();chk();};
      inp.onkeydown=function(e){if(e.key==='Backspace'&&!inp.value&&idx>0)oi[idx-1].focus();};
      inp.onpaste=function(e){e.preventDefault();var t=(e.clipboardData||window.clipboardData).getData('text').replace(/\D/g,'');for(var p=0;p<6&&p<t.length;p++)oi[p].value=t[p];if(t.length>=6)oi[5].focus();chk();};
    });
    setTimeout(function(){oi[0].focus();},120);
    function chk(){var c='';oi.forEach(function(i){c+=i.value;});fp.code=c;Q('#_cv').disabled=c.length<6;}
    startCD();
    Q('#_cv').onclick=function(){if(fp.code.length<6)return;var btn=Q('#_cv');btn.disabled=true;btn.textContent='Verifying...';_chain('/api/auth/verify-reset-code',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:fp.email,code:fp.code})}).then(function(r){return r.json();}).then(function(d){if(d.error){showE(d.error);btn.disabled=false;btn.textContent='Verify Code';return;}fp.token=d.resetToken;buildPg('reset');}).catch(function(){showE('Verification failed');btn.disabled=false;btn.textContent='Verify Code';});};
    Q('#_rs').onclick=function(){var el2=Q('#_rs');el2.textContent='Sending...';el2.style.pointerEvents='none';_chain('/api/auth/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:fp.email})}).then(function(r){return r.json();}).then(function(){el2.textContent='Sent!';el2.style.color='#059669';startCD();setTimeout(function(){el2.textContent='Resend';el2.style.color='';el2.style.pointerEvents='';},3000);}).catch(function(){el2.textContent='Resend';el2.style.pointerEvents='';});};
    Q('#_cb').onclick=function(e){e.preventDefault();goLogin();};
  }
  else if(page==='reset'){
    Q('#_np').oninput=function(){var pw=this.value,str=0;if(pw.length>=8)str++;if(pw.length>=12)str++;if(/[A-Z]/.test(pw)&&/[a-z]/.test(pw))str++;if(/\d/.test(pw))str++;if(/[^A-Za-z0-9]/.test(pw))str++;var p=Math.min(str/5*100,100),c=['#EF4444','#F59E0B','#F59E0B','#10B981','#059669'],l=['Very weak','Weak','Fair','Strong','Very strong'];var bar=Q('#_rpb');if(bar){bar.style.width=p+'%';bar.style.background=c[Math.min(str,4)];}var h=Q('#_rpp');if(h){h.textContent=pw?l[Math.min(str,4)]:'Must be at least 8 characters';h.style.color=pw?c[Math.min(str,4)]:'#9CA3AF';}};
    Q('#_rr').onclick=function(){var np=Q('#_np').value,cp=Q('#_cp').value;if(!np||np.length<8){showE('Password must be at least 8 characters');return;}if(np!==cp){showE('Passwords do not match');return;}var btn=Q('#_rr');btn.disabled=true;btn.textContent='Resetting...';mShow('Resetting Password','Securing your account...');_chain('/api/auth/reset-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:fp.email,resetToken:fp.token,newPassword:np})}).then(function(r){return r.json();}).then(function(d){if(d.error){mHide();showE(d.error);btn.disabled=false;btn.textContent='Reset Password';return;}mOk('Password Changed!','Your account is now secured.').then(function(){buildPg('done');});}).catch(function(){mHide();showE('Reset failed');btn.disabled=false;btn.textContent='Reset Password';});};
  }
  else if(page==='done'){
    Q('#_gdl').onclick=function(){goLogin();};
  }
}

function startCD(){if(cdI)clearInterval(cdI);var s=899;cdI=setInterval(function(){s--;if(s<=0){clearInterval(cdI);return;}var el=document.getElementById('_cd');if(el){var m=Math.floor(s/60),sec=s%60;el.textContent=m+':'+(sec<10?'0':'')+sec;if(s<60)el.style.color='#EF4444';}},1000);}

/* Router */
function route(){
  var p=window.location.pathname;
  if(localStorage.getItem('cxc_token')){removePg();return;}
  if(p==='/login'){buildPg('login');}
  else if(p==='/signup'){buildPg('signup');}
  else if(p==='/forgot-password'){buildPg('forgot');}
  else{removePg();}
}

var _push=history.pushState;
history.pushState=function(){_push.apply(this,arguments);setTimeout(route,80);};
window.addEventListener('popstate',function(){setTimeout(route,80);});
new MutationObserver(function(){if(localStorage.getItem('cxc_token'))return;var p=window.location.pathname;if((p==='/login'||p==='/signup'||p==='/forgot-password')&&!document.getElementById('cxcAP')){route();}}).observe(document.body,{childList:true,subtree:true});
setTimeout(route,400);
})();
</script>

<!-- ‚ïê‚ïê‚ïê PREMIUM LANDING PAGE ‚Äî Fintech SaaS Style ‚ïê‚ïê‚ïê -->
<script>
(function(){
'use strict';
var CM={bitcoin:{s:'BTC',c:'#F7931A'},ethereum:{s:'ETH',c:'#627EEA'},binancecoin:{s:'BNB',c:'#F3BA2F'},solana:{s:'SOL',c:'#9945FF'},ripple:{s:'XRP',c:'#00AAE4'},cardano:{s:'ADA',c:'#0033AD'},dogecoin:{s:'DOGE',c:'#C2A633'},'avalanche-2':{s:'AVAX',c:'#E84142'},polkadot:{s:'DOT',c:'#E6007A'},chainlink:{s:'LINK',c:'#2A5ADA'},litecoin:{s:'LTC',c:'#345D9D'},tether:{s:'USDT',c:'#26A17B'},uniswap:{s:'UNI',c:'#FF007A'},tron:{s:'TRX',c:'#EF0027'}};
var coins=[];
var landCSS=document.createElement('style');
landCSS.textContent='\
#cxcLP{position:fixed;inset:0;z-index:80;background:#fff;overflow-y:auto;overflow-x:hidden;font-family:Outfit,sans-serif;color:#0F1629;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}\
#cxcLP *{box-sizing:border-box}\
#cxcLP a{text-decoration:none;color:inherit}\
#cxcLP button{cursor:pointer;font-family:inherit;border:none;outline:none}\
.lp-nav{position:sticky;top:0;z-index:100;height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 clamp(16px,4vw,48px);background:rgba(255,255,255,.82);backdrop-filter:blur(20px) saturate(1.6);-webkit-backdrop-filter:blur(20px) saturate(1.6);border-bottom:1px solid rgba(0,0,0,.04);transition:all .3s}\
.lp-nav.scrolled{background:rgba(255,255,255,.96);box-shadow:0 1px 20px rgba(0,0,0,.06);height:58px}\
.lp-logo{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:800;user-select:none}\
.lp-logo i{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#4361EE 0%,#7C3AED 100%);display:flex;align-items:center;justify-content:center;font-style:normal;font-size:15px;font-weight:900;color:#fff;box-shadow:0 4px 14px rgba(67,97,238,.35);transition:transform .3s,box-shadow .3s}\
.lp-nav:hover .lp-logo i{transform:rotate(-6deg) scale(1.05);box-shadow:0 6px 20px rgba(67,97,238,.4)}\
.lp-logo .lp-live{display:inline-flex;align-items:center;gap:5px;margin-left:12px;padding:3px 10px 3px 8px;border-radius:20px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.15);font-size:11px;font-weight:600;color:#059669}\
.lp-logo .lp-live::before{content:"";width:6px;height:6px;border-radius:50%;background:#10B981;box-shadow:0 0 6px rgba(16,185,129,.5);animation:lpPulse 2s ease infinite}\
@keyframes lpPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}\
.lp-nav-links{display:flex;gap:2px;align-items:center}\
.lp-nav-links a{position:relative;padding:8px 16px;font-size:14px;font-weight:500;color:#6B7280;border-radius:8px;transition:all .2s}\
.lp-nav-links a::after{content:"";position:absolute;bottom:2px;left:50%;width:0;height:2px;background:linear-gradient(90deg,#4361EE,#7C3AED);border-radius:2px;transition:all .25s cubic-bezier(.4,0,.2,1);transform:translateX(-50%)}\
.lp-nav-links a:hover{color:#111827}\
.lp-nav-links a:hover::after{width:60%}\
.lp-nav-links .sep{width:1px;height:20px;background:#E5E7EB;margin:0 6px}\
.lp-nav-btns{display:flex;gap:8px;align-items:center}\
.lp-nav-btns button{padding:9px 22px;border-radius:10px;font-size:14px;font-weight:600;transition:all .2s;position:relative;overflow:hidden}\
.lp-nav-btns .l{background:transparent;color:#374151;border:1px solid transparent}\
.lp-nav-btns .l:hover{background:#F5F5F7;border-color:#E5E7EB}\
.lp-nav-btns .s{background:linear-gradient(135deg,#4361EE,#5B6CF0);color:#fff;box-shadow:0 2px 12px rgba(67,97,238,.3);border:1px solid rgba(255,255,255,.1)}\
.lp-nav-btns .s:hover{box-shadow:0 4px 20px rgba(67,97,238,.4);transform:translateY(-1px)}\
.lp-nav-btns .s::after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);transition:left .5s}\
.lp-nav-btns .s:hover::after{left:100%}\
.lp-mob-toggle{display:none;width:40px;height:40px;border-radius:10px;background:#F5F5F7;align-items:center;justify-content:center;cursor:pointer;border:1px solid #E5E7EB;transition:all .15s;flex-shrink:0}\
.lp-mob-toggle:hover{background:#EDEDF0}\
.lp-mob-toggle span{display:block;width:18px;height:2px;background:#374151;border-radius:2px;transition:all .3s;position:relative}\
.lp-mob-toggle span::before,.lp-mob-toggle span::after{content:"";position:absolute;left:0;width:100%;height:2px;background:#374151;border-radius:2px;transition:all .3s}\
.lp-mob-toggle span::before{top:-5px}.lp-mob-toggle span::after{top:5px}\
.lp-mob-toggle.open span{background:transparent}\
.lp-mob-toggle.open span::before{transform:rotate(45deg);top:0}\
.lp-mob-toggle.open span::after{transform:rotate(-45deg);top:0}\
.lp-mob-menu{display:none;position:fixed;top:64px;left:0;right:0;background:rgba(255,255,255,.98);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid #E5E7EB;padding:12px 20px 20px;z-index:99;box-shadow:0 12px 40px rgba(0,0,0,.08);transform:translateY(-8px);opacity:0;transition:all .25s cubic-bezier(.4,0,.2,1)}\
.lp-mob-menu.open{transform:translateY(0);opacity:1}\
.lp-mob-menu a{display:block;padding:12px 16px;font-size:15px;font-weight:500;color:#374151;border-radius:10px;transition:all .15s}\
.lp-mob-menu a:hover{background:#F5F5F7}\
.lp-mob-menu .mb-btns{display:flex;gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid #F0F0F0}\
.lp-mob-menu .mb-btns button{flex:1;padding:12px;border-radius:10px;font-size:14px;font-weight:600}\
@media(max-width:768px){.lp-nav-links{display:none!important}.lp-nav-btns{display:none!important}.lp-mob-toggle{display:flex!important}.lp-nav.scrolled{height:56px}}\
\
.lp-ticker{background:#F8F9FB;border-bottom:1px solid #F0F0F0;height:44px;overflow:hidden}\
.lp-ticker-track{display:flex;align-items:center;height:44px;animation:lpTk 35s linear infinite;white-space:nowrap;width:max-content}\
.lp-ticker-track:hover{animation-play-state:paused}\
.lp-tk-item{display:inline-flex;align-items:center;gap:8px;padding:0 20px;font-size:13px;font-weight:500;color:#6B7280;border-right:1px solid #F0F0F0}\
.lp-tk-item .sym{color:#111;font-weight:700}\
.lp-tk-item .up{color:#10B981;font-weight:600}\
.lp-tk-item .dn{color:#EF4444;font-weight:600}\
@keyframes lpTk{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}\
\
.lp-hero{padding:clamp(60px,10vw,100px) clamp(20px,5vw,80px) 60px;display:flex;align-items:center;gap:clamp(40px,5vw,80px);max-width:1200px;margin:0 auto}\
.lp-hero-left{flex:1;min-width:0}\
.lp-hero-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 14px;border-radius:20px;background:#EBF0FF;font-size:13px;font-weight:600;color:#4361EE;margin-bottom:24px}\
.lp-hero-badge i{width:6px;height:6px;border-radius:50%;background:#10B981;animation:lpPulse 2s infinite}\
@keyframes lpPulse{0%,100%{opacity:.5}50%{opacity:1}}\
.lp-hero h1{font-size:clamp(32px,5vw,54px);font-weight:900;line-height:1.1;margin-bottom:18px;letter-spacing:-.5px}\
.lp-hero h1 em{font-style:normal;background:linear-gradient(90deg,#4361EE,#7C3AED);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}\
.lp-hero p{font-size:17px;line-height:1.7;color:#6B7280;margin-bottom:32px;max-width:500px}\
.lp-hero-btns{display:flex;gap:12px;flex-wrap:wrap}\
.lp-hero-btns .pr{padding:14px 30px;border-radius:12px;background:#4361EE;color:#fff;font-size:15px;font-weight:700;box-shadow:0 6px 24px rgba(67,97,238,.3);transition:all .2s;display:flex;align-items:center;gap:8px}\
.lp-hero-btns .pr:hover{background:#5B6CF0;transform:translateY(-2px)}\
.lp-hero-btns .sc{padding:14px 30px;border-radius:12px;background:#F5F5F5;color:#374151;font-size:15px;font-weight:600;transition:all .2s}\
.lp-hero-btns .sc:hover{background:#EBEBEB}\
.lp-hero-trust{display:flex;gap:20px;margin-top:36px;flex-wrap:wrap}\
.lp-hero-trust span{font-size:13px;color:#9CA3AF;display:flex;align-items:center;gap:5px}\
.lp-hero-right{width:420px;flex-shrink:0}\
.lp-market-card{background:#fff;border:1px solid #F0F0F0;border-radius:16px;padding:20px;box-shadow:0 4px 24px rgba(0,0,0,.05)}\
.lp-market-card h3{font-size:14px;font-weight:700;color:#374151;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}\
.lp-market-card h3 span{font-size:12px;color:#9CA3AF;font-weight:500}\
.lp-mc-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid #F8F8F8}\
.lp-mc-row:last-child{border-bottom:none}\
.lp-mc-row .left{display:flex;align-items:center;gap:10px}\
.lp-mc-row .ci{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#fff}\
.lp-mc-row .name{font-size:14px;font-weight:600}\
.lp-mc-row .pair{font-size:12px;color:#9CA3AF}\
.lp-mc-row .right{text-align:right}\
.lp-mc-row .price{font-size:14px;font-weight:700}\
.lp-mc-row .chg{font-size:12px;font-weight:600;padding:3px 8px;border-radius:6px;display:inline-block;margin-top:2px}\
.lp-mc-row .chg.up{color:#10B981;background:#ECFDF5}\
.lp-mc-row .chg.dn{color:#EF4444;background:#FEF2F2}\
@media(max-width:900px){.lp-hero{flex-direction:column;text-align:center;padding-top:40px}.lp-hero p{margin:0 auto 32px}.lp-hero-btns{justify-content:center}.lp-hero-trust{justify-content:center}.lp-hero-right{width:100%;max-width:400px}}\
\
.lp-stats{background:#F8F9FB;border-top:1px solid #F0F0F0;border-bottom:1px solid #F0F0F0;padding:36px 24px}\
.lp-stats-grid{max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:16px;text-align:center}\
.lp-stats-grid .v{font-size:28px;font-weight:800;color:#4361EE}\
.lp-stats-grid .l{font-size:13px;color:#9CA3AF;margin-top:4px}\
@media(max-width:600px){.lp-stats-grid{grid-template-columns:repeat(2,1fr);gap:24px}}\
\
.lp-features{padding:80px 24px;max-width:1100px;margin:0 auto}\
.lp-sect-hd{text-align:center;margin-bottom:48px}\
.lp-sect-hd h2{font-size:34px;font-weight:900;margin-bottom:10px}\
.lp-sect-hd p{font-size:15px;color:#6B7280;max-width:460px;margin:0 auto}\
.lp-feat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}\
.lp-feat-card{background:#fff;border:1px solid #F0F0F0;border-radius:16px;padding:28px;transition:all .25s}\
.lp-feat-card:hover{border-color:#4361EE;box-shadow:0 12px 40px rgba(67,97,238,.08);transform:translateY(-4px)}\
.lp-feat-card .ic{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:16px}\
.lp-feat-card h3{font-size:17px;font-weight:700;margin-bottom:8px}\
.lp-feat-card p{font-size:14px;line-height:1.7;color:#6B7280}\
@media(max-width:768px){.lp-feat-grid{grid-template-columns:1fr}}\
\
.lp-how{padding:80px 24px;background:#F8F9FB;border-top:1px solid #F0F0F0}\
.lp-how-grid{max-width:900px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:32px}\
.lp-how-step{text-align:center}\
.lp-how-step .num{width:60px;height:60px;border-radius:50%;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900;color:#fff}\
.lp-how-step h3{font-size:17px;font-weight:700;margin-bottom:8px}\
.lp-how-step p{font-size:14px;line-height:1.7;color:#6B7280;max-width:260px;margin:0 auto}\
@media(max-width:768px){.lp-how-grid{grid-template-columns:1fr}}\
\
.lp-security{padding:80px 24px;max-width:1100px;margin:0 auto}\
.lp-sec-grid{display:grid;grid-template-columns:1fr 1fr;gap:48px;align-items:center}\
.lp-sec-list div{display:flex;align-items:center;gap:10px;margin-bottom:12px;font-size:14px;font-weight:500;color:#374151}\
.lp-sec-list .ck{width:22px;height:22px;border-radius:50%;background:#ECFDF5;display:flex;align-items:center;justify-content:center;flex-shrink:0}\
.lp-sec-box{background:linear-gradient(135deg,#4361EE,#5B6CF0,#7C3AED);border-radius:20px;padding:40px 32px;text-align:center;color:#fff;box-shadow:0 16px 48px rgba(67,97,238,.2)}\
.lp-sec-box .big{font-size:56px;font-weight:900}\
.lp-sec-box .t{font-size:16px;font-weight:600;margin-top:6px;opacity:.9}\
.lp-sec-box .sm{font-size:13px;opacity:.6;margin-top:4px}\
.lp-sec-box .mg{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:24px}\
.lp-sec-box .mg div{padding:12px 6px;border-radius:10px;background:rgba(255,255,255,.12)}\
.lp-sec-box .mg .v{font-size:18px;font-weight:800}\
.lp-sec-box .mg .l{font-size:10px;opacity:.6;margin-top:2px}\
@media(max-width:768px){.lp-sec-grid{grid-template-columns:1fr}}\
\
.lp-pay{padding:40px 24px;border-top:1px solid #F0F0F0;border-bottom:1px solid #F0F0F0;text-align:center}\
.lp-pay .title{font-size:12px;font-weight:600;color:#9CA3AF;text-transform:uppercase;letter-spacing:2px;margin-bottom:16px}\
.lp-pay-chips{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}\
.lp-pay-chips span{padding:10px 20px;border-radius:10px;font-size:13px;font-weight:700}\
\
.lp-cta{padding:80px 24px;background:linear-gradient(135deg,#4361EE,#5B6CF0,#7C3AED);text-align:center;color:#fff;position:relative;overflow:hidden}\
.lp-cta h2{font-size:36px;font-weight:900;margin-bottom:14px}\
.lp-cta p{font-size:16px;opacity:.75;margin-bottom:32px}\
.lp-cta button{padding:16px 40px;border-radius:12px;background:#fff;color:#4361EE;font-size:16px;font-weight:700;box-shadow:0 8px 28px rgba(0,0,0,.15);transition:all .2s;display:inline-flex;align-items:center;gap:8px}\
.lp-cta button:hover{transform:translateY(-2px)}\
.lp-cta .note{font-size:12px;opacity:.45;margin-top:14px}\
\
.lp-footer{background:#0F1629;color:#fff;padding:56px 24px 28px}\
.lp-foot-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:36px;margin-bottom:40px}\
.lp-foot-grid h4{font-size:13px;font-weight:700;margin-bottom:14px;color:rgba(255,255,255,.7)}\
.lp-foot-grid a{display:block;font-size:13px;color:rgba(255,255,255,.35);margin-bottom:8px;transition:color .15s}\
.lp-foot-grid a:hover{color:#4361EE}\
.lp-foot-grid .desc{font-size:13px;line-height:1.6;color:rgba(255,255,255,.3);max-width:260px;margin-top:10px}\
.lp-foot-bot{max-width:1100px;margin:0 auto;border-top:1px solid rgba(255,255,255,.06);padding-top:20px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;font-size:12px;color:rgba(255,255,255,.2)}\
.lp-foot-bot a{color:rgba(255,255,255,.2)}.lp-foot-bot a:hover{color:#4361EE}\
@media(max-width:768px){.lp-foot-grid{grid-template-columns:1fr 1fr}}\
';
document.head.appendChild(landCSS);

function fmt(n){if(!n||isNaN(n))return'0.00';return n<1?n.toFixed(4):n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});}
function goAuth(m){var btns=document.querySelectorAll('button');var t=m==='signup'?'Get Started':'Login';for(var i=0;i<btns.length;i++){if(btns[i].closest('#cxcLP'))continue;var txt=btns[i].textContent.trim();if((m==='login'&&txt==='Login')||(m==='signup'&&(txt==='Get Started'||txt==='Sign Up'))){btns[i].click();return;}}window.history.pushState(null,'','/'+m);}

function build(){
  var el=document.getElementById('cxcLP');if(el)el.remove();
  el=document.createElement('div');el.id='cxcLP';
  var arr='<svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" viewBox="0 0 24 24"><path d="M5 12h14m-7-7 7 7-7 7"/></svg>';
  var chk='<svg width="13" height="13" fill="none" stroke="#10B981" stroke-width="2.5" stroke-linecap="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>';

  el.innerHTML='<nav class="lp-nav" id="lpNav"><div class="lp-logo"><i>$</i>CryptoxCore<span class="lp-live">Live</span></div><div class="lp-nav-links"><a href="#features">Features</a><a href="#how-it-works">How It Works</a><a href="#security">Security</a><div class="sep"></div><a href="#" id="lpBTC" style="font-weight:700;color:#111;font-size:13px">BTC $‚Äî</a></div><div class="lp-nav-btns"><button class="l" id="lpL">Log In</button><button class="s" id="lpS">Get Started <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" viewBox="0 0 24 24" style="vertical-align:middle;margin-left:2px"><path d="M5 12h14m-7-7 7 7-7 7"/></svg></button></div><div class="lp-mob-toggle" id="lpMobT"><span></span></div></nav><div class="lp-mob-menu" id="lpMobM"><a href="#features">Features</a><a href="#how-it-works">How It Works</a><a href="#security">Security</a><div class="mb-btns"><button class="l" id="lpML" style="background:#F5F5F7;color:#374151;border:1px solid #E5E7EB">Log In</button><button class="s" id="lpMS" style="background:linear-gradient(135deg,#4361EE,#5B6CF0);color:#fff">Sign Up</button></div></div>'
  +'<div class="lp-ticker"><div class="lp-ticker-track" id="lpTicker"></div></div>'
  +'<section class="lp-hero"><div class="lp-hero-left"><div class="lp-hero-badge"><i></i>Cameroon\'s #1 Crypto Exchange</div><h1>Buy & Sell <em>Crypto</em> with Mobile Money</h1><p>Trade 14+ cryptocurrencies instantly. Deposit with MTN MoMo & Orange Money, convert to BTC, ETH, SOL and more.</p><div class="lp-hero-btns"><button class="pr" id="lpHS">Start Trading '+arr+'</button><button class="sc" onclick="document.getElementById(\'cxcLP\').querySelector(\'#features\').scrollIntoView({behavior:\'smooth\'})">Learn More</button></div><div class="lp-hero-trust"><span><svg width="14" height="14" fill="none" stroke="#9CA3AF" stroke-width="2" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>256-bit SSL</span><span><svg width="14" height="14" fill="none" stroke="#9CA3AF" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>2FA Protected</span><span><svg width="14" height="14" fill="none" stroke="#9CA3AF" stroke-width="2" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>Instant</span></div></div><div class="lp-hero-right"><div class="lp-market-card"><h3>Live Markets <span>24h Change</span></h3><div id="lpPrices"></div></div></div></section>'
  +'<section class="lp-stats"><div class="lp-stats-grid"><div><div class="v">10K+</div><div class="l">Active Traders</div></div><div><div class="v">14+</div><div class="l">Cryptocurrencies</div></div><div><div class="v">99.9%</div><div class="l">Uptime</div></div><div><div class="v">530 XAF</div><div class="l">Per $1 USD</div></div></div></section>'
  +'<section class="lp-features" id="features"><div class="lp-sect-hd"><h2>Why Choose CryptoxCore?</h2><p>Everything you need for professional crypto trading</p></div><div class="lp-feat-grid"><div class="lp-feat-card"><div class="ic" style="background:#EBF0FF">üîê</div><h3>Bank-Grade Security</h3><p>AES-256 encryption, multi-factor auth, and cold storage to protect your assets.</p></div><div class="lp-feat-card"><div class="ic" style="background:#F3EAFF">‚ö°</div><h3>Lightning Fast</h3><p>Execute trades in milliseconds. High-performance engine with minimal latency.</p></div><div class="lp-feat-card"><div class="ic" style="background:#ECFDF5">üì±</div><h3>Mobile Money</h3><p>Deposit & withdraw via MTN MoMo or Orange Money. No bank account needed.</p></div><div class="lp-feat-card"><div class="ic" style="background:#FEF2F2">üìä</div><h3>Real-Time Prices</h3><p>Live market data with 30s refresh. Track all coins with sparkline charts.</p></div><div class="lp-feat-card"><div class="ic" style="background:#FFFBEB">üîî</div><h3>Telegram Alerts</h3><p>Instant notifications for all account activity via our secure Telegram bot.</p></div><div class="lp-feat-card"><div class="ic" style="background:#EFF6FF">üåç</div><h3>24/7 Support</h3><p>Round-the-clock support via Telegram, email, and in-app messaging.</p></div></div></section>'
  +'<section class="lp-how" id="how-it-works"><div class="lp-sect-hd"><h2>Get Started in 3 Steps</h2><p>From signup to your first trade in under 2 minutes</p></div><div class="lp-how-grid"><div class="lp-how-step"><div class="num" style="background:linear-gradient(135deg,#4361EE,#6366F1);box-shadow:0 8px 24px rgba(67,97,238,.3)">1</div><h3>Create Account</h3><p>Sign up with email and phone. +237 Cameroon numbers supported.</p></div><div class="lp-how-step"><div class="num" style="background:linear-gradient(135deg,#7C3AED,#9333EA);box-shadow:0 8px 24px rgba(124,58,237,.3)">2</div><h3>Deposit Funds</h3><p>Add money via MTN MoMo or Orange Money. Zero fees, instant processing.</p></div><div class="lp-how-step"><div class="num" style="background:linear-gradient(135deg,#EC4899,#F43F5E);box-shadow:0 8px 24px rgba(236,72,153,.3)">3</div><h3>Start Trading</h3><p>Buy & sell BTC, ETH, SOL and 11 more coins at real-time market prices.</p></div></div></section>'
  +'<section class="lp-security" id="security"><div class="lp-sec-grid"><div><h2 style="font-size:34px;font-weight:900;margin-bottom:14px;line-height:1.15">Your Security is<br>Our Priority</h2><p style="font-size:14px;line-height:1.7;color:#6B7280;margin-bottom:24px">Industry-leading measures to protect your assets at every level.</p><div class="lp-sec-list"><div><span class="ck">'+chk+'</span>End-to-end AES-256 encryption</div><div><span class="ck">'+chk+'</span>Two-factor authentication (2FA)</div><div><span class="ck">'+chk+'</span>Cold storage for digital assets</div><div><span class="ck">'+chk+'</span>Regular security audits</div><div><span class="ck">'+chk+'</span>DDoS protection & rate limiting</div><div><span class="ck">'+chk+'</span>Telegram instant alerts</div></div></div><div class="lp-sec-box"><div class="big">99.9%</div><div class="t">Uptime</div><div class="sm">Reliable service you can trust</div><div class="mg"><div><div class="v">256</div><div class="l">Bit Encryption</div></div><div><div class="v">24/7</div><div class="l">Monitoring</div></div><div><div class="v">0</div><div class="l">Breaches</div></div></div></div></div></section>'
  +'<section class="lp-pay"><div class="title">Supported Payment Methods</div><div class="lp-pay-chips"><span style="color:#FFCB05;background:#FFFBE5;border:1px solid #FFCB0530">üì± MTN MoMo</span><span style="color:#FF6600;background:#FFF3E8;border:1px solid #FF660030">üì≤ Orange Money</span><span style="color:#F7931A;background:#FFF8EE;border:1px solid #F7931A30">‚Çø Bitcoin</span><span style="color:#627EEA;background:#EEF1FF;border:1px solid #627EEA30">Œû Ethereum</span><span style="color:#26A17B;background:#EEFBF6;border:1px solid #26A17B30">‚ÇÆ USDT</span></div></section>'
  +'<section class="lp-cta"><h2>Ready to Start Trading?</h2><p>Join thousands of traders across Cameroon</p><button id="lpCTA">Create Free Account '+arr+'</button><div class="note">No minimum deposit ¬∑ Free to sign up ¬∑ Instant verification</div></section>'
  +'<footer class="lp-footer"><div class="lp-foot-grid"><div><div class="lp-logo" style="margin-bottom:12px"><i style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#4361EE,#6366F1);display:flex;align-items:center;justify-content:center;font-style:normal;font-size:14px;font-weight:900;color:#fff">$</i>CryptoxCore</div><div class="desc">Secure cryptocurrency trading built for Africa. Trade with Mobile Money.</div></div><div><h4>Platform</h4><a href="#features">Features</a><a href="#how-it-works">How It Works</a><a href="#security">Security</a></div><div><h4>Account</h4><a href="#" id="lpFL">Login</a><a href="#" id="lpFS">Sign Up</a></div><div><h4>Support</h4><a href="#">Help Center</a><a href="#">Contact</a><a href="https://t.me/fauscrypto_alert_bot" target="_blank">Telegram Bot</a></div></div><div class="lp-foot-bot"><span>¬© 2026 CryptoxCore. All rights reserved.</span><div style="display:flex;gap:16px"><a href="#">Privacy</a><a href="#">Terms</a></div></div></footer>';

  document.body.appendChild(el);
  el.querySelector('#lpL').onclick=function(){goAuth('login');};
  el.querySelector('#lpS').onclick=function(){goAuth('signup');};
  el.querySelector('#lpHS').onclick=function(){goAuth('signup');};
  el.querySelector('#lpCTA').onclick=function(){goAuth('signup');};
  el.querySelector('#lpFL').onclick=function(e){e.preventDefault();goAuth('login');};
  el.querySelector('#lpFS').onclick=function(e){e.preventDefault();goAuth('signup');};
  // Mobile menu toggle
  var mobT=el.querySelector('#lpMobT'),mobM=el.querySelector('#lpMobM');
  if(mobT&&mobM){
    mobT.onclick=function(){mobT.classList.toggle('open');mobM.style.display=mobM.classList.contains('open')?'none':'block';setTimeout(function(){mobM.classList.toggle('open');},10);};
    var mla=el.querySelector('#lpML'),msa=el.querySelector('#lpMS');
    if(mla)mla.onclick=function(){mobT.classList.remove('open');mobM.classList.remove('open');mobM.style.display='none';goAuth('login');};
    if(msa)msa.onclick=function(){mobT.classList.remove('open');mobM.classList.remove('open');mobM.style.display='none';goAuth('signup');};
    mobM.querySelectorAll('a[href^="#"]').forEach(function(a){a.addEventListener('click',function(){mobT.classList.remove('open');mobM.classList.remove('open');mobM.style.display='none';});});
  }
  // Scroll effect for nav
  var lpNavEl=el.querySelector('#lpNav');
  var lpScWrap=el;
  if(lpNavEl&&lpScWrap){lpScWrap.addEventListener('scroll',function(){if(lpScWrap.scrollTop>40)lpNavEl.classList.add('scrolled');else lpNavEl.classList.remove('scrolled');},{passive:true});}
  // Smooth scroll for anchor links inside #cxcLP
  el.querySelectorAll('a[href^="#"]').forEach(function(a){a.onclick=function(e){var id=a.getAttribute('href').slice(1);var t=el.querySelector('#'+id);if(t){e.preventDefault();t.scrollIntoView({behavior:'smooth'});}}});
  fetchCoins();
}

function fetchCoins(){
  fetch('/api/coins').then(function(r){return r.json();}).then(function(d){coins=d.coins||[];buildTicker();buildPrices();}).catch(function(){});
  setInterval(function(){fetch('/api/coins').then(function(r){return r.json();}).then(function(d){coins=d.coins||[];buildPrices();}).catch(function(){});},30000);
}
function buildTicker(){
  var t=document.getElementById('lpTicker');if(!t||!coins.length)return;
  var h='';coins.forEach(function(c){var m=CM[c.id]||{s:c.id.slice(0,4).toUpperCase()};var ch=c.price_change_percentage_24h||0;h+='<div class="lp-tk-item"><span class="sym">'+m.s+'</span> $'+fmt(c.current_price)+' <span class="'+(ch>=0?'up':'dn')+'">'+(ch>=0?'+':'')+ch.toFixed(2)+'%</span></div>';});
  t.innerHTML=h+h;
}
function buildPrices(){
  var el=document.getElementById('lpPrices');if(!el||!coins.length)return;
  var top=coins.slice(0,5);var h='';
  top.forEach(function(c){var m=CM[c.id]||{s:c.id.slice(0,4).toUpperCase(),c:'#888'};var ch=c.price_change_percentage_24h||0;
    h+='<div class="lp-mc-row"><div class="left"><div class="ci" style="background:'+m.c+'">'+m.s.charAt(0)+'</div><div><div class="name">'+c.name+'</div><div class="pair">'+m.s+'/USD</div></div></div><div class="right"><div class="price">$'+fmt(c.current_price)+'</div><div class="chg '+(ch>=0?'up':'dn')+'">'+(ch>=0?'‚ñ≤ +':'‚ñº ')+ch.toFixed(2)+'%</div></div></div>';
  });
  el.innerHTML=h;
  // Update BTC price in nav
  var btcEl=document.getElementById('lpBTC');var btc=coins.find(function(c){return c.id==='bitcoin';});
  if(btcEl&&btc){var bch=btc.price_change_percentage_24h||0;btcEl.innerHTML='BTC <span style="color:'+(bch>=0?'#10B981':'#EF4444')+'">$'+fmt(btc.current_price)+'</span>';btcEl.onclick=function(e){e.preventDefault();};}
}

function check(){if(localStorage.getItem('cxc_token')){var x=document.getElementById('cxcLP');if(x)x.remove();return;}var p=window.location.pathname;var el=document.getElementById('cxcLP');if(p==='/'||p===''){if(!el)build();}else{if(el)el.remove();}}
var _p2=history.pushState;history.pushState=function(){_p2.apply(this,arguments);setTimeout(check,50);};
window.addEventListener('popstate',function(){setTimeout(check,50);});
new MutationObserver(function(){if(localStorage.getItem('cxc_token'))return;var p=window.location.pathname;if((p==='/'||p==='')&&!document.getElementById('cxcLP'))check();}).observe(document.body,{childList:true,subtree:true});
setTimeout(check,300);
})();
</script>
</body>
</html>
